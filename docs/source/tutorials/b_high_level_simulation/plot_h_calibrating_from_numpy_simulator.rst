
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorials/b_high_level_simulation/plot_h_calibrating_from_numpy_simulator.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


Calibrating an Unknown Op-Amp Pole from Data
============================================

.. GENERATED FROM PYTHON SOURCE LINES 6-11

.. code-block:: default

    import cbadc
    import numpy as np
    import matplotlib.pyplot as plt
    import copy








.. GENERATED FROM PYTHON SOURCE LINES 12-15

Setup proxy simulators from numpy data
--------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 15-27

.. code-block:: default

    specification_false = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_FALSE.dict')
    specification_ref = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_TRUE.dict')
    T = specification_ref['T']
    BW = specification_ref['fc']
    N = specification_false['N']
    M = N + 1

    ctrl_bits_test_uncalibrated = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_ref = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_cal = cbadc.simulator.NumpySimulator('op-amp_data/s_test.npy')
    ctrl_bits_train = cbadc.simulator.NumpySimulator('op-amp_data/s_train.npy')








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Instantiate Analog Systems, Digital Controls, and Nominal FIR Filters
----------------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 31-73

.. code-block:: default


    analog_system = cbadc.analog_system.AnalogSystem(
        specification_false['A'],
        specification_false['B'],
        np.eye(specification_false['N']),
        specification_false['Gamma'],
        specification_false['Gamma'].transpose(),
    )
    analog_system_ref = cbadc.analog_system.AnalogSystem(
        specification_ref['A'],
        specification_ref['B'],
        np.eye(specification_ref['N']),
        specification_ref['Gamma'],
        specification_ref['Gamma'].transpose(),
    )

    digital_control = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_false['T']), M
    )
    digital_control_ref = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_ref['T']), M
    )

    eta2 = (
        np.linalg.norm(
            analog_system_ref.transfer_function_matrix(
                np.array([2 * np.pi * specification_ref['fc']])
            )
        )
        ** 2
    )
    K1 = 1 << 8
    K2 = K1

    fir_filter = cbadc.digital_estimator.FIRFilter(
        analog_system, digital_control, eta2, K1, K2
    )

    fir_filter_ref = cbadc.digital_estimator.FIRFilter(
        analog_system_ref, digital_control_ref, eta2, K1, K2
    )








.. GENERATED FROM PYTHON SOURCE LINES 74-77

Setup testing simulations for verification
---------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 77-95

.. code-block:: default


    # Ref
    uncalibrated_filter = copy.deepcopy(fir_filter)
    uncalibrated_filter(ctrl_bits_test_uncalibrated)


    fir_filter_ref(ctrl_bits_test_ref)


    size = 1 << 14
    u_hat_ref = np.zeros(size)
    u_hat_uncalibrated = np.zeros(size)
    for index in range(size):
        u_hat_ref[index] = next(fir_filter_ref)
        u_hat_uncalibrated[index] = next(uncalibrated_filter)
    u_hat_cut_ref = u_hat_ref[K1 + K2 :]
    u_hat_cut_uncalibrated = u_hat_uncalibrated[K1 + K2 :]








.. GENERATED FROM PYTHON SOURCE LINES 96-99

Instantiate adaptive filter and set buffer training data size
-------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 99-104

.. code-block:: default

    training_data_size = 1 << 15 - 1
    adaptive_filter = cbadc.digital_estimator.AdaptiveFilter(
        fir_filter, 0, training_data_size
    )








.. GENERATED FROM PYTHON SOURCE LINES 105-108

Instantiate the training instance
----------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 108-112

.. code-block:: default

    calibrator = cbadc.digital_calibration.Calibration(
        adaptive_filter, ctrl_bits_train, ctrl_bits_test_cal
    )








.. GENERATED FROM PYTHON SOURCE LINES 113-118

Train adaptive filter
----------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 118-130

.. code-block:: default

    epochs = 1 << 16


    def step_size(x):
        return 1e-1 / ((1 + x ** (0.01)))


    batch_size = 1 << 6

    calibrator.compute_step_size_template()
    calibrator.train(epochs, step_size, batch_size, stochastic_delay=0)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/65536 [00:00<?, ?it/s]      0%|          | 1/65536 [00:00<5:51:06,  3.11it/s]      0%|          | 79/65536 [00:00<04:30, 241.85it/s]      0%|          | 157/65536 [00:00<02:41, 405.84it/s]      0%|          | 235/65536 [00:00<02:05, 518.85it/s]      0%|          | 313/65536 [00:00<01:49, 597.53it/s]      1%|          | 391/65536 [00:00<01:39, 651.97it/s]      1%|          | 469/65536 [00:00<01:34, 689.81it/s]      1%|          | 547/65536 [00:01<01:30, 714.82it/s]      1%|          | 625/65536 [00:01<01:28, 733.47it/s]      1%|1         | 704/65536 [00:01<01:26, 747.94it/s]      1%|1         | 783/65536 [00:01<01:25, 758.85it/s]      1%|1         | 862/65536 [00:01<01:24, 767.61it/s]      1%|1         | 941/65536 [00:01<01:23, 773.34it/s]      2%|1         | 1020/65536 [00:01<01:23, 775.55it/s]      2%|1         | 1099/65536 [00:01<01:23, 775.15it/s]      2%|1         | 1177/65536 [00:01<01:23, 774.84it/s]      2%|1         | 1255/65536 [00:01<01:23, 772.12it/s]      2%|2         | 1333/65536 [00:02<01:23, 771.47it/s]      2%|2         | 1411/65536 [00:02<01:23, 769.67it/s]      2%|2         | 1489/65536 [00:02<01:23, 771.48it/s]      2%|2         | 1567/65536 [00:02<01:22, 772.75it/s]      3%|2         | 1646/65536 [00:02<01:22, 775.52it/s]      3%|2         | 1724/65536 [00:02<01:23, 767.30it/s]      3%|2         | 1802/65536 [00:02<01:22, 769.44it/s]      3%|2         | 1879/65536 [00:02<01:22, 768.98it/s]      3%|2         | 1956/65536 [00:02<01:23, 760.41it/s]      3%|3         | 2033/65536 [00:02<01:24, 753.84it/s]      3%|3         | 2109/65536 [00:03<01:24, 751.87it/s]      3%|3         | 2187/65536 [00:03<01:23, 759.45it/s]      3%|3         | 2265/65536 [00:03<01:22, 762.84it/s]      4%|3         | 2342/65536 [00:03<01:22, 761.74it/s]      4%|3         | 2419/65536 [00:03<01:22, 764.17it/s]      4%|3         | 2498/65536 [00:03<01:21, 769.03it/s]      4%|3         | 2577/65536 [00:03<01:21, 773.31it/s]      4%|4         | 2656/65536 [00:03<01:21, 776.27it/s]      4%|4         | 2734/65536 [00:03<01:20, 776.83it/s]      4%|4         | 2813/65536 [00:03<01:20, 778.29it/s]      4%|4         | 2892/65536 [00:04<01:20, 780.54it/s]      5%|4         | 2971/65536 [00:04<01:20, 781.66it/s]      5%|4         | 3050/65536 [00:04<01:20, 779.58it/s]      5%|4         | 3128/65536 [00:04<01:20, 777.54it/s]      5%|4         | 3206/65536 [00:04<01:20, 777.96it/s]      5%|5         | 3285/65536 [00:04<01:19, 779.12it/s]      5%|5         | 3364/65536 [00:04<01:19, 780.00it/s]      5%|5         | 3443/65536 [00:04<01:19, 779.93it/s]      5%|5         | 3522/65536 [00:04<01:19, 780.59it/s]      5%|5         | 3601/65536 [00:04<01:19, 782.62it/s]      6%|5         | 3680/65536 [00:05<01:19, 780.56it/s]      6%|5         | 3759/65536 [00:05<01:19, 780.11it/s]      6%|5         | 3838/65536 [00:05<01:19, 778.44it/s]      6%|5         | 3917/65536 [00:05<01:19, 779.66it/s]      6%|6         | 3996/65536 [00:05<01:18, 779.83it/s]      6%|6         | 4075/65536 [00:05<01:18, 782.23it/s]      6%|6         | 4154/65536 [00:05<01:18, 783.04it/s]      6%|6         | 4233/65536 [00:05<01:18, 783.02it/s]      7%|6         | 4312/65536 [00:05<01:18, 783.45it/s]      7%|6         | 4391/65536 [00:05<01:18, 783.79it/s]      7%|6         | 4470/65536 [00:06<01:18, 779.52it/s]      7%|6         | 4548/65536 [00:06<01:18, 779.13it/s]      7%|7         | 4627/65536 [00:06<01:17, 782.23it/s]      7%|7         | 4707/65536 [00:06<01:17, 785.32it/s]      7%|7         | 4787/65536 [00:06<01:17, 787.15it/s]      7%|7         | 4866/65536 [00:06<01:17, 786.44it/s]      8%|7         | 4945/65536 [00:06<01:17, 784.42it/s]      8%|7         | 5024/65536 [00:06<01:17, 778.71it/s]      8%|7         | 5102/65536 [00:06<01:18, 773.27it/s]      8%|7         | 5180/65536 [00:06<01:18, 772.25it/s]      8%|8         | 5259/65536 [00:07<01:17, 776.78it/s]      8%|8         | 5338/65536 [00:07<01:17, 779.71it/s]      8%|8         | 5416/65536 [00:07<01:17, 774.93it/s]      8%|8         | 5494/65536 [00:07<01:17, 771.56it/s]      9%|8         | 5573/65536 [00:07<01:17, 775.81it/s]      9%|8         | 5652/65536 [00:07<01:16, 779.03it/s]      9%|8         | 5730/65536 [00:07<01:16, 777.96it/s]      9%|8         | 5808/65536 [00:07<01:16, 778.36it/s]      9%|8         | 5886/65536 [00:07<01:16, 774.70it/s]      9%|9         | 5964/65536 [00:08<01:17, 769.80it/s]      9%|9         | 6042/65536 [00:08<01:17, 770.93it/s]      9%|9         | 6121/65536 [00:08<01:16, 774.12it/s]      9%|9         | 6199/65536 [00:08<01:17, 770.49it/s]     10%|9         | 6278/65536 [00:08<01:16, 775.17it/s]     10%|9         | 6357/65536 [00:08<01:16, 777.42it/s]     10%|9         | 6436/65536 [00:08<01:15, 778.93it/s]     10%|9         | 6514/65536 [00:08<01:15, 778.46it/s]     10%|#         | 6592/65536 [00:08<01:15, 778.56it/s]     10%|#         | 6671/65536 [00:08<01:15, 779.87it/s]     10%|#         | 6750/65536 [00:09<01:15, 780.41it/s]     10%|#         | 6829/65536 [00:09<01:15, 781.34it/s]     11%|#         | 6908/65536 [00:09<01:15, 781.07it/s]     11%|#         | 6987/65536 [00:09<01:14, 782.81it/s]     11%|#         | 7066/65536 [00:09<01:15, 775.62it/s]     11%|#         | 7144/65536 [00:09<01:15, 775.58it/s]     11%|#1        | 7222/65536 [00:09<01:15, 768.91it/s]     11%|#1        | 7299/65536 [00:09<01:16, 764.19it/s]     11%|#1        | 7376/65536 [00:09<01:16, 763.58it/s]     11%|#1        | 7454/65536 [00:09<01:15, 767.81it/s]     11%|#1        | 7532/65536 [00:10<01:15, 770.12it/s]     12%|#1        | 7610/65536 [00:10<01:15, 768.81it/s]     12%|#1        | 7687/65536 [00:10<01:15, 768.71it/s]     12%|#1        | 7766/65536 [00:10<01:14, 772.84it/s]     12%|#1        | 7845/65536 [00:10<01:14, 776.28it/s]     12%|#2        | 7924/65536 [00:10<01:13, 778.69it/s]     12%|#2        | 8003/65536 [00:10<01:13, 780.67it/s]     12%|#2        | 8082/65536 [00:10<01:13, 777.22it/s]     12%|#2        | 8160/65536 [00:10<01:13, 775.88it/s]     13%|#2        | 8238/65536 [00:10<01:13, 774.33it/s]     13%|#2        | 8316/65536 [00:11<01:14, 769.80it/s]     13%|#2        | 8394/65536 [00:11<01:14, 770.85it/s]     13%|#2        | 8472/65536 [00:11<01:14, 765.12it/s]     13%|#3        | 8550/65536 [00:11<01:14, 768.72it/s]     13%|#3        | 8629/65536 [00:11<01:13, 772.36it/s]     13%|#3        | 8707/65536 [00:11<01:13, 773.44it/s]     13%|#3        | 8785/65536 [00:11<01:13, 771.69it/s]     14%|#3        | 8863/65536 [00:11<01:13, 769.98it/s]     14%|#3        | 8942/65536 [00:11<01:13, 773.77it/s]     14%|#3        | 9021/65536 [00:11<01:12, 776.29it/s]     14%|#3        | 9100/65536 [00:12<01:12, 778.42it/s]     14%|#4        | 9179/65536 [00:12<01:12, 779.41it/s]     14%|#4        | 9257/65536 [00:12<01:12, 777.52it/s]     14%|#4        | 9335/65536 [00:12<01:12, 776.24it/s]     14%|#4        | 9413/65536 [00:12<01:12, 774.68it/s]     14%|#4        | 9491/65536 [00:12<01:12, 774.27it/s]     15%|#4        | 9569/65536 [00:12<01:12, 773.78it/s]     15%|#4        | 9647/65536 [00:12<01:12, 774.74it/s]     15%|#4        | 9725/65536 [00:12<01:11, 775.58it/s]     15%|#4        | 9803/65536 [00:12<01:11, 776.87it/s]     15%|#5        | 9882/65536 [00:13<01:11, 778.81it/s]     15%|#5        | 9961/65536 [00:13<01:11, 779.46it/s]     15%|#5        | 10040/65536 [00:13<01:11, 781.29it/s]     15%|#5        | 10119/65536 [00:13<01:10, 783.69it/s]     16%|#5        | 10198/65536 [00:13<01:10, 785.54it/s]     16%|#5        | 10277/65536 [00:13<01:10, 781.67it/s]     16%|#5        | 10356/65536 [00:13<01:11, 774.84it/s]     16%|#5        | 10434/65536 [00:13<01:11, 775.11it/s]     16%|#6        | 10513/65536 [00:13<01:10, 776.58it/s]     16%|#6        | 10592/65536 [00:13<01:10, 778.18it/s]     16%|#6        | 10670/65536 [00:14<01:10, 775.79it/s]     16%|#6        | 10748/65536 [00:14<01:10, 774.95it/s]     17%|#6        | 10827/65536 [00:14<01:10, 776.61it/s]     17%|#6        | 10907/65536 [00:14<01:09, 780.82it/s]     17%|#6        | 10986/65536 [00:14<01:09, 783.50it/s]     17%|#6        | 11065/65536 [00:14<01:09, 783.68it/s]     17%|#7        | 11144/65536 [00:14<01:09, 781.52it/s]     17%|#7        | 11223/65536 [00:14<01:09, 783.00it/s]     17%|#7        | 11302/65536 [00:14<01:09, 779.23it/s]     17%|#7        | 11380/65536 [00:14<01:09, 775.10it/s]     17%|#7        | 11458/65536 [00:15<01:10, 772.09it/s]     18%|#7        | 11537/65536 [00:15<01:09, 776.22it/s]     18%|#7        | 11617/65536 [00:15<01:09, 780.64it/s]     18%|#7        | 11697/65536 [00:15<01:08, 783.91it/s]     18%|#7        | 11776/65536 [00:15<01:08, 783.61it/s]     18%|#8        | 11855/65536 [00:15<01:08, 784.26it/s]     18%|#8        | 11934/65536 [00:15<01:08, 784.92it/s]     18%|#8        | 12013/65536 [00:15<01:08, 785.94it/s]     18%|#8        | 12093/65536 [00:15<01:07, 787.18it/s]     19%|#8        | 12172/65536 [00:15<01:07, 787.45it/s]     19%|#8        | 12251/65536 [00:16<01:07, 786.46it/s]     19%|#8        | 12330/65536 [00:16<01:07, 785.37it/s]     19%|#8        | 12409/65536 [00:16<01:07, 785.14it/s]     19%|#9        | 12488/65536 [00:16<01:07, 784.74it/s]     19%|#9        | 12567/65536 [00:16<01:07, 784.15it/s]     19%|#9        | 12646/65536 [00:16<01:07, 784.50it/s]     19%|#9        | 12725/65536 [00:16<01:07, 783.48it/s]     20%|#9        | 12804/65536 [00:16<01:07, 783.05it/s]     20%|#9        | 12883/65536 [00:16<01:07, 782.92it/s]     20%|#9        | 12962/65536 [00:17<01:07, 782.77it/s]     20%|#9        | 13041/65536 [00:17<01:06, 783.97it/s]     20%|##        | 13120/65536 [00:17<01:07, 781.00it/s]     20%|##        | 13199/65536 [00:17<01:07, 776.96it/s]     20%|##        | 13277/65536 [00:17<01:07, 777.85it/s]     20%|##        | 13356/65536 [00:17<01:06, 780.09it/s]     21%|##        | 13435/65536 [00:17<01:06, 782.03it/s]     21%|##        | 13514/65536 [00:17<01:06, 783.40it/s]     21%|##        | 13593/65536 [00:17<01:06, 783.58it/s]     21%|##        | 13672/65536 [00:17<01:06, 784.19it/s]     21%|##        | 13751/65536 [00:18<01:06, 784.34it/s]     21%|##1       | 13830/65536 [00:18<01:05, 784.39it/s]     21%|##1       | 13909/65536 [00:18<01:05, 784.09it/s]     21%|##1       | 13988/65536 [00:18<01:06, 777.51it/s]     21%|##1       | 14066/65536 [00:18<01:06, 772.13it/s]     22%|##1       | 14144/65536 [00:18<01:06, 774.30it/s]     22%|##1       | 14223/65536 [00:18<01:05, 778.24it/s]     22%|##1       | 14302/65536 [00:18<01:05, 780.24it/s]     22%|##1       | 14381/65536 [00:18<01:05, 781.42it/s]     22%|##2       | 14460/65536 [00:18<01:05, 782.52it/s]     22%|##2       | 14539/65536 [00:19<01:05, 783.93it/s]     22%|##2       | 14619/65536 [00:19<01:04, 786.07it/s]     22%|##2       | 14699/65536 [00:19<01:04, 787.97it/s]     23%|##2       | 14778/65536 [00:19<01:04, 783.35it/s]     23%|##2       | 14857/65536 [00:19<01:04, 782.57it/s]     23%|##2       | 14936/65536 [00:19<01:04, 782.03it/s]     23%|##2       | 15015/65536 [00:19<01:04, 782.47it/s]     23%|##3       | 15094/65536 [00:19<01:04, 784.00it/s]     23%|##3       | 15173/65536 [00:19<01:05, 773.03it/s]     23%|##3       | 15251/65536 [00:19<01:05, 772.02it/s]     23%|##3       | 15329/65536 [00:20<01:05, 771.45it/s]     24%|##3       | 15407/65536 [00:20<01:04, 772.01it/s]     24%|##3       | 15485/65536 [00:20<01:04, 773.32it/s]     24%|##3       | 15563/65536 [00:20<01:05, 768.79it/s]     24%|##3       | 15641/65536 [00:20<01:04, 770.56it/s]     24%|##3       | 15720/65536 [00:20<01:04, 774.01it/s]     24%|##4       | 15799/65536 [00:20<01:04, 776.55it/s]     24%|##4       | 15877/65536 [00:20<01:03, 776.24it/s]     24%|##4       | 15956/65536 [00:20<01:03, 777.88it/s]     24%|##4       | 16034/65536 [00:20<01:03, 777.12it/s]     25%|##4       | 16112/65536 [00:21<01:04, 769.04it/s]     25%|##4       | 16190/65536 [00:21<01:04, 770.90it/s]     25%|##4       | 16268/65536 [00:21<01:03, 770.92it/s]     25%|##4       | 16347/65536 [00:21<01:03, 774.60it/s]     25%|##5       | 16426/65536 [00:21<01:03, 778.13it/s]     25%|##5       | 16505/65536 [00:21<01:02, 779.58it/s]     25%|##5       | 16584/65536 [00:21<01:02, 780.30it/s]     25%|##5       | 16663/65536 [00:21<01:02, 782.70it/s]     26%|##5       | 16742/65536 [00:21<01:02, 782.83it/s]     26%|##5       | 16821/65536 [00:21<01:02, 773.55it/s]     26%|##5       | 16899/65536 [00:22<01:03, 769.06it/s]     26%|##5       | 16976/65536 [00:22<01:03, 767.79it/s]     26%|##6       | 17054/65536 [00:22<01:02, 769.61it/s]     26%|##6       | 17133/65536 [00:22<01:02, 774.00it/s]     26%|##6       | 17212/65536 [00:22<01:02, 776.48it/s]     26%|##6       | 17291/65536 [00:22<01:01, 779.86it/s]     27%|##6       | 17369/65536 [00:22<01:01, 779.24it/s]     27%|##6       | 17447/65536 [00:22<01:01, 778.87it/s]     27%|##6       | 17526/65536 [00:22<01:01, 780.26it/s]     27%|##6       | 17605/65536 [00:22<01:01, 780.61it/s]     27%|##6       | 17684/65536 [00:23<01:01, 782.33it/s]     27%|##7       | 17763/65536 [00:23<01:00, 783.43it/s]     27%|##7       | 17842/65536 [00:23<01:00, 783.20it/s]     27%|##7       | 17921/65536 [00:23<01:00, 782.73it/s]     27%|##7       | 18000/65536 [00:23<01:00, 782.75it/s]     28%|##7       | 18079/65536 [00:23<01:00, 781.33it/s]     28%|##7       | 18158/65536 [00:23<01:00, 782.11it/s]     28%|##7       | 18237/65536 [00:23<01:00, 781.79it/s]     28%|##7       | 18316/65536 [00:23<01:00, 782.79it/s]     28%|##8       | 18396/65536 [00:23<01:00, 785.35it/s]     28%|##8       | 18475/65536 [00:24<00:59, 786.20it/s]     28%|##8       | 18554/65536 [00:24<00:59, 785.11it/s]     28%|##8       | 18634/65536 [00:24<00:59, 786.63it/s]     29%|##8       | 18714/65536 [00:24<00:59, 788.16it/s]     29%|##8       | 18794/65536 [00:24<00:59, 788.69it/s]     29%|##8       | 18873/65536 [00:24<00:59, 788.55it/s]     29%|##8       | 18952/65536 [00:24<00:59, 786.02it/s]     29%|##9       | 19031/65536 [00:24<00:59, 781.69it/s]     29%|##9       | 19110/65536 [00:24<00:59, 777.68it/s]     29%|##9       | 19188/65536 [00:24<00:59, 777.34it/s]     29%|##9       | 19267/65536 [00:25<00:59, 778.71it/s]     30%|##9       | 19346/65536 [00:25<00:59, 779.69it/s]     30%|##9       | 19424/65536 [00:25<00:59, 779.42it/s]     30%|##9       | 19503/65536 [00:25<00:58, 780.44it/s]     30%|##9       | 19582/65536 [00:25<00:58, 782.80it/s]     30%|###       | 19661/65536 [00:25<00:58, 784.48it/s]     30%|###       | 19740/65536 [00:25<00:58, 785.16it/s]     30%|###       | 19819/65536 [00:25<00:58, 782.62it/s]     30%|###       | 19898/65536 [00:25<00:58, 781.64it/s]     30%|###       | 19977/65536 [00:25<00:58, 782.83it/s]     31%|###       | 20056/65536 [00:26<00:57, 784.30it/s]     31%|###       | 20135/65536 [00:26<00:57, 783.08it/s]     31%|###       | 20214/65536 [00:26<00:58, 780.46it/s]     31%|###       | 20293/65536 [00:26<00:57, 780.31it/s]     31%|###1      | 20372/65536 [00:26<00:57, 782.40it/s]     31%|###1      | 20451/65536 [00:26<00:57, 782.33it/s]     31%|###1      | 20530/65536 [00:26<00:57, 783.60it/s]     31%|###1      | 20609/65536 [00:26<00:57, 783.63it/s]     32%|###1      | 20688/65536 [00:26<00:57, 783.49it/s]     32%|###1      | 20767/65536 [00:27<00:57, 780.15it/s]     32%|###1      | 20846/65536 [00:27<00:57, 777.20it/s]     32%|###1      | 20924/65536 [00:27<00:57, 776.59it/s]     32%|###2      | 21003/65536 [00:27<00:57, 777.93it/s]     32%|###2      | 21082/65536 [00:27<00:57, 779.30it/s]     32%|###2      | 21160/65536 [00:27<00:57, 778.23it/s]     32%|###2      | 21239/65536 [00:27<00:56, 778.82it/s]     33%|###2      | 21317/65536 [00:27<00:56, 779.14it/s]     33%|###2      | 21396/65536 [00:27<00:56, 781.52it/s]     33%|###2      | 21475/65536 [00:27<00:56, 783.98it/s]     33%|###2      | 21554/65536 [00:28<00:56, 785.20it/s]     33%|###3      | 21633/65536 [00:28<00:55, 785.83it/s]     33%|###3      | 21712/65536 [00:28<00:55, 785.33it/s]     33%|###3      | 21791/65536 [00:28<00:55, 783.43it/s]     33%|###3      | 21870/65536 [00:28<00:55, 782.71it/s]     33%|###3      | 21949/65536 [00:28<00:55, 781.49it/s]     34%|###3      | 22028/65536 [00:28<00:55, 783.58it/s]     34%|###3      | 22107/65536 [00:28<00:55, 785.09it/s]     34%|###3      | 22187/65536 [00:28<00:55, 787.34it/s]     34%|###3      | 22267/65536 [00:28<00:54, 788.90it/s]     34%|###4      | 22346/65536 [00:29<00:54, 789.18it/s]     34%|###4      | 22426/65536 [00:29<00:54, 789.54it/s]     34%|###4      | 22505/65536 [00:29<00:54, 786.99it/s]     34%|###4      | 22584/65536 [00:29<00:54, 787.25it/s]     35%|###4      | 22663/65536 [00:29<00:54, 787.86it/s]     35%|###4      | 22742/65536 [00:29<00:54, 788.02it/s]     35%|###4      | 22822/65536 [00:29<00:54, 788.91it/s]     35%|###4      | 22901/65536 [00:29<00:54, 788.53it/s]     35%|###5      | 22981/65536 [00:29<00:53, 789.45it/s]     35%|###5      | 23060/65536 [00:29<00:53, 789.25it/s]     35%|###5      | 23139/65536 [00:30<00:53, 788.94it/s]     35%|###5      | 23218/65536 [00:30<00:53, 789.07it/s]     36%|###5      | 23297/65536 [00:30<00:53, 786.49it/s]     36%|###5      | 23376/65536 [00:30<00:53, 787.07it/s]     36%|###5      | 23456/65536 [00:30<00:53, 788.03it/s]     36%|###5      | 23535/65536 [00:30<00:53, 786.79it/s]     36%|###6      | 23614/65536 [00:30<00:53, 784.57it/s]     36%|###6      | 23693/65536 [00:30<00:53, 781.24it/s]     36%|###6      | 23772/65536 [00:30<00:53, 782.87it/s]     36%|###6      | 23851/65536 [00:30<00:53, 784.82it/s]     37%|###6      | 23930/65536 [00:31<00:52, 785.39it/s]     37%|###6      | 24009/65536 [00:31<00:52, 784.53it/s]     37%|###6      | 24088/65536 [00:31<00:53, 779.87it/s]     37%|###6      | 24166/65536 [00:31<00:53, 779.56it/s]     37%|###6      | 24245/65536 [00:31<00:52, 780.54it/s]     37%|###7      | 24324/65536 [00:31<00:52, 781.42it/s]     37%|###7      | 24403/65536 [00:31<00:52, 782.49it/s]     37%|###7      | 24482/65536 [00:31<00:52, 782.23it/s]     37%|###7      | 24561/65536 [00:31<00:52, 783.39it/s]     38%|###7      | 24640/65536 [00:31<00:52, 784.52it/s]     38%|###7      | 24719/65536 [00:32<00:52, 784.51it/s]     38%|###7      | 24798/65536 [00:32<00:51, 785.33it/s]     38%|###7      | 24877/65536 [00:32<00:51, 784.39it/s]     38%|###8      | 24956/65536 [00:32<00:51, 784.48it/s]     38%|###8      | 25035/65536 [00:32<00:51, 784.85it/s]     38%|###8      | 25114/65536 [00:32<00:51, 785.11it/s]     38%|###8      | 25193/65536 [00:32<00:51, 784.77it/s]     39%|###8      | 25272/65536 [00:32<00:51, 781.87it/s]     39%|###8      | 25351/65536 [00:32<00:51, 781.68it/s]     39%|###8      | 25430/65536 [00:32<00:51, 782.50it/s]     39%|###8      | 25509/65536 [00:33<00:51, 784.12it/s]     39%|###9      | 25588/65536 [00:33<00:50, 785.36it/s]     39%|###9      | 25667/65536 [00:33<00:50, 783.76it/s]     39%|###9      | 25747/65536 [00:33<00:50, 786.12it/s]     39%|###9      | 25827/65536 [00:33<00:50, 787.54it/s]     40%|###9      | 25906/65536 [00:33<00:50, 786.48it/s]     40%|###9      | 25985/65536 [00:33<00:50, 785.69it/s]     40%|###9      | 26064/65536 [00:33<00:50, 786.32it/s]     40%|###9      | 26143/65536 [00:33<00:50, 786.31it/s]     40%|####      | 26222/65536 [00:33<00:49, 786.33it/s]     40%|####      | 26301/65536 [00:34<00:49, 786.18it/s]     40%|####      | 26380/65536 [00:34<00:49, 785.06it/s]     40%|####      | 26459/65536 [00:34<00:49, 784.02it/s]     40%|####      | 26538/65536 [00:34<00:49, 785.25it/s]     41%|####      | 26617/65536 [00:34<00:49, 786.58it/s]     41%|####      | 26696/65536 [00:34<00:49, 785.40it/s]     41%|####      | 26775/65536 [00:34<00:49, 784.06it/s]     41%|####      | 26854/65536 [00:34<00:49, 783.45it/s]     41%|####1     | 26933/65536 [00:34<00:49, 785.39it/s]     41%|####1     | 27013/65536 [00:34<00:48, 787.28it/s]     41%|####1     | 27092/65536 [00:35<00:48, 787.72it/s]     41%|####1     | 27171/65536 [00:35<00:48, 787.37it/s]     42%|####1     | 27250/65536 [00:35<00:48, 788.05it/s]     42%|####1     | 27330/65536 [00:35<00:48, 789.14it/s]     42%|####1     | 27410/65536 [00:35<00:48, 789.93it/s]     42%|####1     | 27490/65536 [00:35<00:48, 789.99it/s]     42%|####2     | 27569/65536 [00:35<00:48, 788.93it/s]     42%|####2     | 27648/65536 [00:35<00:48, 787.45it/s]     42%|####2     | 27727/65536 [00:35<00:48, 787.64it/s]     42%|####2     | 27806/65536 [00:35<00:47, 787.11it/s]     43%|####2     | 27885/65536 [00:36<00:47, 787.66it/s]     43%|####2     | 27964/65536 [00:36<00:47, 786.87it/s]     43%|####2     | 28043/65536 [00:36<00:47, 785.32it/s]     43%|####2     | 28122/65536 [00:36<00:47, 783.42it/s]     43%|####3     | 28201/65536 [00:36<00:47, 781.98it/s]     43%|####3     | 28280/65536 [00:36<00:47, 782.32it/s]     43%|####3     | 28359/65536 [00:36<00:47, 782.00it/s]     43%|####3     | 28438/65536 [00:36<00:47, 782.95it/s]     44%|####3     | 28517/65536 [00:36<00:47, 783.98it/s]     44%|####3     | 28596/65536 [00:36<00:47, 784.41it/s]     44%|####3     | 28675/65536 [00:37<00:46, 784.85it/s]     44%|####3     | 28754/65536 [00:37<00:46, 783.46it/s]     44%|####3     | 28833/65536 [00:37<00:46, 784.21it/s]     44%|####4     | 28913/65536 [00:37<00:46, 786.48it/s]     44%|####4     | 28993/65536 [00:37<00:46, 788.02it/s]     44%|####4     | 29072/65536 [00:37<00:46, 787.60it/s]     44%|####4     | 29151/65536 [00:37<00:46, 781.39it/s]     45%|####4     | 29230/65536 [00:37<00:46, 781.93it/s]     45%|####4     | 29309/65536 [00:37<00:46, 782.91it/s]     45%|####4     | 29388/65536 [00:37<00:46, 783.89it/s]     45%|####4     | 29467/65536 [00:38<00:46, 782.62it/s]     45%|####5     | 29546/65536 [00:38<00:46, 782.16it/s]     45%|####5     | 29625/65536 [00:38<00:45, 782.96it/s]     45%|####5     | 29704/65536 [00:38<00:45, 784.96it/s]     45%|####5     | 29783/65536 [00:38<00:45, 786.15it/s]     46%|####5     | 29862/65536 [00:38<00:45, 786.76it/s]     46%|####5     | 29941/65536 [00:38<00:45, 785.43it/s]     46%|####5     | 30020/65536 [00:38<00:45, 785.68it/s]     46%|####5     | 30099/65536 [00:38<00:45, 785.87it/s]     46%|####6     | 30178/65536 [00:38<00:44, 786.14it/s]     46%|####6     | 30257/65536 [00:39<00:44, 787.15it/s]     46%|####6     | 30336/65536 [00:39<00:44, 784.87it/s]     46%|####6     | 30415/65536 [00:39<00:44, 784.75it/s]     47%|####6     | 30494/65536 [00:39<00:44, 785.72it/s]     47%|####6     | 30573/65536 [00:39<00:44, 785.98it/s]     47%|####6     | 30652/65536 [00:39<00:44, 786.09it/s]     47%|####6     | 30731/65536 [00:39<00:44, 785.85it/s]     47%|####7     | 30810/65536 [00:39<00:44, 786.48it/s]     47%|####7     | 30890/65536 [00:39<00:43, 788.24it/s]     47%|####7     | 30970/65536 [00:40<00:43, 789.52it/s]     47%|####7     | 31050/65536 [00:40<00:43, 790.42it/s]     48%|####7     | 31130/65536 [00:40<00:43, 788.66it/s]     48%|####7     | 31209/65536 [00:40<00:43, 787.95it/s]     48%|####7     | 31289/65536 [00:40<00:43, 788.66it/s]     48%|####7     | 31369/65536 [00:40<00:43, 789.31it/s]     48%|####7     | 31449/65536 [00:40<00:43, 789.86it/s]     48%|####8     | 31528/65536 [00:40<00:43, 787.79it/s]     48%|####8     | 31608/65536 [00:40<00:43, 788.85it/s]     48%|####8     | 31688/65536 [00:40<00:42, 789.56it/s]     48%|####8     | 31767/65536 [00:41<00:42, 789.07it/s]     49%|####8     | 31846/65536 [00:41<00:42, 788.21it/s]     49%|####8     | 31925/65536 [00:41<00:42, 786.45it/s]     49%|####8     | 32005/65536 [00:41<00:42, 787.92it/s]     49%|####8     | 32085/65536 [00:41<00:42, 789.01it/s]     49%|####9     | 32165/65536 [00:41<00:42, 789.56it/s]     49%|####9     | 32245/65536 [00:41<00:42, 790.21it/s]     49%|####9     | 32325/65536 [00:41<00:42, 785.93it/s]     49%|####9     | 32404/65536 [00:41<00:42, 786.11it/s]     50%|####9     | 32483/65536 [00:41<00:42, 786.66it/s]     50%|####9     | 32562/65536 [00:42<00:41, 785.83it/s]     50%|####9     | 32641/65536 [00:42<00:41, 783.77it/s]     50%|####9     | 32720/65536 [00:42<00:41, 781.93it/s]     50%|#####     | 32799/65536 [00:42<00:41, 782.48it/s]     50%|#####     | 32878/65536 [00:42<00:41, 782.96it/s]     50%|#####     | 32957/65536 [00:42<00:41, 783.24it/s]     50%|#####     | 33036/65536 [00:42<00:41, 783.77it/s]     51%|#####     | 33115/65536 [00:42<00:41, 783.46it/s]     51%|#####     | 33194/65536 [00:42<00:41, 782.68it/s]     51%|#####     | 33273/65536 [00:42<00:41, 782.10it/s]     51%|#####     | 33352/65536 [00:43<00:41, 781.26it/s]     51%|#####1    | 33431/65536 [00:43<00:41, 782.81it/s]     51%|#####1    | 33510/65536 [00:43<00:41, 780.43it/s]     51%|#####1    | 33590/65536 [00:43<00:40, 783.40it/s]     51%|#####1    | 33670/65536 [00:43<00:40, 785.82it/s]     51%|#####1    | 33749/65536 [00:43<00:40, 786.09it/s]     52%|#####1    | 33828/65536 [00:43<00:40, 786.03it/s]     52%|#####1    | 33907/65536 [00:43<00:40, 783.76it/s]     52%|#####1    | 33986/65536 [00:43<00:40, 783.65it/s]     52%|#####1    | 34065/65536 [00:43<00:40, 783.36it/s]     52%|#####2    | 34144/65536 [00:44<00:40, 780.71it/s]     52%|#####2    | 34223/65536 [00:44<00:40, 782.52it/s]     52%|#####2    | 34302/65536 [00:44<00:39, 783.86it/s]     52%|#####2    | 34381/65536 [00:44<00:39, 785.51it/s]     53%|#####2    | 34461/65536 [00:44<00:39, 786.95it/s]     53%|#####2    | 34540/65536 [00:44<00:39, 787.31it/s]     53%|#####2    | 34620/65536 [00:44<00:39, 788.08it/s]     53%|#####2    | 34699/65536 [00:44<00:39, 785.13it/s]     53%|#####3    | 34778/65536 [00:44<00:39, 784.65it/s]     53%|#####3    | 34857/65536 [00:44<00:39, 785.14it/s]     53%|#####3    | 34936/65536 [00:45<00:38, 786.12it/s]     53%|#####3    | 35015/65536 [00:45<00:38, 787.06it/s]     54%|#####3    | 35094/65536 [00:45<00:38, 787.37it/s]     54%|#####3    | 35173/65536 [00:45<00:38, 787.93it/s]     54%|#####3    | 35252/65536 [00:45<00:38, 788.38it/s]     54%|#####3    | 35331/65536 [00:45<00:38, 786.67it/s]     54%|#####4    | 35410/65536 [00:45<00:38, 783.90it/s]     54%|#####4    | 35489/65536 [00:45<00:38, 782.37it/s]     54%|#####4    | 35568/65536 [00:45<00:38, 783.93it/s]     54%|#####4    | 35647/65536 [00:45<00:38, 783.93it/s]     55%|#####4    | 35726/65536 [00:46<00:37, 785.39it/s]     55%|#####4    | 35805/65536 [00:46<00:37, 786.59it/s]     55%|#####4    | 35884/65536 [00:46<00:37, 787.48it/s]     55%|#####4    | 35964/65536 [00:46<00:37, 788.25it/s]     55%|#####4    | 36044/65536 [00:46<00:37, 788.90it/s]     55%|#####5    | 36123/65536 [00:46<00:37, 788.84it/s]     55%|#####5    | 36202/65536 [00:46<00:37, 789.18it/s]     55%|#####5    | 36281/65536 [00:46<00:37, 788.33it/s]     55%|#####5    | 36360/65536 [00:46<00:37, 786.65it/s]     56%|#####5    | 36439/65536 [00:46<00:37, 785.54it/s]     56%|#####5    | 36518/65536 [00:47<00:36, 784.91it/s]     56%|#####5    | 36597/65536 [00:47<00:36, 785.92it/s]     56%|#####5    | 36676/65536 [00:47<00:36, 787.00it/s]     56%|#####6    | 36756/65536 [00:47<00:36, 788.04it/s]     56%|#####6    | 36836/65536 [00:47<00:36, 788.73it/s]     56%|#####6    | 36915/65536 [00:47<00:36, 787.80it/s]     56%|#####6    | 36994/65536 [00:47<00:36, 785.74it/s]     57%|#####6    | 37074/65536 [00:47<00:36, 787.14it/s]     57%|#####6    | 37154/65536 [00:47<00:36, 788.02it/s]     57%|#####6    | 37234/65536 [00:47<00:35, 788.98it/s]     57%|#####6    | 37313/65536 [00:48<00:35, 789.19it/s]     57%|#####7    | 37392/65536 [00:48<00:35, 782.99it/s]     57%|#####7    | 37471/65536 [00:48<00:35, 782.83it/s]     57%|#####7    | 37550/65536 [00:48<00:35, 781.44it/s]     57%|#####7    | 37629/65536 [00:48<00:35, 781.87it/s]     58%|#####7    | 37708/65536 [00:48<00:35, 782.43it/s]     58%|#####7    | 37787/65536 [00:48<00:35, 781.92it/s]     58%|#####7    | 37866/65536 [00:48<00:35, 782.26it/s]     58%|#####7    | 37945/65536 [00:48<00:35, 783.07it/s]     58%|#####8    | 38024/65536 [00:48<00:35, 783.76it/s]     58%|#####8    | 38103/65536 [00:49<00:35, 783.78it/s]     58%|#####8    | 38182/65536 [00:49<00:34, 782.74it/s]     58%|#####8    | 38262/65536 [00:49<00:34, 785.43it/s]     59%|#####8    | 38342/65536 [00:49<00:34, 787.81it/s]     59%|#####8    | 38421/65536 [00:49<00:34, 788.44it/s]     59%|#####8    | 38500/65536 [00:49<00:34, 786.58it/s]     59%|#####8    | 38579/65536 [00:49<00:34, 783.35it/s]     59%|#####8    | 38658/65536 [00:49<00:34, 772.19it/s]     59%|#####9    | 38736/65536 [00:49<00:35, 765.39it/s]     59%|#####9    | 38813/65536 [00:50<00:35, 759.36it/s]     59%|#####9    | 38889/65536 [00:50<00:35, 757.23it/s]     59%|#####9    | 38965/65536 [00:50<00:35, 756.58it/s]     60%|#####9    | 39041/65536 [00:50<00:35, 753.89it/s]     60%|#####9    | 39118/65536 [00:50<00:34, 758.62it/s]     60%|#####9    | 39196/65536 [00:50<00:34, 762.67it/s]     60%|#####9    | 39273/65536 [00:50<00:34, 764.80it/s]     60%|######    | 39350/65536 [00:50<00:34, 764.82it/s]     60%|######    | 39427/65536 [00:50<00:34, 762.99it/s]     60%|######    | 39506/65536 [00:50<00:33, 769.41it/s]     60%|######    | 39584/65536 [00:51<00:33, 771.56it/s]     61%|######    | 39662/65536 [00:51<00:33, 762.95it/s]     61%|######    | 39739/65536 [00:51<00:34, 755.86it/s]     61%|######    | 39815/65536 [00:51<00:34, 746.64it/s]     61%|######    | 39890/65536 [00:51<00:34, 745.61it/s]     61%|######    | 39965/65536 [00:51<00:34, 743.71it/s]     61%|######1   | 40040/65536 [00:51<00:34, 745.18it/s]     61%|######1   | 40116/65536 [00:51<00:33, 748.45it/s]     61%|######1   | 40193/65536 [00:51<00:33, 754.53it/s]     61%|######1   | 40269/65536 [00:51<00:33, 750.85it/s]     62%|######1   | 40346/65536 [00:52<00:33, 755.81it/s]     62%|######1   | 40424/65536 [00:52<00:32, 762.69it/s]     62%|######1   | 40502/65536 [00:52<00:32, 767.23it/s]     62%|######1   | 40581/65536 [00:52<00:32, 773.13it/s]     62%|######2   | 40659/65536 [00:52<00:32, 767.66it/s]     62%|######2   | 40737/65536 [00:52<00:32, 769.31it/s]     62%|######2   | 40816/65536 [00:52<00:31, 773.10it/s]     62%|######2   | 40894/65536 [00:52<00:31, 773.79it/s]     63%|######2   | 40972/65536 [00:52<00:31, 774.39it/s]     63%|######2   | 41050/65536 [00:52<00:31, 773.10it/s]     63%|######2   | 41128/65536 [00:53<00:31, 771.69it/s]     63%|######2   | 41207/65536 [00:53<00:31, 774.67it/s]     63%|######2   | 41286/65536 [00:53<00:31, 777.17it/s]     63%|######3   | 41366/65536 [00:53<00:30, 781.46it/s]     63%|######3   | 41445/65536 [00:53<00:30, 778.19it/s]     63%|######3   | 41523/65536 [00:53<00:30, 776.19it/s]     63%|######3   | 41601/65536 [00:53<00:30, 773.63it/s]     64%|######3   | 41679/65536 [00:53<00:30, 770.61it/s]     64%|######3   | 41758/65536 [00:53<00:30, 774.56it/s]     64%|######3   | 41837/65536 [00:53<00:30, 777.28it/s]     64%|######3   | 41916/65536 [00:54<00:30, 779.07it/s]     64%|######4   | 41994/65536 [00:54<00:30, 772.46it/s]     64%|######4   | 42072/65536 [00:54<00:30, 773.77it/s]     64%|######4   | 42151/65536 [00:54<00:30, 777.14it/s]     64%|######4   | 42230/65536 [00:54<00:29, 779.84it/s]     65%|######4   | 42309/65536 [00:54<00:29, 781.58it/s]     65%|######4   | 42388/65536 [00:54<00:29, 783.73it/s]     65%|######4   | 42467/65536 [00:54<00:29, 783.97it/s]     65%|######4   | 42547/65536 [00:54<00:29, 786.12it/s]     65%|######5   | 42626/65536 [00:54<00:29, 786.69it/s]     65%|######5   | 42705/65536 [00:55<00:29, 785.58it/s]     65%|######5   | 42784/65536 [00:55<00:29, 779.67it/s]     65%|######5   | 42862/65536 [00:55<00:29, 777.17it/s]     66%|######5   | 42941/65536 [00:55<00:29, 778.74it/s]     66%|######5   | 43020/65536 [00:55<00:28, 779.33it/s]     66%|######5   | 43099/65536 [00:55<00:28, 780.29it/s]     66%|######5   | 43178/65536 [00:55<00:28, 780.89it/s]     66%|######6   | 43257/65536 [00:55<00:28, 775.17it/s]     66%|######6   | 43336/65536 [00:55<00:28, 778.10it/s]     66%|######6   | 43415/65536 [00:55<00:28, 779.78it/s]     66%|######6   | 43494/65536 [00:56<00:28, 780.18it/s]     66%|######6   | 43573/65536 [00:56<00:28, 780.50it/s]     67%|######6   | 43652/65536 [00:56<00:27, 782.53it/s]     67%|######6   | 43731/65536 [00:56<00:27, 784.41it/s]     67%|######6   | 43811/65536 [00:56<00:27, 786.17it/s]     67%|######6   | 43890/65536 [00:56<00:27, 785.56it/s]     67%|######7   | 43969/65536 [00:56<00:27, 784.79it/s]     67%|######7   | 44048/65536 [00:56<00:27, 784.56it/s]     67%|######7   | 44127/65536 [00:56<00:27, 784.66it/s]     67%|######7   | 44206/65536 [00:56<00:27, 785.04it/s]     68%|######7   | 44285/65536 [00:57<00:27, 786.16it/s]     68%|######7   | 44364/65536 [00:57<00:26, 785.40it/s]     68%|######7   | 44443/65536 [00:57<00:26, 784.33it/s]     68%|######7   | 44522/65536 [00:57<00:26, 784.30it/s]     68%|######8   | 44601/65536 [00:57<00:26, 783.89it/s]     68%|######8   | 44680/65536 [00:57<00:26, 781.75it/s]     68%|######8   | 44759/65536 [00:57<00:26, 782.32it/s]     68%|######8   | 44838/65536 [00:57<00:26, 781.85it/s]     69%|######8   | 44917/65536 [00:57<00:26, 782.20it/s]     69%|######8   | 44996/65536 [00:57<00:26, 782.65it/s]     69%|######8   | 45075/65536 [00:58<00:26, 782.64it/s]     69%|######8   | 45154/65536 [00:58<00:26, 783.35it/s]     69%|######9   | 45233/65536 [00:58<00:25, 782.65it/s]     69%|######9   | 45312/65536 [00:58<00:25, 782.33it/s]     69%|######9   | 45391/65536 [00:58<00:25, 781.95it/s]     69%|######9   | 45470/65536 [00:58<00:25, 782.08it/s]     70%|######9   | 45549/65536 [00:58<00:25, 781.17it/s]     70%|######9   | 45628/65536 [00:58<00:25, 781.78it/s]     70%|######9   | 45707/65536 [00:58<00:25, 782.34it/s]     70%|######9   | 45786/65536 [00:59<00:25, 782.69it/s]     70%|######9   | 45866/65536 [00:59<00:25, 786.26it/s]     70%|#######   | 45945/65536 [00:59<00:24, 785.73it/s]     70%|#######   | 46024/65536 [00:59<00:24, 784.95it/s]     70%|#######   | 46103/65536 [00:59<00:24, 780.89it/s]     70%|#######   | 46182/65536 [00:59<00:24, 779.50it/s]     71%|#######   | 46261/65536 [00:59<00:24, 779.80it/s]     71%|#######   | 46339/65536 [00:59<00:24, 778.27it/s]     71%|#######   | 46418/65536 [00:59<00:24, 781.04it/s]     71%|#######   | 46497/65536 [00:59<00:24, 782.06it/s]     71%|#######1  | 46576/65536 [01:00<00:24, 782.04it/s]     71%|#######1  | 46655/65536 [01:00<00:24, 781.62it/s]     71%|#######1  | 46734/65536 [01:00<00:24, 780.97it/s]     71%|#######1  | 46813/65536 [01:00<00:24, 779.97it/s]     72%|#######1  | 46891/65536 [01:00<00:24, 773.97it/s]     72%|#######1  | 46970/65536 [01:00<00:23, 777.29it/s]     72%|#######1  | 47049/65536 [01:00<00:23, 779.39it/s]     72%|#######1  | 47128/65536 [01:00<00:23, 781.84it/s]     72%|#######2  | 47207/65536 [01:00<00:23, 766.68it/s]     72%|#######2  | 47284/65536 [01:00<00:23, 761.91it/s]     72%|#######2  | 47361/65536 [01:01<00:24, 756.90it/s]     72%|#######2  | 47438/65536 [01:01<00:23, 760.05it/s]     73%|#######2  | 47516/65536 [01:01<00:23, 763.10it/s]     73%|#######2  | 47593/65536 [01:01<00:23, 762.09it/s]     73%|#######2  | 47670/65536 [01:01<00:23, 763.78it/s]     73%|#######2  | 47748/65536 [01:01<00:23, 767.84it/s]     73%|#######2  | 47827/65536 [01:01<00:22, 774.37it/s]     73%|#######3  | 47906/65536 [01:01<00:22, 778.19it/s]     73%|#######3  | 47984/65536 [01:01<00:22, 778.30it/s]     73%|#######3  | 48063/65536 [01:01<00:22, 778.95it/s]     73%|#######3  | 48142/65536 [01:02<00:22, 781.40it/s]     74%|#######3  | 48221/65536 [01:02<00:22, 782.54it/s]     74%|#######3  | 48300/65536 [01:02<00:22, 781.24it/s]     74%|#######3  | 48379/65536 [01:02<00:22, 771.74it/s]     74%|#######3  | 48457/65536 [01:02<00:22, 770.54it/s]     74%|#######4  | 48535/65536 [01:02<00:22, 769.72it/s]     74%|#######4  | 48612/65536 [01:02<00:22, 765.95it/s]     74%|#######4  | 48689/65536 [01:02<00:22, 764.21it/s]     74%|#######4  | 48768/65536 [01:02<00:21, 770.77it/s]     75%|#######4  | 48848/65536 [01:02<00:21, 776.75it/s]     75%|#######4  | 48927/65536 [01:03<00:21, 780.49it/s]     75%|#######4  | 49007/65536 [01:03<00:21, 783.91it/s]     75%|#######4  | 49086/65536 [01:03<00:21, 782.62it/s]     75%|#######5  | 49165/65536 [01:03<00:21, 774.14it/s]     75%|#######5  | 49243/65536 [01:03<00:21, 767.82it/s]     75%|#######5  | 49320/65536 [01:03<00:21, 766.52it/s]     75%|#######5  | 49397/65536 [01:03<00:21, 753.03it/s]     75%|#######5  | 49473/65536 [01:03<00:21, 753.20it/s]     76%|#######5  | 49550/65536 [01:03<00:21, 756.17it/s]     76%|#######5  | 49628/65536 [01:03<00:20, 761.21it/s]     76%|#######5  | 49705/65536 [01:04<00:20, 761.89it/s]     76%|#######5  | 49783/65536 [01:04<00:20, 764.74it/s]     76%|#######6  | 49860/65536 [01:04<00:20, 764.40it/s]     76%|#######6  | 49938/65536 [01:04<00:20, 766.17it/s]     76%|#######6  | 50015/65536 [01:04<00:20, 765.97it/s]     76%|#######6  | 50092/65536 [01:04<00:20, 766.15it/s]     77%|#######6  | 50169/65536 [01:04<00:20, 759.10it/s]     77%|#######6  | 50245/65536 [01:04<00:20, 757.35it/s]     77%|#######6  | 50321/65536 [01:04<00:20, 757.68it/s]     77%|#######6  | 50397/65536 [01:04<00:20, 752.98it/s]     77%|#######7  | 50473/65536 [01:05<00:20, 748.21it/s]     77%|#######7  | 50548/65536 [01:05<00:20, 745.24it/s]     77%|#######7  | 50623/65536 [01:05<00:20, 738.89it/s]     77%|#######7  | 50697/65536 [01:05<00:20, 735.97it/s]     77%|#######7  | 50771/65536 [01:05<00:20, 734.13it/s]     78%|#######7  | 50845/65536 [01:05<00:20, 733.87it/s]     78%|#######7  | 50919/65536 [01:05<00:19, 734.78it/s]     78%|#######7  | 50996/65536 [01:05<00:19, 744.48it/s]     78%|#######7  | 51072/65536 [01:05<00:19, 746.89it/s]     78%|#######8  | 51148/65536 [01:06<00:19, 750.78it/s]     78%|#######8  | 51226/65536 [01:06<00:18, 758.50it/s]     78%|#######8  | 51302/65536 [01:06<00:18, 756.65it/s]     78%|#######8  | 51381/65536 [01:06<00:18, 765.13it/s]     79%|#######8  | 51460/65536 [01:06<00:18, 772.18it/s]     79%|#######8  | 51539/65536 [01:06<00:18, 776.88it/s]     79%|#######8  | 51618/65536 [01:06<00:17, 778.83it/s]     79%|#######8  | 51696/65536 [01:06<00:18, 766.10it/s]     79%|#######8  | 51773/65536 [01:06<00:18, 761.16it/s]     79%|#######9  | 51850/65536 [01:06<00:17, 760.65it/s]     79%|#######9  | 51927/65536 [01:07<00:18, 753.93it/s]     79%|#######9  | 52005/65536 [01:07<00:17, 760.15it/s]     79%|#######9  | 52082/65536 [01:07<00:17, 762.54it/s]     80%|#######9  | 52159/65536 [01:07<00:17, 763.86it/s]     80%|#######9  | 52237/65536 [01:07<00:17, 767.31it/s]     80%|#######9  | 52314/65536 [01:07<00:17, 767.24it/s]     80%|#######9  | 52393/65536 [01:07<00:17, 771.89it/s]     80%|########  | 52471/65536 [01:07<00:17, 767.96it/s]     80%|########  | 52548/65536 [01:07<00:16, 768.40it/s]     80%|########  | 52626/65536 [01:07<00:16, 770.19it/s]     80%|########  | 52704/65536 [01:08<00:16, 767.35it/s]     81%|########  | 52783/65536 [01:08<00:16, 772.19it/s]     81%|########  | 52861/65536 [01:08<00:16, 768.68it/s]     81%|########  | 52938/65536 [01:08<00:16, 767.49it/s]     81%|########  | 53015/65536 [01:08<00:16, 767.88it/s]     81%|########1 | 53093/65536 [01:08<00:16, 769.23it/s]     81%|########1 | 53171/65536 [01:08<00:16, 771.65it/s]     81%|########1 | 53250/65536 [01:08<00:15, 774.47it/s]     81%|########1 | 53328/65536 [01:08<00:15, 774.72it/s]     81%|########1 | 53406/65536 [01:08<00:15, 774.07it/s]     82%|########1 | 53484/65536 [01:09<00:15, 775.17it/s]     82%|########1 | 53562/65536 [01:09<00:15, 769.71it/s]     82%|########1 | 53639/65536 [01:09<00:15, 763.76it/s]     82%|########1 | 53716/65536 [01:09<00:15, 762.00it/s]     82%|########2 | 53793/65536 [01:09<00:15, 762.38it/s]     82%|########2 | 53871/65536 [01:09<00:15, 766.60it/s]     82%|########2 | 53948/65536 [01:09<00:15, 765.17it/s]     82%|########2 | 54026/65536 [01:09<00:14, 768.23it/s]     83%|########2 | 54103/65536 [01:09<00:14, 768.72it/s]     83%|########2 | 54181/65536 [01:09<00:14, 771.10it/s]     83%|########2 | 54260/65536 [01:10<00:14, 773.86it/s]     83%|########2 | 54339/65536 [01:10<00:14, 776.64it/s]     83%|########3 | 54417/65536 [01:10<00:14, 772.44it/s]     83%|########3 | 54495/65536 [01:10<00:14, 769.28it/s]     83%|########3 | 54572/65536 [01:10<00:14, 763.59it/s]     83%|########3 | 54649/65536 [01:10<00:14, 757.15it/s]     84%|########3 | 54726/65536 [01:10<00:14, 760.08it/s]     84%|########3 | 54803/65536 [01:10<00:14, 762.18it/s]     84%|########3 | 54880/65536 [01:10<00:14, 756.39it/s]     84%|########3 | 54956/65536 [01:10<00:14, 751.24it/s]     84%|########3 | 55032/65536 [01:11<00:14, 749.23it/s]     84%|########4 | 55109/65536 [01:11<00:13, 754.85it/s]     84%|########4 | 55188/65536 [01:11<00:13, 762.59it/s]     84%|########4 | 55267/65536 [01:11<00:13, 769.31it/s]     84%|########4 | 55346/65536 [01:11<00:13, 774.26it/s]     85%|########4 | 55425/65536 [01:11<00:13, 777.23it/s]     85%|########4 | 55504/65536 [01:11<00:12, 780.86it/s]     85%|########4 | 55583/65536 [01:11<00:12, 783.51it/s]     85%|########4 | 55662/65536 [01:11<00:12, 770.48it/s]     85%|########5 | 55740/65536 [01:11<00:12, 764.68it/s]     85%|########5 | 55817/65536 [01:12<00:12, 763.20it/s]     85%|########5 | 55894/65536 [01:12<00:12, 755.92it/s]     85%|########5 | 55972/65536 [01:12<00:12, 762.20it/s]     86%|########5 | 56049/65536 [01:12<00:12, 761.03it/s]     86%|########5 | 56127/65536 [01:12<00:12, 763.85it/s]     86%|########5 | 56206/65536 [01:12<00:12, 771.25it/s]     86%|########5 | 56285/65536 [01:12<00:11, 775.33it/s]     86%|########6 | 56364/65536 [01:12<00:11, 779.60it/s]     86%|########6 | 56442/65536 [01:12<00:11, 776.66it/s]     86%|########6 | 56520/65536 [01:12<00:11, 772.96it/s]     86%|########6 | 56598/65536 [01:13<00:11, 766.28it/s]     86%|########6 | 56675/65536 [01:13<00:11, 761.78it/s]     87%|########6 | 56752/65536 [01:13<00:11, 757.43it/s]     87%|########6 | 56828/65536 [01:13<00:11, 754.48it/s]     87%|########6 | 56905/65536 [01:13<00:11, 757.70it/s]     87%|########6 | 56981/65536 [01:13<00:11, 756.07it/s]     87%|########7 | 57057/65536 [01:13<00:11, 754.27it/s]     87%|########7 | 57135/65536 [01:13<00:11, 759.95it/s]     87%|########7 | 57213/65536 [01:13<00:10, 764.58it/s]     87%|########7 | 57291/65536 [01:14<00:10, 767.32it/s]     88%|########7 | 57368/65536 [01:14<00:10, 766.53it/s]     88%|########7 | 57445/65536 [01:14<00:10, 766.68it/s]     88%|########7 | 57523/65536 [01:14<00:10, 769.57it/s]     88%|########7 | 57602/65536 [01:14<00:10, 773.17it/s]     88%|########8 | 57681/65536 [01:14<00:10, 777.65it/s]     88%|########8 | 57760/65536 [01:14<00:09, 780.91it/s]     88%|########8 | 57839/65536 [01:14<00:09, 780.55it/s]     88%|########8 | 57918/65536 [01:14<00:09, 781.41it/s]     88%|########8 | 57997/65536 [01:14<00:09, 781.29it/s]     89%|########8 | 58076/65536 [01:15<00:09, 780.35it/s]     89%|########8 | 58155/65536 [01:15<00:09, 780.17it/s]     89%|########8 | 58234/65536 [01:15<00:09, 780.97it/s]     89%|########8 | 58313/65536 [01:15<00:09, 778.06it/s]     89%|########9 | 58391/65536 [01:15<00:09, 776.61it/s]     89%|########9 | 58469/65536 [01:15<00:09, 776.35it/s]     89%|########9 | 58548/65536 [01:15<00:08, 778.39it/s]     89%|########9 | 58627/65536 [01:15<00:08, 781.00it/s]     90%|########9 | 58706/65536 [01:15<00:08, 777.60it/s]     90%|########9 | 58784/65536 [01:15<00:08, 776.06it/s]     90%|########9 | 58862/65536 [01:16<00:08, 775.66it/s]     90%|########9 | 58940/65536 [01:16<00:08, 776.83it/s]     90%|######### | 59018/65536 [01:16<00:08, 775.68it/s]     90%|######### | 59096/65536 [01:16<00:08, 774.98it/s]     90%|######### | 59174/65536 [01:16<00:08, 774.15it/s]     90%|######### | 59252/65536 [01:16<00:08, 775.33it/s]     91%|######### | 59331/65536 [01:16<00:07, 777.39it/s]     91%|######### | 59410/65536 [01:16<00:07, 779.12it/s]     91%|######### | 59489/65536 [01:16<00:07, 780.24it/s]     91%|######### | 59568/65536 [01:16<00:07, 776.88it/s]     91%|#########1| 59646/65536 [01:17<00:07, 777.24it/s]     91%|#########1| 59724/65536 [01:17<00:07, 775.48it/s]     91%|#########1| 59803/65536 [01:17<00:07, 777.63it/s]     91%|#########1| 59882/65536 [01:17<00:07, 780.15it/s]     91%|#########1| 59961/65536 [01:17<00:07, 782.63it/s]     92%|#########1| 60040/65536 [01:17<00:07, 783.27it/s]     92%|#########1| 60119/65536 [01:17<00:06, 783.52it/s]     92%|#########1| 60198/65536 [01:17<00:06, 784.26it/s]     92%|#########1| 60277/65536 [01:17<00:06, 784.10it/s]     92%|#########2| 60356/65536 [01:17<00:06, 784.63it/s]     92%|#########2| 60435/65536 [01:18<00:06, 786.09it/s]     92%|#########2| 60514/65536 [01:18<00:06, 785.12it/s]     92%|#########2| 60593/65536 [01:18<00:06, 781.60it/s]     93%|#########2| 60672/65536 [01:18<00:06, 777.22it/s]     93%|#########2| 60750/65536 [01:18<00:06, 777.59it/s]     93%|#########2| 60828/65536 [01:18<00:06, 777.34it/s]     93%|#########2| 60906/65536 [01:18<00:05, 775.81it/s]     93%|#########3| 60984/65536 [01:18<00:05, 775.06it/s]     93%|#########3| 61062/65536 [01:18<00:05, 775.54it/s]     93%|#########3| 61141/65536 [01:18<00:05, 778.26it/s]     93%|#########3| 61220/65536 [01:19<00:05, 781.72it/s]     94%|#########3| 61300/65536 [01:19<00:05, 784.35it/s]     94%|#########3| 61379/65536 [01:19<00:05, 782.25it/s]     94%|#########3| 61458/65536 [01:19<00:05, 783.10it/s]     94%|#########3| 61537/65536 [01:19<00:05, 784.34it/s]     94%|#########4| 61616/65536 [01:19<00:05, 783.03it/s]     94%|#########4| 61695/65536 [01:19<00:04, 782.97it/s]     94%|#########4| 61774/65536 [01:19<00:04, 781.80it/s]     94%|#########4| 61853/65536 [01:19<00:04, 778.28it/s]     95%|#########4| 61932/65536 [01:19<00:04, 779.11it/s]     95%|#########4| 62010/65536 [01:20<00:04, 774.34it/s]     95%|#########4| 62088/65536 [01:20<00:04, 775.03it/s]     95%|#########4| 62166/65536 [01:20<00:04, 773.67it/s]     95%|#########4| 62244/65536 [01:20<00:04, 773.45it/s]     95%|#########5| 62322/65536 [01:20<00:04, 774.47it/s]     95%|#########5| 62401/65536 [01:20<00:04, 777.27it/s]     95%|#########5| 62479/65536 [01:20<00:03, 776.00it/s]     95%|#########5| 62557/65536 [01:20<00:03, 776.18it/s]     96%|#########5| 62635/65536 [01:20<00:03, 775.72it/s]     96%|#########5| 62713/65536 [01:20<00:03, 776.16it/s]     96%|#########5| 62792/65536 [01:21<00:03, 778.89it/s]     96%|#########5| 62871/65536 [01:21<00:03, 781.36it/s]     96%|#########6| 62950/65536 [01:21<00:03, 781.40it/s]     96%|#########6| 63029/65536 [01:21<00:03, 780.96it/s]     96%|#########6| 63108/65536 [01:21<00:03, 780.42it/s]     96%|#########6| 63187/65536 [01:21<00:03, 779.03it/s]     97%|#########6| 63266/65536 [01:21<00:02, 778.94it/s]     97%|#########6| 63344/65536 [01:21<00:02, 767.76it/s]     97%|#########6| 63423/65536 [01:21<00:02, 771.62it/s]     97%|#########6| 63501/65536 [01:21<00:02, 773.06it/s]     97%|#########7| 63579/65536 [01:22<00:02, 767.06it/s]     97%|#########7| 63657/65536 [01:22<00:02, 770.02it/s]     97%|#########7| 63736/65536 [01:22<00:02, 773.20it/s]     97%|#########7| 63814/65536 [01:22<00:02, 774.61it/s]     97%|#########7| 63893/65536 [01:22<00:02, 776.45it/s]     98%|#########7| 63972/65536 [01:22<00:02, 778.40it/s]     98%|#########7| 64051/65536 [01:22<00:01, 780.15it/s]     98%|#########7| 64130/65536 [01:22<00:01, 781.42it/s]     98%|#########7| 64209/65536 [01:22<00:01, 776.16it/s]     98%|#########8| 64288/65536 [01:23<00:01, 778.71it/s]     98%|#########8| 64367/65536 [01:23<00:01, 781.60it/s]     98%|#########8| 64447/65536 [01:23<00:01, 784.33it/s]     98%|#########8| 64527/65536 [01:23<00:01, 786.30it/s]     99%|#########8| 64606/65536 [01:23<00:01, 784.35it/s]     99%|#########8| 64685/65536 [01:23<00:01, 783.87it/s]     99%|#########8| 64764/65536 [01:23<00:00, 783.56it/s]     99%|#########8| 64843/65536 [01:23<00:00, 782.87it/s]     99%|#########9| 64922/65536 [01:23<00:00, 782.41it/s]     99%|#########9| 65001/65536 [01:23<00:00, 782.48it/s]     99%|#########9| 65080/65536 [01:24<00:00, 783.54it/s]     99%|#########9| 65159/65536 [01:24<00:00, 783.83it/s]    100%|#########9| 65238/65536 [01:24<00:00, 785.45it/s]    100%|#########9| 65317/65536 [01:24<00:00, 786.34it/s]    100%|#########9| 65396/65536 [01:24<00:00, 781.40it/s]    100%|#########9| 65475/65536 [01:24<00:00, 779.68it/s]    100%|##########| 65536/65536 [01:24<00:00, 774.69it/s]




.. GENERATED FROM PYTHON SOURCE LINES 131-136

Print training statistics and plot training error
-------------------------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 136-139

.. code-block:: default

    print(calibrator.stats())
    calibrator.plot_test_accuracy()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :alt: Training error
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Number of training samples: 4194304
            Number of filter coefficients: 2560
            Largets / smallest training error: 1.3e-04 / 1.8e-10
            Number of gradient evaluations: 4194304
            Calibration Time: 1.2e-02 [s]
        




.. GENERATED FROM PYTHON SOURCE LINES 140-143

Extract testing estimate
-------------------------


.. GENERATED FROM PYTHON SOURCE LINES 143-145

.. code-block:: default

    u_hat = calibrator.test(size)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/16896 [00:00<?, ?it/s]     34%|###3      | 5739/16896 [00:00<00:00, 57384.86it/s]     69%|######9   | 11711/16896 [00:00<00:00, 58752.52it/s]    100%|##########| 16896/16896 [00:00<00:00, 59125.96it/s]




.. GENERATED FROM PYTHON SOURCE LINES 146-149

Visualise PSD of testing data
-----------------------------


.. GENERATED FROM PYTHON SOURCE LINES 149-219

.. code-block:: default


    # uncalibrated
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_uncalibrated[:],
        fs=1 / digital_control.clock.T,
        nperseg=u_hat_cut_uncalibrated.size,
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Uncalibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Ref
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_ref[:], fs=1 / digital_control.clock.T, nperseg=u_hat_cut_ref.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Ref, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Calibrated Est
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat[:], fs=1 / digital_control.clock.T, nperseg=u_hat.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Calibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    plt.title("Power spectral density of input estimate")
    plt.xlabel('Hz')
    plt.ylabel('$V^2$ / Hz dB')
    plt.legend()
    plt.grid(which="both")
    plt.gcf().tight_layout()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :alt: Power spectral density of input estimate
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  50.041 seconds)


.. _sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_h_calibrating_from_numpy_simulator.py <plot_h_calibrating_from_numpy_simulator.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_h_calibrating_from_numpy_simulator.ipynb <plot_h_calibrating_from_numpy_simulator.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
