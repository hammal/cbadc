
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorials/b_high_level_simulation/plot_h_calibrating_from_numpy_simulator.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


Calibrating an Unknown Op-Amp Pole from Data
============================================

.. GENERATED FROM PYTHON SOURCE LINES 6-11

.. code-block:: default

    import cbadc
    import numpy as np
    import matplotlib.pyplot as plt
    import copy








.. GENERATED FROM PYTHON SOURCE LINES 12-15

Setup proxy simulators from numpy data
--------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 15-27

.. code-block:: default

    specification_false = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_FALSE.dict')
    specification_ref = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_TRUE.dict')
    T = specification_ref['T']
    BW = specification_ref['fc']
    N = specification_false['N']
    M = N + 1

    ctrl_bits_test_uncalibrated = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_ref = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_cal = cbadc.simulator.NumpySimulator('op-amp_data/s_test.npy')
    ctrl_bits_train = cbadc.simulator.NumpySimulator('op-amp_data/s_train.npy')








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Instantiate Analog Systems, Digital Controls, and Nominal FIR Filters
----------------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 31-73

.. code-block:: default


    analog_system = cbadc.analog_system.AnalogSystem(
        specification_false['A'],
        specification_false['B'],
        np.eye(specification_false['N']),
        specification_false['Gamma'],
        specification_false['Gamma'].transpose(),
    )
    analog_system_ref = cbadc.analog_system.AnalogSystem(
        specification_ref['A'],
        specification_ref['B'],
        np.eye(specification_ref['N']),
        specification_ref['Gamma'],
        specification_ref['Gamma'].transpose(),
    )

    digital_control = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_false['T']), M
    )
    digital_control_ref = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_ref['T']), M
    )

    eta2 = (
        np.linalg.norm(
            analog_system_ref.transfer_function_matrix(
                np.array([2 * np.pi * specification_ref['fc']])
            )
        )
        ** 2
    )
    K1 = 1 << 8
    K2 = K1

    fir_filter = cbadc.digital_estimator.FIRFilter(
        analog_system, digital_control, eta2, K1, K2
    )

    fir_filter_ref = cbadc.digital_estimator.FIRFilter(
        analog_system_ref, digital_control_ref, eta2, K1, K2
    )








.. GENERATED FROM PYTHON SOURCE LINES 74-77

Setup testing simulations for verification
---------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 77-95

.. code-block:: default


    # Ref
    uncalibrated_filter = copy.deepcopy(fir_filter)
    uncalibrated_filter(ctrl_bits_test_uncalibrated)


    fir_filter_ref(ctrl_bits_test_ref)


    size = 1 << 14
    u_hat_ref = np.zeros(size)
    u_hat_uncalibrated = np.zeros(size)
    for index in range(size):
        u_hat_ref[index] = next(fir_filter_ref)
        u_hat_uncalibrated[index] = next(uncalibrated_filter)
    u_hat_cut_ref = u_hat_ref[K1 + K2 :]
    u_hat_cut_uncalibrated = u_hat_uncalibrated[K1 + K2 :]








.. GENERATED FROM PYTHON SOURCE LINES 96-99

Instantiate adaptive filter and set buffer training data size
-------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 99-104

.. code-block:: default

    training_data_size = 1 << 15 - 1
    adaptive_filter = cbadc.digital_estimator.AdaptiveFilter(
        fir_filter, 0, training_data_size
    )








.. GENERATED FROM PYTHON SOURCE LINES 105-108

Instantiate the training instance
----------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 108-112

.. code-block:: default

    calibrator = cbadc.digital_calibration.Calibration(
        adaptive_filter, ctrl_bits_train, ctrl_bits_test_cal
    )








.. GENERATED FROM PYTHON SOURCE LINES 113-118

Train adaptive filter
----------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 118-125

.. code-block:: default

    epochs = 1 << 16
    step_size = lambda x: 1e-1 / ((1 + x ** (0.01)))
    batch_size = 1 << 6

    calibrator.compute_step_size_template()
    calibrator.train(epochs, step_size, batch_size, stochastic_delay=0)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/65536 [00:00<?, ?it/s]      0%|          | 1/65536 [00:00<6:00:07,  3.03it/s]      0%|          | 77/65536 [00:00<04:43, 231.01it/s]      0%|          | 154/65536 [00:00<02:46, 392.30it/s]      0%|          | 232/65536 [00:00<02:08, 507.69it/s]      0%|          | 310/65536 [00:00<01:50, 588.09it/s]      1%|          | 388/65536 [00:00<01:41, 644.93it/s]      1%|          | 465/65536 [00:00<01:35, 682.10it/s]      1%|          | 542/65536 [00:01<01:31, 706.85it/s]      1%|          | 618/65536 [00:01<01:29, 721.37it/s]      1%|1         | 694/65536 [00:01<01:28, 731.89it/s]      1%|1         | 770/65536 [00:01<01:27, 739.60it/s]      1%|1         | 847/65536 [00:01<01:26, 748.68it/s]      1%|1         | 924/65536 [00:01<01:25, 752.27it/s]      2%|1         | 1001/65536 [00:01<01:25, 754.84it/s]      2%|1         | 1078/65536 [00:01<01:25, 757.78it/s]      2%|1         | 1157/65536 [00:01<01:24, 764.51it/s]      2%|1         | 1236/65536 [00:01<01:23, 770.48it/s]      2%|2         | 1315/65536 [00:02<01:22, 774.96it/s]      2%|2         | 1394/65536 [00:02<01:22, 777.77it/s]      2%|2         | 1473/65536 [00:02<01:22, 779.90it/s]      2%|2         | 1552/65536 [00:02<01:21, 781.13it/s]      2%|2         | 1631/65536 [00:02<01:22, 777.09it/s]      3%|2         | 1709/65536 [00:02<01:22, 773.21it/s]      3%|2         | 1787/65536 [00:02<01:22, 770.07it/s]      3%|2         | 1865/65536 [00:02<01:22, 767.95it/s]      3%|2         | 1942/65536 [00:02<01:22, 766.76it/s]      3%|3         | 2020/65536 [00:02<01:22, 769.02it/s]      3%|3         | 2099/65536 [00:03<01:21, 774.14it/s]      3%|3         | 2178/65536 [00:03<01:21, 778.50it/s]      3%|3         | 2257/65536 [00:03<01:21, 779.60it/s]      4%|3         | 2336/65536 [00:03<01:20, 781.03it/s]      4%|3         | 2415/65536 [00:03<01:20, 781.53it/s]      4%|3         | 2494/65536 [00:03<01:21, 776.73it/s]      4%|3         | 2572/65536 [00:03<01:21, 773.08it/s]      4%|4         | 2650/65536 [00:03<01:21, 771.06it/s]      4%|4         | 2728/65536 [00:03<01:21, 769.10it/s]      4%|4         | 2806/65536 [00:03<01:21, 771.77it/s]      4%|4         | 2884/65536 [00:04<01:21, 769.97it/s]      5%|4         | 2962/65536 [00:04<01:21, 768.64it/s]      5%|4         | 3039/65536 [00:04<01:21, 768.31it/s]      5%|4         | 3116/65536 [00:04<01:21, 768.33it/s]      5%|4         | 3194/65536 [00:04<01:20, 770.42it/s]      5%|4         | 3272/65536 [00:04<01:20, 773.19it/s]      5%|5         | 3351/65536 [00:04<01:20, 777.22it/s]      5%|5         | 3430/65536 [00:04<01:19, 779.32it/s]      5%|5         | 3509/65536 [00:04<01:19, 779.62it/s]      5%|5         | 3587/65536 [00:04<01:19, 776.72it/s]      6%|5         | 3665/65536 [00:05<01:20, 773.01it/s]      6%|5         | 3743/65536 [00:05<01:20, 770.72it/s]      6%|5         | 3821/65536 [00:05<01:19, 772.76it/s]      6%|5         | 3900/65536 [00:05<01:19, 775.28it/s]      6%|6         | 3978/65536 [00:05<01:19, 772.76it/s]      6%|6         | 4057/65536 [00:05<01:19, 776.22it/s]      6%|6         | 4136/65536 [00:05<01:18, 779.52it/s]      6%|6         | 4215/65536 [00:05<01:18, 781.69it/s]      7%|6         | 4294/65536 [00:05<01:18, 781.56it/s]      7%|6         | 4373/65536 [00:05<01:18, 781.16it/s]      7%|6         | 4452/65536 [00:06<01:18, 776.31it/s]      7%|6         | 4530/65536 [00:06<01:18, 772.94it/s]      7%|7         | 4608/65536 [00:06<01:19, 770.76it/s]      7%|7         | 4686/65536 [00:06<01:18, 772.30it/s]      7%|7         | 4765/65536 [00:06<01:18, 776.76it/s]      7%|7         | 4844/65536 [00:06<01:17, 779.97it/s]      8%|7         | 4923/65536 [00:06<01:17, 782.12it/s]      8%|7         | 5003/65536 [00:06<01:17, 784.52it/s]      8%|7         | 5082/65536 [00:06<01:16, 785.93it/s]      8%|7         | 5161/65536 [00:06<01:17, 782.32it/s]      8%|7         | 5240/65536 [00:07<01:17, 777.52it/s]      8%|8         | 5318/65536 [00:07<01:17, 774.30it/s]      8%|8         | 5396/65536 [00:07<01:17, 771.73it/s]      8%|8         | 5474/65536 [00:07<01:17, 772.57it/s]      8%|8         | 5554/65536 [00:07<01:17, 778.12it/s]      9%|8         | 5634/65536 [00:07<01:16, 781.97it/s]      9%|8         | 5713/65536 [00:07<01:16, 779.81it/s]      9%|8         | 5791/65536 [00:07<01:16, 776.58it/s]      9%|8         | 5869/65536 [00:07<01:17, 774.24it/s]      9%|9         | 5947/65536 [00:08<01:17, 773.16it/s]      9%|9         | 6025/65536 [00:08<01:17, 771.42it/s]      9%|9         | 6103/65536 [00:08<01:17, 769.66it/s]      9%|9         | 6181/65536 [00:08<01:16, 771.99it/s]     10%|9         | 6259/65536 [00:08<01:16, 771.51it/s]     10%|9         | 6337/65536 [00:08<01:16, 771.25it/s]     10%|9         | 6415/65536 [00:08<01:16, 770.91it/s]     10%|9         | 6493/65536 [00:08<01:16, 770.54it/s]     10%|#         | 6571/65536 [00:08<01:16, 769.64it/s]     10%|#         | 6649/65536 [00:08<01:16, 772.34it/s]     10%|#         | 6728/65536 [00:09<01:15, 776.75it/s]     10%|#         | 6807/65536 [00:09<01:15, 779.74it/s]     11%|#         | 6886/65536 [00:09<01:15, 781.81it/s]     11%|#         | 6965/65536 [00:09<01:14, 783.48it/s]     11%|#         | 7044/65536 [00:09<01:14, 782.09it/s]     11%|#         | 7123/65536 [00:09<01:15, 778.02it/s]     11%|#         | 7201/65536 [00:09<01:15, 775.03it/s]     11%|#1        | 7279/65536 [00:09<01:15, 773.44it/s]     11%|#1        | 7357/65536 [00:09<01:15, 772.35it/s]     11%|#1        | 7435/65536 [00:09<01:15, 771.18it/s]     11%|#1        | 7513/65536 [00:10<01:15, 771.87it/s]     12%|#1        | 7592/65536 [00:10<01:14, 776.09it/s]     12%|#1        | 7671/65536 [00:10<01:14, 778.53it/s]     12%|#1        | 7750/65536 [00:10<01:13, 781.04it/s]     12%|#1        | 7829/65536 [00:10<01:13, 782.31it/s]     12%|#2        | 7908/65536 [00:10<01:13, 782.29it/s]     12%|#2        | 7987/65536 [00:10<01:13, 778.94it/s]     12%|#2        | 8065/65536 [00:10<01:14, 774.66it/s]     12%|#2        | 8143/65536 [00:10<01:14, 771.07it/s]     13%|#2        | 8222/65536 [00:10<01:13, 774.70it/s]     13%|#2        | 8300/65536 [00:11<01:14, 773.07it/s]     13%|#2        | 8378/65536 [00:11<01:14, 772.04it/s]     13%|#2        | 8456/65536 [00:11<01:14, 769.32it/s]     13%|#3        | 8533/65536 [00:11<01:14, 768.84it/s]     13%|#3        | 8612/65536 [00:11<01:13, 773.40it/s]     13%|#3        | 8691/65536 [00:11<01:13, 776.40it/s]     13%|#3        | 8769/65536 [00:11<01:13, 775.47it/s]     13%|#3        | 8847/65536 [00:11<01:13, 773.80it/s]     14%|#3        | 8925/65536 [00:11<01:13, 771.71it/s]     14%|#3        | 9003/65536 [00:11<01:13, 770.18it/s]     14%|#3        | 9081/65536 [00:12<01:13, 769.27it/s]     14%|#3        | 9158/65536 [00:12<01:13, 768.51it/s]     14%|#4        | 9235/65536 [00:12<01:13, 768.30it/s]     14%|#4        | 9312/65536 [00:12<01:13, 768.32it/s]     14%|#4        | 9389/65536 [00:12<01:13, 767.55it/s]     14%|#4        | 9466/65536 [00:12<01:13, 766.74it/s]     15%|#4        | 9543/65536 [00:12<01:13, 765.98it/s]     15%|#4        | 9620/65536 [00:12<01:13, 765.75it/s]     15%|#4        | 9697/65536 [00:12<01:12, 765.36it/s]     15%|#4        | 9775/65536 [00:12<01:12, 767.07it/s]     15%|#5        | 9852/65536 [00:13<01:12, 767.82it/s]     15%|#5        | 9929/65536 [00:13<01:12, 765.21it/s]     15%|#5        | 10006/65536 [00:13<01:12, 763.76it/s]     15%|#5        | 10083/65536 [00:13<01:12, 763.84it/s]     16%|#5        | 10160/65536 [00:13<01:12, 759.33it/s]     16%|#5        | 10236/65536 [00:13<01:13, 756.00it/s]     16%|#5        | 10313/65536 [00:13<01:12, 757.85it/s]     16%|#5        | 10389/65536 [00:13<01:12, 758.27it/s]     16%|#5        | 10466/65536 [00:13<01:12, 761.32it/s]     16%|#6        | 10543/65536 [00:13<01:12, 755.62it/s]     16%|#6        | 10619/65536 [00:14<01:13, 751.36it/s]     16%|#6        | 10695/65536 [00:14<01:12, 752.36it/s]     16%|#6        | 10771/65536 [00:14<01:12, 752.71it/s]     17%|#6        | 10847/65536 [00:14<01:12, 754.66it/s]     17%|#6        | 10923/65536 [00:14<01:12, 755.22it/s]     17%|#6        | 10999/65536 [00:14<01:12, 753.81it/s]     17%|#6        | 11075/65536 [00:14<01:12, 754.96it/s]     17%|#7        | 11151/65536 [00:14<01:12, 754.71it/s]     17%|#7        | 11228/65536 [00:14<01:11, 757.51it/s]     17%|#7        | 11306/65536 [00:14<01:11, 761.56it/s]     17%|#7        | 11383/65536 [00:15<01:10, 763.46it/s]     17%|#7        | 11460/65536 [00:15<01:10, 764.98it/s]     18%|#7        | 11538/65536 [00:15<01:10, 767.08it/s]     18%|#7        | 11616/65536 [00:15<01:10, 769.42it/s]     18%|#7        | 11694/65536 [00:15<01:09, 771.01it/s]     18%|#7        | 11772/65536 [00:15<01:09, 769.86it/s]     18%|#8        | 11849/65536 [00:15<01:09, 768.93it/s]     18%|#8        | 11926/65536 [00:15<01:09, 768.30it/s]     18%|#8        | 12003/65536 [00:15<01:09, 768.08it/s]     18%|#8        | 12082/65536 [00:15<01:09, 771.77it/s]     19%|#8        | 12160/65536 [00:16<01:09, 772.81it/s]     19%|#8        | 12239/65536 [00:16<01:08, 775.09it/s]     19%|#8        | 12318/65536 [00:16<01:08, 778.67it/s]     19%|#8        | 12397/65536 [00:16<01:08, 780.80it/s]     19%|#9        | 12476/65536 [00:16<01:08, 778.15it/s]     19%|#9        | 12554/65536 [00:16<01:08, 774.45it/s]     19%|#9        | 12632/65536 [00:16<01:08, 776.00it/s]     19%|#9        | 12710/65536 [00:16<01:08, 776.56it/s]     20%|#9        | 12788/65536 [00:16<01:07, 777.57it/s]     20%|#9        | 12867/65536 [00:17<01:07, 780.43it/s]     20%|#9        | 12946/65536 [00:17<01:07, 782.40it/s]     20%|#9        | 13025/65536 [00:17<01:06, 784.12it/s]     20%|#9        | 13104/65536 [00:17<01:07, 780.47it/s]     20%|##        | 13183/65536 [00:17<01:07, 778.35it/s]     20%|##        | 13261/65536 [00:17<01:07, 777.71it/s]     20%|##        | 13339/65536 [00:17<01:07, 775.56it/s]     20%|##        | 13417/65536 [00:17<01:07, 773.33it/s]     21%|##        | 13495/65536 [00:17<01:07, 770.30it/s]     21%|##        | 13573/65536 [00:17<01:07, 768.29it/s]     21%|##        | 13650/65536 [00:18<01:07, 768.73it/s]     21%|##        | 13728/65536 [00:18<01:07, 770.22it/s]     21%|##1       | 13806/65536 [00:18<01:07, 769.57it/s]     21%|##1       | 13883/65536 [00:18<01:07, 769.34it/s]     21%|##1       | 13960/65536 [00:18<01:07, 768.53it/s]     21%|##1       | 14037/65536 [00:18<01:07, 767.76it/s]     22%|##1       | 14114/65536 [00:18<01:06, 767.72it/s]     22%|##1       | 14191/65536 [00:18<01:06, 768.19it/s]     22%|##1       | 14269/65536 [00:18<01:06, 769.89it/s]     22%|##1       | 14346/65536 [00:18<01:06, 769.84it/s]     22%|##2       | 14424/65536 [00:19<01:06, 770.41it/s]     22%|##2       | 14502/65536 [00:19<01:06, 770.49it/s]     22%|##2       | 14580/65536 [00:19<01:06, 770.47it/s]     22%|##2       | 14658/65536 [00:19<01:06, 770.48it/s]     22%|##2       | 14736/65536 [00:19<01:05, 770.49it/s]     23%|##2       | 14814/65536 [00:19<01:05, 771.30it/s]     23%|##2       | 14892/65536 [00:19<01:05, 772.28it/s]     23%|##2       | 14970/65536 [00:19<01:05, 772.17it/s]     23%|##2       | 15048/65536 [00:19<01:05, 772.79it/s]     23%|##3       | 15127/65536 [00:19<01:04, 776.55it/s]     23%|##3       | 15205/65536 [00:20<01:04, 776.42it/s]     23%|##3       | 15283/65536 [00:20<01:04, 774.49it/s]     23%|##3       | 15361/65536 [00:20<01:04, 771.97it/s]     24%|##3       | 15439/65536 [00:20<01:05, 769.97it/s]     24%|##3       | 15516/65536 [00:20<01:05, 768.40it/s]     24%|##3       | 15593/65536 [00:20<01:05, 767.76it/s]     24%|##3       | 15672/65536 [00:20<01:04, 773.10it/s]     24%|##4       | 15751/65536 [00:20<01:04, 776.67it/s]     24%|##4       | 15830/65536 [00:20<01:03, 779.50it/s]     24%|##4       | 15909/65536 [00:20<01:03, 781.53it/s]     24%|##4       | 15988/65536 [00:21<01:03, 782.87it/s]     25%|##4       | 16067/65536 [00:21<01:03, 783.89it/s]     25%|##4       | 16146/65536 [00:21<01:02, 784.75it/s]     25%|##4       | 16225/65536 [00:21<01:02, 785.39it/s]     25%|##4       | 16304/65536 [00:21<01:02, 785.65it/s]     25%|##4       | 16383/65536 [00:21<01:02, 785.58it/s]     25%|##5       | 16462/65536 [00:21<01:02, 785.87it/s]     25%|##5       | 16541/65536 [00:21<01:02, 785.77it/s]     25%|##5       | 16620/65536 [00:21<01:02, 785.51it/s]     25%|##5       | 16699/65536 [00:21<01:02, 785.07it/s]     26%|##5       | 16778/65536 [00:22<01:02, 784.93it/s]     26%|##5       | 16857/65536 [00:22<01:02, 785.09it/s]     26%|##5       | 16936/65536 [00:22<01:01, 785.42it/s]     26%|##5       | 17015/65536 [00:22<01:01, 784.96it/s]     26%|##6       | 17094/65536 [00:22<01:01, 782.31it/s]     26%|##6       | 17173/65536 [00:22<01:01, 783.30it/s]     26%|##6       | 17252/65536 [00:22<01:01, 783.12it/s]     26%|##6       | 17331/65536 [00:22<01:01, 778.60it/s]     27%|##6       | 17409/65536 [00:22<01:02, 775.84it/s]     27%|##6       | 17487/65536 [00:22<01:02, 773.57it/s]     27%|##6       | 17565/65536 [00:23<01:02, 771.71it/s]     27%|##6       | 17643/65536 [00:23<01:02, 770.64it/s]     27%|##7       | 17721/65536 [00:23<01:02, 769.33it/s]     27%|##7       | 17799/65536 [00:23<01:01, 771.73it/s]     27%|##7       | 17877/65536 [00:23<01:01, 773.52it/s]     27%|##7       | 17956/65536 [00:23<01:01, 775.87it/s]     28%|##7       | 18034/65536 [00:23<01:01, 774.27it/s]     28%|##7       | 18112/65536 [00:23<01:01, 772.87it/s]     28%|##7       | 18190/65536 [00:23<01:01, 771.94it/s]     28%|##7       | 18268/65536 [00:23<01:01, 771.32it/s]     28%|##7       | 18346/65536 [00:24<01:01, 770.69it/s]     28%|##8       | 18424/65536 [00:24<01:01, 771.60it/s]     28%|##8       | 18502/65536 [00:24<01:00, 771.71it/s]     28%|##8       | 18581/65536 [00:24<01:00, 776.05it/s]     28%|##8       | 18660/65536 [00:24<01:00, 779.30it/s]     29%|##8       | 18739/65536 [00:24<00:59, 781.91it/s]     29%|##8       | 18818/65536 [00:24<00:59, 783.93it/s]     29%|##8       | 18897/65536 [00:24<00:59, 784.60it/s]     29%|##8       | 18976/65536 [00:24<00:59, 784.09it/s]     29%|##9       | 19055/65536 [00:24<00:59, 779.35it/s]     29%|##9       | 19133/65536 [00:25<00:59, 776.34it/s]     29%|##9       | 19211/65536 [00:25<00:59, 774.19it/s]     29%|##9       | 19289/65536 [00:25<00:59, 771.99it/s]     30%|##9       | 19367/65536 [00:25<00:59, 773.08it/s]     30%|##9       | 19445/65536 [00:25<00:59, 772.10it/s]     30%|##9       | 19523/65536 [00:25<00:59, 772.93it/s]     30%|##9       | 19602/65536 [00:25<00:59, 777.09it/s]     30%|###       | 19681/65536 [00:25<00:58, 780.06it/s]     30%|###       | 19760/65536 [00:25<00:58, 781.86it/s]     30%|###       | 19839/65536 [00:25<00:58, 782.99it/s]     30%|###       | 19918/65536 [00:26<00:58, 783.59it/s]     31%|###       | 19997/65536 [00:26<00:58, 784.39it/s]     31%|###       | 20076/65536 [00:26<00:57, 785.22it/s]     31%|###       | 20155/65536 [00:26<00:57, 784.71it/s]     31%|###       | 20234/65536 [00:26<00:57, 784.09it/s]     31%|###       | 20313/65536 [00:26<00:57, 785.24it/s]     31%|###1      | 20392/65536 [00:26<00:57, 786.30it/s]     31%|###1      | 20471/65536 [00:26<00:57, 786.92it/s]     31%|###1      | 20550/65536 [00:26<00:57, 786.82it/s]     31%|###1      | 20629/65536 [00:26<00:57, 783.17it/s]     32%|###1      | 20708/65536 [00:27<00:57, 778.45it/s]     32%|###1      | 20786/65536 [00:27<00:57, 775.56it/s]     32%|###1      | 20864/65536 [00:27<00:57, 773.38it/s]     32%|###1      | 20942/65536 [00:27<00:57, 774.84it/s]     32%|###2      | 21021/65536 [00:27<00:57, 778.33it/s]     32%|###2      | 21100/65536 [00:27<00:56, 780.61it/s]     32%|###2      | 21179/65536 [00:27<00:56, 782.59it/s]     32%|###2      | 21258/65536 [00:27<00:56, 784.04it/s]     33%|###2      | 21337/65536 [00:27<00:56, 782.67it/s]     33%|###2      | 21416/65536 [00:28<00:56, 777.91it/s]     33%|###2      | 21494/65536 [00:28<00:56, 774.70it/s]     33%|###2      | 21572/65536 [00:28<00:56, 772.29it/s]     33%|###3      | 21650/65536 [00:28<00:57, 769.89it/s]     33%|###3      | 21727/65536 [00:28<00:56, 769.22it/s]     33%|###3      | 21804/65536 [00:28<00:56, 768.98it/s]     33%|###3      | 21881/65536 [00:28<00:56, 768.16it/s]     34%|###3      | 21958/65536 [00:28<00:56, 768.61it/s]     34%|###3      | 22036/65536 [00:28<00:56, 771.26it/s]     34%|###3      | 22114/65536 [00:28<00:56, 772.59it/s]     34%|###3      | 22192/65536 [00:29<00:56, 771.72it/s]     34%|###3      | 22270/65536 [00:29<00:56, 770.49it/s]     34%|###4      | 22348/65536 [00:29<00:56, 770.03it/s]     34%|###4      | 22426/65536 [00:29<00:55, 769.84it/s]     34%|###4      | 22504/65536 [00:29<00:55, 770.71it/s]     34%|###4      | 22582/65536 [00:29<00:55, 769.97it/s]     35%|###4      | 22659/65536 [00:29<00:55, 769.24it/s]     35%|###4      | 22736/65536 [00:29<00:55, 768.48it/s]     35%|###4      | 22813/65536 [00:29<00:55, 768.50it/s]     35%|###4      | 22891/65536 [00:29<00:55, 770.76it/s]     35%|###5      | 22969/65536 [00:30<00:55, 770.20it/s]     35%|###5      | 23048/65536 [00:30<00:54, 775.47it/s]     35%|###5      | 23127/65536 [00:30<00:54, 778.81it/s]     35%|###5      | 23206/65536 [00:30<00:54, 781.07it/s]     36%|###5      | 23285/65536 [00:30<00:54, 779.50it/s]     36%|###5      | 23363/65536 [00:30<00:54, 776.85it/s]     36%|###5      | 23441/65536 [00:30<00:54, 775.38it/s]     36%|###5      | 23519/65536 [00:30<00:54, 774.09it/s]     36%|###6      | 23597/65536 [00:30<00:54, 772.77it/s]     36%|###6      | 23676/65536 [00:30<00:53, 775.36it/s]     36%|###6      | 23754/65536 [00:31<00:53, 775.77it/s]     36%|###6      | 23832/65536 [00:31<00:53, 776.38it/s]     36%|###6      | 23910/65536 [00:31<00:53, 773.78it/s]     37%|###6      | 23988/65536 [00:31<00:53, 771.91it/s]     37%|###6      | 24067/65536 [00:31<00:53, 775.53it/s]     37%|###6      | 24146/65536 [00:31<00:53, 778.84it/s]     37%|###6      | 24225/65536 [00:31<00:52, 781.13it/s]     37%|###7      | 24304/65536 [00:31<00:52, 782.79it/s]     37%|###7      | 24383/65536 [00:31<00:52, 784.16it/s]     37%|###7      | 24462/65536 [00:31<00:52, 780.62it/s]     37%|###7      | 24541/65536 [00:32<00:52, 776.16it/s]     38%|###7      | 24619/65536 [00:32<00:52, 773.22it/s]     38%|###7      | 24697/65536 [00:32<00:52, 771.72it/s]     38%|###7      | 24775/65536 [00:32<00:52, 770.43it/s]     38%|###7      | 24854/65536 [00:32<00:52, 774.11it/s]     38%|###8      | 24932/65536 [00:32<00:52, 771.92it/s]     38%|###8      | 25010/65536 [00:32<00:52, 770.33it/s]     38%|###8      | 25088/65536 [00:32<00:52, 769.28it/s]     38%|###8      | 25165/65536 [00:32<00:52, 768.94it/s]     39%|###8      | 25243/65536 [00:32<00:52, 771.32it/s]     39%|###8      | 25321/65536 [00:33<00:52, 771.17it/s]     39%|###8      | 25399/65536 [00:33<00:52, 770.78it/s]     39%|###8      | 25477/65536 [00:33<00:51, 770.92it/s]     39%|###8      | 25555/65536 [00:33<00:51, 770.71it/s]     39%|###9      | 25633/65536 [00:33<00:51, 772.47it/s]     39%|###9      | 25712/65536 [00:33<00:51, 775.25it/s]     39%|###9      | 25790/65536 [00:33<00:51, 774.28it/s]     39%|###9      | 25868/65536 [00:33<00:51, 773.18it/s]     40%|###9      | 25946/65536 [00:33<00:51, 772.05it/s]     40%|###9      | 26025/65536 [00:33<00:50, 774.79it/s]     40%|###9      | 26103/65536 [00:34<00:51, 772.31it/s]     40%|###9      | 26181/65536 [00:34<00:51, 770.17it/s]     40%|####      | 26259/65536 [00:34<00:51, 768.85it/s]     40%|####      | 26336/65536 [00:34<00:51, 768.36it/s]     40%|####      | 26413/65536 [00:34<00:50, 768.13it/s]     40%|####      | 26490/65536 [00:34<00:50, 768.46it/s]     41%|####      | 26567/65536 [00:34<00:50, 768.02it/s]     41%|####      | 26644/65536 [00:34<00:50, 767.86it/s]     41%|####      | 26721/65536 [00:34<00:50, 767.91it/s]     41%|####      | 26798/65536 [00:34<00:50, 767.48it/s]     41%|####1     | 26875/65536 [00:35<00:50, 767.35it/s]     41%|####1     | 26952/65536 [00:35<00:50, 767.14it/s]     41%|####1     | 27029/65536 [00:35<00:50, 766.81it/s]     41%|####1     | 27107/65536 [00:35<00:49, 768.93it/s]     41%|####1     | 27184/65536 [00:35<00:49, 768.98it/s]     42%|####1     | 27261/65536 [00:35<00:49, 769.04it/s]     42%|####1     | 27340/65536 [00:35<00:49, 772.77it/s]     42%|####1     | 27419/65536 [00:35<00:49, 776.93it/s]     42%|####1     | 27498/65536 [00:35<00:48, 779.22it/s]     42%|####2     | 27576/65536 [00:35<00:48, 776.45it/s]     42%|####2     | 27654/65536 [00:36<00:48, 775.17it/s]     42%|####2     | 27732/65536 [00:36<00:48, 774.65it/s]     42%|####2     | 27810/65536 [00:36<00:48, 773.40it/s]     43%|####2     | 27888/65536 [00:36<00:48, 772.42it/s]     43%|####2     | 27966/65536 [00:36<00:48, 772.27it/s]     43%|####2     | 28044/65536 [00:36<00:48, 770.90it/s]     43%|####2     | 28122/65536 [00:36<00:48, 769.92it/s]     43%|####3     | 28199/65536 [00:36<00:48, 769.51it/s]     43%|####3     | 28277/65536 [00:36<00:48, 770.08it/s]     43%|####3     | 28356/65536 [00:36<00:48, 774.15it/s]     43%|####3     | 28434/65536 [00:37<00:47, 775.20it/s]     44%|####3     | 28512/65536 [00:37<00:47, 776.25it/s]     44%|####3     | 28590/65536 [00:37<00:47, 776.99it/s]     44%|####3     | 28668/65536 [00:37<00:47, 775.04it/s]     44%|####3     | 28746/65536 [00:37<00:47, 773.06it/s]     44%|####3     | 28824/65536 [00:37<00:47, 770.04it/s]     44%|####4     | 28902/65536 [00:37<00:47, 768.87it/s]     44%|####4     | 28979/65536 [00:37<00:47, 768.87it/s]     44%|####4     | 29056/65536 [00:37<00:47, 768.55it/s]     44%|####4     | 29133/65536 [00:37<00:47, 768.29it/s]     45%|####4     | 29210/65536 [00:38<00:47, 767.60it/s]     45%|####4     | 29287/65536 [00:38<00:47, 766.98it/s]     45%|####4     | 29364/65536 [00:38<00:47, 766.21it/s]     45%|####4     | 29441/65536 [00:38<00:47, 766.22it/s]     45%|####5     | 29518/65536 [00:38<00:46, 766.79it/s]     45%|####5     | 29595/65536 [00:38<00:46, 765.92it/s]     45%|####5     | 29672/65536 [00:38<00:46, 765.98it/s]     45%|####5     | 29749/65536 [00:38<00:46, 766.49it/s]     46%|####5     | 29827/65536 [00:38<00:46, 769.38it/s]     46%|####5     | 29906/65536 [00:39<00:46, 774.42it/s]     46%|####5     | 29985/65536 [00:39<00:45, 778.17it/s]     46%|####5     | 30064/65536 [00:39<00:45, 779.75it/s]     46%|####5     | 30142/65536 [00:39<00:45, 777.03it/s]     46%|####6     | 30220/65536 [00:39<00:45, 777.57it/s]     46%|####6     | 30299/65536 [00:39<00:45, 780.89it/s]     46%|####6     | 30378/65536 [00:39<00:44, 782.92it/s]     46%|####6     | 30457/65536 [00:39<00:44, 783.81it/s]     47%|####6     | 30536/65536 [00:39<00:44, 780.18it/s]     47%|####6     | 30615/65536 [00:39<00:44, 780.05it/s]     47%|####6     | 30694/65536 [00:40<00:44, 781.67it/s]     47%|####6     | 30773/65536 [00:40<00:44, 779.12it/s]     47%|####7     | 30851/65536 [00:40<00:44, 776.43it/s]     47%|####7     | 30929/65536 [00:40<00:44, 774.57it/s]     47%|####7     | 31007/65536 [00:40<00:44, 772.90it/s]     47%|####7     | 31085/65536 [00:40<00:44, 772.00it/s]     48%|####7     | 31163/65536 [00:40<00:44, 772.21it/s]     48%|####7     | 31241/65536 [00:40<00:44, 770.64it/s]     48%|####7     | 31319/65536 [00:40<00:44, 769.36it/s]     48%|####7     | 31396/65536 [00:40<00:44, 768.41it/s]     48%|####8     | 31474/65536 [00:41<00:44, 769.42it/s]     48%|####8     | 31551/65536 [00:41<00:44, 768.58it/s]     48%|####8     | 31628/65536 [00:41<00:44, 768.31it/s]     48%|####8     | 31705/65536 [00:41<00:44, 767.71it/s]     48%|####8     | 31783/65536 [00:41<00:43, 769.84it/s]     49%|####8     | 31861/65536 [00:41<00:43, 770.01it/s]     49%|####8     | 31939/65536 [00:41<00:43, 770.54it/s]     49%|####8     | 32017/65536 [00:41<00:43, 770.43it/s]     49%|####8     | 32095/65536 [00:41<00:43, 770.02it/s]     49%|####9     | 32174/65536 [00:41<00:43, 774.80it/s]     49%|####9     | 32253/65536 [00:42<00:42, 778.33it/s]     49%|####9     | 32332/65536 [00:42<00:42, 781.08it/s]     49%|####9     | 32411/65536 [00:42<00:42, 782.79it/s]     50%|####9     | 32490/65536 [00:42<00:42, 783.91it/s]     50%|####9     | 32569/65536 [00:42<00:42, 777.57it/s]     50%|####9     | 32647/65536 [00:42<00:42, 773.30it/s]     50%|####9     | 32725/65536 [00:42<00:42, 770.94it/s]     50%|#####     | 32803/65536 [00:42<00:42, 769.70it/s]     50%|#####     | 32880/65536 [00:42<00:42, 768.89it/s]     50%|#####     | 32957/65536 [00:42<00:42, 768.60it/s]     50%|#####     | 33034/65536 [00:43<00:42, 768.07it/s]     51%|#####     | 33111/65536 [00:43<00:42, 767.91it/s]     51%|#####     | 33188/65536 [00:43<00:42, 768.14it/s]     51%|#####     | 33265/65536 [00:43<00:42, 768.04it/s]     51%|#####     | 33344/65536 [00:43<00:41, 773.07it/s]     51%|#####     | 33423/65536 [00:43<00:41, 777.17it/s]     51%|#####1    | 33502/65536 [00:43<00:41, 778.39it/s]     51%|#####1    | 33581/65536 [00:43<00:40, 781.04it/s]     51%|#####1    | 33660/65536 [00:43<00:40, 782.38it/s]     51%|#####1    | 33739/65536 [00:43<00:40, 778.48it/s]     52%|#####1    | 33817/65536 [00:44<00:40, 775.46it/s]     52%|#####1    | 33895/65536 [00:44<00:40, 773.04it/s]     52%|#####1    | 33973/65536 [00:44<00:40, 772.23it/s]     52%|#####1    | 34051/65536 [00:44<00:41, 763.89it/s]     52%|#####2    | 34128/65536 [00:44<00:41, 758.64it/s]     52%|#####2    | 34204/65536 [00:44<00:41, 752.61it/s]     52%|#####2    | 34280/65536 [00:44<00:41, 751.06it/s]     52%|#####2    | 34356/65536 [00:44<00:41, 747.34it/s]     53%|#####2    | 34431/65536 [00:44<00:41, 745.55it/s]     53%|#####2    | 34506/65536 [00:44<00:41, 744.85it/s]     53%|#####2    | 34581/65536 [00:45<00:41, 745.57it/s]     53%|#####2    | 34657/65536 [00:45<00:41, 749.17it/s]     53%|#####2    | 34734/65536 [00:45<00:40, 754.88it/s]     53%|#####3    | 34811/65536 [00:45<00:40, 757.72it/s]     53%|#####3    | 34887/65536 [00:45<00:40, 753.49it/s]     53%|#####3    | 34963/65536 [00:45<00:40, 749.51it/s]     53%|#####3    | 35038/65536 [00:45<00:40, 745.46it/s]     54%|#####3    | 35113/65536 [00:45<00:41, 737.97it/s]     54%|#####3    | 35187/65536 [00:45<00:41, 737.08it/s]     54%|#####3    | 35261/65536 [00:45<00:41, 736.49it/s]     54%|#####3    | 35335/65536 [00:46<00:40, 736.96it/s]     54%|#####4    | 35409/65536 [00:46<00:40, 736.51it/s]     54%|#####4    | 35484/65536 [00:46<00:40, 738.07it/s]     54%|#####4    | 35560/65536 [00:46<00:40, 743.44it/s]     54%|#####4    | 35637/65536 [00:46<00:39, 749.39it/s]     54%|#####4    | 35712/65536 [00:46<00:39, 748.54it/s]     55%|#####4    | 35789/65536 [00:46<00:39, 752.35it/s]     55%|#####4    | 35865/65536 [00:46<00:39, 752.41it/s]     55%|#####4    | 35941/65536 [00:46<00:39, 752.21it/s]     55%|#####4    | 36017/65536 [00:46<00:39, 751.79it/s]     55%|#####5    | 36094/65536 [00:47<00:38, 756.63it/s]     55%|#####5    | 36171/65536 [00:47<00:38, 760.14it/s]     55%|#####5    | 36248/65536 [00:47<00:38, 762.59it/s]     55%|#####5    | 36325/65536 [00:47<00:38, 763.25it/s]     56%|#####5    | 36402/65536 [00:47<00:38, 750.89it/s]     56%|#####5    | 36478/65536 [00:47<00:38, 750.98it/s]     56%|#####5    | 36555/65536 [00:47<00:38, 754.78it/s]     56%|#####5    | 36631/65536 [00:47<00:39, 736.75it/s]     56%|#####6    | 36707/65536 [00:47<00:38, 742.71it/s]     56%|#####6    | 36784/65536 [00:48<00:38, 749.59it/s]     56%|#####6    | 36861/65536 [00:48<00:37, 754.95it/s]     56%|#####6    | 36939/65536 [00:48<00:37, 761.94it/s]     56%|#####6    | 37016/65536 [00:48<00:37, 764.13it/s]     57%|#####6    | 37093/65536 [00:48<00:37, 764.67it/s]     57%|#####6    | 37170/65536 [00:48<00:37, 765.43it/s]     57%|#####6    | 37247/65536 [00:48<00:36, 764.89it/s]     57%|#####6    | 37325/65536 [00:48<00:36, 767.34it/s]     57%|#####7    | 37402/65536 [00:48<00:36, 768.09it/s]     57%|#####7    | 37479/65536 [00:48<00:36, 765.08it/s]     57%|#####7    | 37556/65536 [00:49<00:36, 766.49it/s]     57%|#####7    | 37633/65536 [00:49<00:36, 764.29it/s]     58%|#####7    | 37710/65536 [00:49<00:36, 762.06it/s]     58%|#####7    | 37787/65536 [00:49<00:36, 763.17it/s]     58%|#####7    | 37864/65536 [00:49<00:36, 763.15it/s]     58%|#####7    | 37941/65536 [00:49<00:36, 761.44it/s]     58%|#####8    | 38018/65536 [00:49<00:36, 760.12it/s]     58%|#####8    | 38095/65536 [00:49<00:36, 760.78it/s]     58%|#####8    | 38172/65536 [00:49<00:35, 762.68it/s]     58%|#####8    | 38249/65536 [00:49<00:35, 764.45it/s]     58%|#####8    | 38326/65536 [00:50<00:35, 764.16it/s]     59%|#####8    | 38403/65536 [00:50<00:35, 759.46it/s]     59%|#####8    | 38479/65536 [00:50<00:35, 752.69it/s]     59%|#####8    | 38555/65536 [00:50<00:36, 744.60it/s]     59%|#####8    | 38630/65536 [00:50<00:36, 743.68it/s]     59%|#####9    | 38705/65536 [00:50<00:36, 743.53it/s]     59%|#####9    | 38780/65536 [00:50<00:35, 743.93it/s]     59%|#####9    | 38856/65536 [00:50<00:35, 746.91it/s]     59%|#####9    | 38934/65536 [00:50<00:35, 753.97it/s]     60%|#####9    | 39012/65536 [00:50<00:34, 758.99it/s]     60%|#####9    | 39088/65536 [00:51<00:34, 756.42it/s]     60%|#####9    | 39164/65536 [00:51<00:34, 754.06it/s]     60%|#####9    | 39240/65536 [00:51<00:34, 754.67it/s]     60%|#####9    | 39317/65536 [00:51<00:34, 758.42it/s]     60%|######    | 39394/65536 [00:51<00:34, 759.86it/s]     60%|######    | 39471/65536 [00:51<00:34, 761.04it/s]     60%|######    | 39548/65536 [00:51<00:34, 762.25it/s]     60%|######    | 39625/65536 [00:51<00:34, 760.23it/s]     61%|######    | 39702/65536 [00:51<00:33, 760.15it/s]     61%|######    | 39780/65536 [00:51<00:33, 763.34it/s]     61%|######    | 39857/65536 [00:52<00:33, 760.53it/s]     61%|######    | 39934/65536 [00:52<00:33, 757.75it/s]     61%|######1   | 40011/65536 [00:52<00:33, 759.38it/s]     61%|######1   | 40088/65536 [00:52<00:33, 760.32it/s]     61%|######1   | 40165/65536 [00:52<00:33, 760.11it/s]     61%|######1   | 40242/65536 [00:52<00:33, 762.95it/s]     62%|######1   | 40320/65536 [00:52<00:32, 765.20it/s]     62%|######1   | 40397/65536 [00:52<00:32, 764.97it/s]     62%|######1   | 40474/65536 [00:52<00:32, 765.59it/s]     62%|######1   | 40551/65536 [00:52<00:32, 766.87it/s]     62%|######1   | 40629/65536 [00:53<00:32, 768.14it/s]     62%|######2   | 40706/65536 [00:53<00:32, 766.27it/s]     62%|######2   | 40783/65536 [00:53<00:32, 759.10it/s]     62%|######2   | 40859/65536 [00:53<00:32, 752.62it/s]     62%|######2   | 40935/65536 [00:53<00:32, 749.77it/s]     63%|######2   | 41010/65536 [00:53<00:32, 748.09it/s]     63%|######2   | 41085/65536 [00:53<00:32, 746.29it/s]     63%|######2   | 41160/65536 [00:53<00:32, 744.78it/s]     63%|######2   | 41235/65536 [00:53<00:32, 743.35it/s]     63%|######3   | 41310/65536 [00:53<00:32, 743.01it/s]     63%|######3   | 41385/65536 [00:54<00:32, 741.47it/s]     63%|######3   | 41460/65536 [00:54<00:32, 742.36it/s]     63%|######3   | 41537/65536 [00:54<00:32, 749.58it/s]     63%|######3   | 41614/65536 [00:54<00:31, 754.48it/s]     64%|######3   | 41691/65536 [00:54<00:31, 758.81it/s]     64%|######3   | 41767/65536 [00:54<00:31, 758.35it/s]     64%|######3   | 41844/65536 [00:54<00:31, 760.82it/s]     64%|######3   | 41921/65536 [00:54<00:31, 757.70it/s]     64%|######4   | 41997/65536 [00:54<00:31, 758.05it/s]     64%|######4   | 42075/65536 [00:54<00:30, 762.54it/s]     64%|######4   | 42153/65536 [00:55<00:30, 767.17it/s]     64%|######4   | 42230/65536 [00:55<00:30, 767.97it/s]     65%|######4   | 42307/65536 [00:55<00:30, 767.46it/s]     65%|######4   | 42384/65536 [00:55<00:30, 767.42it/s]     65%|######4   | 42462/65536 [00:55<00:30, 768.61it/s]     65%|######4   | 42539/65536 [00:55<00:29, 768.56it/s]     65%|######5   | 42617/65536 [00:55<00:29, 771.86it/s]     65%|######5   | 42695/65536 [00:55<00:29, 767.55it/s]     65%|######5   | 42772/65536 [00:55<00:30, 756.23it/s]     65%|######5   | 42848/65536 [00:56<00:30, 751.12it/s]     65%|######5   | 42924/65536 [00:56<00:30, 747.41it/s]     66%|######5   | 43000/65536 [00:56<00:30, 748.97it/s]     66%|######5   | 43075/65536 [00:56<00:29, 749.15it/s]     66%|######5   | 43150/65536 [00:56<00:30, 745.68it/s]     66%|######5   | 43225/65536 [00:56<00:29, 746.03it/s]     66%|######6   | 43302/65536 [00:56<00:29, 750.36it/s]     66%|######6   | 43380/65536 [00:56<00:29, 757.32it/s]     66%|######6   | 43457/65536 [00:56<00:29, 757.86it/s]     66%|######6   | 43533/65536 [00:56<00:29, 756.11it/s]     67%|######6   | 43609/65536 [00:57<00:29, 754.60it/s]     67%|######6   | 43685/65536 [00:57<00:29, 746.98it/s]     67%|######6   | 43760/65536 [00:57<00:29, 744.46it/s]     67%|######6   | 43835/65536 [00:57<00:29, 745.27it/s]     67%|######7   | 43910/65536 [00:57<00:28, 746.34it/s]     67%|######7   | 43987/65536 [00:57<00:28, 751.81it/s]     67%|######7   | 44064/65536 [00:57<00:28, 757.01it/s]     67%|######7   | 44141/65536 [00:57<00:28, 758.91it/s]     67%|######7   | 44217/65536 [00:57<00:28, 756.14it/s]     68%|######7   | 44293/65536 [00:57<00:28, 757.03it/s]     68%|######7   | 44369/65536 [00:58<00:27, 757.27it/s]     68%|######7   | 44446/65536 [00:58<00:27, 758.23it/s]     68%|######7   | 44522/65536 [00:58<00:27, 758.42it/s]     68%|######8   | 44599/65536 [00:58<00:27, 759.50it/s]     68%|######8   | 44676/65536 [00:58<00:27, 762.34it/s]     68%|######8   | 44753/65536 [00:58<00:27, 763.61it/s]     68%|######8   | 44830/65536 [00:58<00:27, 764.31it/s]     69%|######8   | 44907/65536 [00:58<00:26, 765.46it/s]     69%|######8   | 44984/65536 [00:58<00:26, 765.67it/s]     69%|######8   | 45062/65536 [00:58<00:26, 767.83it/s]     69%|######8   | 45139/65536 [00:59<00:26, 767.40it/s]     69%|######8   | 45218/65536 [00:59<00:26, 772.27it/s]     69%|######9   | 45297/65536 [00:59<00:26, 776.87it/s]     69%|######9   | 45375/65536 [00:59<00:25, 776.85it/s]     69%|######9   | 45453/65536 [00:59<00:25, 773.54it/s]     69%|######9   | 45531/65536 [00:59<00:25, 772.00it/s]     70%|######9   | 45609/65536 [00:59<00:25, 773.62it/s]     70%|######9   | 45687/65536 [00:59<00:25, 774.73it/s]     70%|######9   | 45765/65536 [00:59<00:25, 771.94it/s]     70%|######9   | 45843/65536 [00:59<00:25, 765.20it/s]     70%|#######   | 45920/65536 [01:00<00:25, 764.58it/s]     70%|#######   | 45997/65536 [01:00<00:25, 762.79it/s]     70%|#######   | 46074/65536 [01:00<00:25, 762.87it/s]     70%|#######   | 46151/65536 [01:00<00:25, 762.47it/s]     71%|#######   | 46228/65536 [01:00<00:25, 761.88it/s]     71%|#######   | 46305/65536 [01:00<00:25, 760.27it/s]     71%|#######   | 46382/65536 [01:00<00:25, 756.70it/s]     71%|#######   | 46459/65536 [01:00<00:25, 758.39it/s]     71%|#######1  | 46535/65536 [01:00<00:25, 758.24it/s]     71%|#######1  | 46611/65536 [01:00<00:24, 757.30it/s]     71%|#######1  | 46687/65536 [01:01<00:24, 757.42it/s]     71%|#######1  | 46763/65536 [01:01<00:24, 757.09it/s]     71%|#######1  | 46841/65536 [01:01<00:24, 761.55it/s]     72%|#######1  | 46918/65536 [01:01<00:24, 760.02it/s]     72%|#######1  | 46995/65536 [01:01<00:24, 748.52it/s]     72%|#######1  | 47071/65536 [01:01<00:24, 751.22it/s]     72%|#######1  | 47148/65536 [01:01<00:24, 754.31it/s]     72%|#######2  | 47225/65536 [01:01<00:24, 756.64it/s]     72%|#######2  | 47302/65536 [01:01<00:24, 758.31it/s]     72%|#######2  | 47379/65536 [01:01<00:23, 760.10it/s]     72%|#######2  | 47456/65536 [01:02<00:23, 761.34it/s]     73%|#######2  | 47534/65536 [01:02<00:23, 764.43it/s]     73%|#######2  | 47612/65536 [01:02<00:23, 766.59it/s]     73%|#######2  | 47689/65536 [01:02<00:23, 767.02it/s]     73%|#######2  | 47766/65536 [01:02<00:23, 759.04it/s]     73%|#######3  | 47842/65536 [01:02<00:23, 758.41it/s]     73%|#######3  | 47918/65536 [01:02<00:23, 753.99it/s]     73%|#######3  | 47994/65536 [01:02<00:23, 745.91it/s]     73%|#######3  | 48069/65536 [01:02<00:23, 746.24it/s]     73%|#######3  | 48144/65536 [01:02<00:23, 744.35it/s]     74%|#######3  | 48220/65536 [01:03<00:23, 746.54it/s]     74%|#######3  | 48296/65536 [01:03<00:23, 749.47it/s]     74%|#######3  | 48373/65536 [01:03<00:22, 754.69it/s]     74%|#######3  | 48451/65536 [01:03<00:22, 759.78it/s]     74%|#######4  | 48527/65536 [01:03<00:22, 757.34it/s]     74%|#######4  | 48603/65536 [01:03<00:22, 756.51it/s]     74%|#######4  | 48680/65536 [01:03<00:22, 758.10it/s]     74%|#######4  | 48756/65536 [01:03<00:22, 753.38it/s]     75%|#######4  | 48832/65536 [01:03<00:22, 752.19it/s]     75%|#######4  | 48908/65536 [01:03<00:22, 749.19it/s]     75%|#######4  | 48983/65536 [01:04<00:22, 744.20it/s]     75%|#######4  | 49058/65536 [01:04<00:22, 743.23it/s]     75%|#######4  | 49133/65536 [01:04<00:22, 739.00it/s]     75%|#######5  | 49207/65536 [01:04<00:22, 734.87it/s]     75%|#######5  | 49282/65536 [01:04<00:22, 736.71it/s]     75%|#######5  | 49357/65536 [01:04<00:21, 738.62it/s]     75%|#######5  | 49433/65536 [01:04<00:21, 742.47it/s]     76%|#######5  | 49508/65536 [01:04<00:21, 742.23it/s]     76%|#######5  | 49583/65536 [01:04<00:21, 744.18it/s]     76%|#######5  | 49658/65536 [01:05<00:21, 745.76it/s]     76%|#######5  | 49735/65536 [01:05<00:21, 750.87it/s]     76%|#######6  | 49812/65536 [01:05<00:20, 754.95it/s]     76%|#######6  | 49889/65536 [01:05<00:20, 759.42it/s]     76%|#######6  | 49965/65536 [01:05<00:20, 751.07it/s]     76%|#######6  | 50042/65536 [01:05<00:20, 755.06it/s]     76%|#######6  | 50120/65536 [01:05<00:20, 761.10it/s]     77%|#######6  | 50198/65536 [01:05<00:20, 764.93it/s]     77%|#######6  | 50276/65536 [01:05<00:19, 769.11it/s]     77%|#######6  | 50353/65536 [01:05<00:19, 768.81it/s]     77%|#######6  | 50431/65536 [01:06<00:19, 769.79it/s]     77%|#######7  | 50508/65536 [01:06<00:19, 769.38it/s]     77%|#######7  | 50585/65536 [01:06<00:19, 769.50it/s]     77%|#######7  | 50664/65536 [01:06<00:19, 773.80it/s]     77%|#######7  | 50742/65536 [01:06<00:19, 773.45it/s]     78%|#######7  | 50820/65536 [01:06<00:19, 770.82it/s]     78%|#######7  | 50898/65536 [01:06<00:19, 768.86it/s]     78%|#######7  | 50975/65536 [01:06<00:19, 761.87it/s]     78%|#######7  | 51052/65536 [01:06<00:18, 763.56it/s]     78%|#######8  | 51130/65536 [01:06<00:18, 765.67it/s]     78%|#######8  | 51207/65536 [01:07<00:18, 765.21it/s]     78%|#######8  | 51284/65536 [01:07<00:18, 766.50it/s]     78%|#######8  | 51363/65536 [01:07<00:18, 771.67it/s]     78%|#######8  | 51441/65536 [01:07<00:18, 773.69it/s]     79%|#######8  | 51519/65536 [01:07<00:18, 767.97it/s]     79%|#######8  | 51596/65536 [01:07<00:18, 764.47it/s]     79%|#######8  | 51673/65536 [01:07<00:18, 763.79it/s]     79%|#######8  | 51750/65536 [01:07<00:18, 758.58it/s]     79%|#######9  | 51826/65536 [01:07<00:18, 758.18it/s]     79%|#######9  | 51903/65536 [01:07<00:17, 758.74it/s]     79%|#######9  | 51980/65536 [01:08<00:17, 761.28it/s]     79%|#######9  | 52058/65536 [01:08<00:17, 764.42it/s]     80%|#######9  | 52135/65536 [01:08<00:17, 763.27it/s]     80%|#######9  | 52212/65536 [01:08<00:17, 760.64it/s]     80%|#######9  | 52289/65536 [01:08<00:17, 755.60it/s]     80%|#######9  | 52365/65536 [01:08<00:17, 748.77it/s]     80%|########  | 52440/65536 [01:08<00:17, 744.90it/s]     80%|########  | 52515/65536 [01:08<00:17, 745.78it/s]     80%|########  | 52590/65536 [01:08<00:17, 745.97it/s]     80%|########  | 52665/65536 [01:08<00:17, 742.59it/s]     80%|########  | 52740/65536 [01:09<00:17, 744.28it/s]     81%|########  | 52815/65536 [01:09<00:17, 744.73it/s]     81%|########  | 52890/65536 [01:09<00:17, 743.32it/s]     81%|########  | 52965/65536 [01:09<00:16, 744.17it/s]     81%|########  | 53041/65536 [01:09<00:16, 747.67it/s]     81%|########1 | 53118/65536 [01:09<00:16, 752.41it/s]     81%|########1 | 53194/65536 [01:09<00:16, 754.22it/s]     81%|########1 | 53271/65536 [01:09<00:16, 756.99it/s]     81%|########1 | 53349/65536 [01:09<00:16, 761.26it/s]     82%|########1 | 53426/65536 [01:09<00:15, 760.58it/s]     82%|########1 | 53503/65536 [01:10<00:15, 756.60it/s]     82%|########1 | 53579/65536 [01:10<00:15, 756.99it/s]     82%|########1 | 53655/65536 [01:10<00:15, 756.37it/s]     82%|########1 | 53732/65536 [01:10<00:15, 757.75it/s]     82%|########2 | 53808/65536 [01:10<00:15, 756.63it/s]     82%|########2 | 53884/65536 [01:10<00:15, 757.35it/s]     82%|########2 | 53960/65536 [01:10<00:15, 755.53it/s]     82%|########2 | 54037/65536 [01:10<00:15, 758.90it/s]     83%|########2 | 54114/65536 [01:10<00:15, 760.51it/s]     83%|########2 | 54191/65536 [01:10<00:15, 752.15it/s]     83%|########2 | 54267/65536 [01:11<00:15, 750.38it/s]     83%|########2 | 54343/65536 [01:11<00:15, 743.36it/s]     83%|########3 | 54418/65536 [01:11<00:15, 739.27it/s]     83%|########3 | 54493/65536 [01:11<00:14, 740.81it/s]     83%|########3 | 54568/65536 [01:11<00:14, 741.73it/s]     83%|########3 | 54644/65536 [01:11<00:14, 746.60it/s]     83%|########3 | 54720/65536 [01:11<00:14, 749.39it/s]     84%|########3 | 54797/65536 [01:11<00:14, 752.48it/s]     84%|########3 | 54873/65536 [01:11<00:14, 752.05it/s]     84%|########3 | 54950/65536 [01:11<00:14, 755.56it/s]     84%|########3 | 55026/65536 [01:12<00:13, 753.27it/s]     84%|########4 | 55102/65536 [01:12<00:13, 754.97it/s]     84%|########4 | 55179/65536 [01:12<00:13, 757.72it/s]     84%|########4 | 55257/65536 [01:12<00:13, 761.54it/s]     84%|########4 | 55335/65536 [01:12<00:13, 765.72it/s]     85%|########4 | 55412/65536 [01:12<00:13, 766.19it/s]     85%|########4 | 55489/65536 [01:12<00:13, 766.30it/s]     85%|########4 | 55567/65536 [01:12<00:12, 770.15it/s]     85%|########4 | 55645/65536 [01:12<00:12, 771.99it/s]     85%|########5 | 55723/65536 [01:13<00:12, 770.08it/s]     85%|########5 | 55801/65536 [01:13<00:12, 766.60it/s]     85%|########5 | 55878/65536 [01:13<00:12, 766.75it/s]     85%|########5 | 55955/65536 [01:13<00:12, 763.60it/s]     85%|########5 | 56032/65536 [01:13<00:12, 760.93it/s]     86%|########5 | 56109/65536 [01:13<00:12, 760.05it/s]     86%|########5 | 56187/65536 [01:13<00:12, 763.92it/s]     86%|########5 | 56264/65536 [01:13<00:12, 763.98it/s]     86%|########5 | 56342/65536 [01:13<00:11, 767.05it/s]     86%|########6 | 56419/65536 [01:13<00:11, 764.62it/s]     86%|########6 | 56496/65536 [01:14<00:11, 762.00it/s]     86%|########6 | 56573/65536 [01:14<00:11, 759.63it/s]     86%|########6 | 56649/65536 [01:14<00:11, 751.75it/s]     87%|########6 | 56725/65536 [01:14<00:11, 745.89it/s]     87%|########6 | 56802/65536 [01:14<00:11, 750.47it/s]     87%|########6 | 56880/65536 [01:14<00:11, 756.89it/s]     87%|########6 | 56957/65536 [01:14<00:11, 759.40it/s]     87%|########7 | 57033/65536 [01:14<00:11, 748.65it/s]     87%|########7 | 57108/65536 [01:14<00:11, 744.20it/s]     87%|########7 | 57184/65536 [01:14<00:11, 745.97it/s]     87%|########7 | 57260/65536 [01:15<00:11, 748.87it/s]     87%|########7 | 57337/65536 [01:15<00:10, 754.34it/s]     88%|########7 | 57415/65536 [01:15<00:10, 759.27it/s]     88%|########7 | 57492/65536 [01:15<00:10, 761.07it/s]     88%|########7 | 57569/65536 [01:15<00:10, 763.54it/s]     88%|########7 | 57646/65536 [01:15<00:10, 762.90it/s]     88%|########8 | 57723/65536 [01:15<00:10, 763.34it/s]     88%|########8 | 57800/65536 [01:15<00:10, 760.86it/s]     88%|########8 | 57877/65536 [01:15<00:10, 759.87it/s]     88%|########8 | 57954/65536 [01:15<00:09, 760.63it/s]     89%|########8 | 58031/65536 [01:16<00:09, 761.19it/s]     89%|########8 | 58108/65536 [01:16<00:09, 760.35it/s]     89%|########8 | 58185/65536 [01:16<00:09, 761.89it/s]     89%|########8 | 58263/65536 [01:16<00:09, 764.94it/s]     89%|########9 | 58341/65536 [01:16<00:09, 766.90it/s]     89%|########9 | 58418/65536 [01:16<00:09, 766.49it/s]     89%|########9 | 58495/65536 [01:16<00:09, 764.30it/s]     89%|########9 | 58572/65536 [01:16<00:09, 757.78it/s]     89%|########9 | 58648/65536 [01:16<00:09, 754.87it/s]     90%|########9 | 58724/65536 [01:16<00:09, 751.99it/s]     90%|########9 | 58800/65536 [01:17<00:08, 751.61it/s]     90%|########9 | 58876/65536 [01:17<00:08, 749.30it/s]     90%|########9 | 58952/65536 [01:17<00:08, 752.21it/s]     90%|######### | 59028/65536 [01:17<00:08, 752.43it/s]     90%|######### | 59104/65536 [01:17<00:08, 751.48it/s]     90%|######### | 59180/65536 [01:17<00:08, 751.19it/s]     90%|######### | 59257/65536 [01:17<00:08, 756.41it/s]     91%|######### | 59334/65536 [01:17<00:08, 757.61it/s]     91%|######### | 59410/65536 [01:17<00:08, 757.47it/s]     91%|######### | 59488/65536 [01:17<00:07, 763.54it/s]     91%|######### | 59565/65536 [01:18<00:07, 763.56it/s]     91%|#########1| 59642/65536 [01:18<00:07, 763.29it/s]     91%|#########1| 59720/65536 [01:18<00:07, 766.25it/s]     91%|#########1| 59797/65536 [01:18<00:07, 765.25it/s]     91%|#########1| 59874/65536 [01:18<00:07, 764.47it/s]     91%|#########1| 59951/65536 [01:18<00:07, 764.05it/s]     92%|#########1| 60028/65536 [01:18<00:07, 759.20it/s]     92%|#########1| 60104/65536 [01:18<00:07, 754.45it/s]     92%|#########1| 60180/65536 [01:18<00:07, 746.68it/s]     92%|#########1| 60255/65536 [01:18<00:07, 737.18it/s]     92%|#########2| 60329/65536 [01:19<00:07, 731.71it/s]     92%|#########2| 60403/65536 [01:19<00:06, 733.91it/s]     92%|#########2| 60479/65536 [01:19<00:06, 739.24it/s]     92%|#########2| 60555/65536 [01:19<00:06, 744.45it/s]     93%|#########2| 60631/65536 [01:19<00:06, 747.24it/s]     93%|#########2| 60707/65536 [01:19<00:06, 749.00it/s]     93%|#########2| 60783/65536 [01:19<00:06, 751.24it/s]     93%|#########2| 60861/65536 [01:19<00:06, 757.73it/s]     93%|#########2| 60938/65536 [01:19<00:06, 759.65it/s]     93%|#########3| 61014/65536 [01:20<00:05, 759.69it/s]     93%|#########3| 61092/65536 [01:20<00:05, 763.27it/s]     93%|#########3| 61171/65536 [01:20<00:05, 768.61it/s]     93%|#########3| 61249/65536 [01:20<00:05, 769.55it/s]     94%|#########3| 61327/65536 [01:20<00:05, 770.00it/s]     94%|#########3| 61404/65536 [01:20<00:05, 766.87it/s]     94%|#########3| 61481/65536 [01:20<00:05, 766.03it/s]     94%|#########3| 61558/65536 [01:20<00:05, 766.70it/s]     94%|#########4| 61636/65536 [01:20<00:05, 769.81it/s]     94%|#########4| 61714/65536 [01:20<00:04, 772.11it/s]     94%|#########4| 61792/65536 [01:21<00:04, 770.52it/s]     94%|#########4| 61870/65536 [01:21<00:04, 756.32it/s]     95%|#########4| 61947/65536 [01:21<00:04, 758.37it/s]     95%|#########4| 62023/65536 [01:21<00:04, 758.69it/s]     95%|#########4| 62100/65536 [01:21<00:04, 760.30it/s]     95%|#########4| 62177/65536 [01:21<00:04, 761.94it/s]     95%|#########4| 62254/65536 [01:21<00:04, 763.03it/s]     95%|#########5| 62331/65536 [01:21<00:04, 763.86it/s]     95%|#########5| 62409/65536 [01:21<00:04, 766.18it/s]     95%|#########5| 62487/65536 [01:21<00:03, 770.23it/s]     95%|#########5| 62565/65536 [01:22<00:03, 761.51it/s]     96%|#########5| 62642/65536 [01:22<00:03, 758.61it/s]     96%|#########5| 62718/65536 [01:22<00:03, 748.83it/s]     96%|#########5| 62793/65536 [01:22<00:03, 738.92it/s]     96%|#########5| 62867/65536 [01:22<00:03, 733.66it/s]     96%|#########6| 62943/65536 [01:22<00:03, 740.59it/s]     96%|#########6| 63018/65536 [01:22<00:03, 742.69it/s]     96%|#########6| 63095/65536 [01:22<00:03, 747.80it/s]     96%|#########6| 63170/65536 [01:22<00:03, 748.39it/s]     97%|#########6| 63245/65536 [01:22<00:03, 748.35it/s]     97%|#########6| 63322/65536 [01:23<00:02, 753.59it/s]     97%|#########6| 63399/65536 [01:23<00:02, 756.75it/s]     97%|#########6| 63476/65536 [01:23<00:02, 759.55it/s]     97%|#########6| 63553/65536 [01:23<00:02, 761.59it/s]     97%|#########7| 63630/65536 [01:23<00:02, 762.75it/s]     97%|#########7| 63707/65536 [01:23<00:02, 762.02it/s]     97%|#########7| 63784/65536 [01:23<00:02, 763.65it/s]     97%|#########7| 63861/65536 [01:23<00:02, 763.46it/s]     98%|#########7| 63938/65536 [01:23<00:02, 765.30it/s]     98%|#########7| 64015/65536 [01:23<00:01, 762.69it/s]     98%|#########7| 64092/65536 [01:24<00:01, 763.00it/s]     98%|#########7| 64169/65536 [01:24<00:01, 761.61it/s]     98%|#########8| 64246/65536 [01:24<00:01, 761.61it/s]     98%|#########8| 64323/65536 [01:24<00:01, 760.44it/s]     98%|#########8| 64400/65536 [01:24<00:01, 761.51it/s]     98%|#########8| 64477/65536 [01:24<00:01, 762.71it/s]     99%|#########8| 64554/65536 [01:24<00:01, 762.90it/s]     99%|#########8| 64631/65536 [01:24<00:01, 763.72it/s]     99%|#########8| 64709/65536 [01:24<00:01, 767.94it/s]     99%|#########8| 64786/65536 [01:24<00:00, 765.76it/s]     99%|#########8| 64863/65536 [01:25<00:00, 766.38it/s]     99%|#########9| 64940/65536 [01:25<00:00, 764.27it/s]     99%|#########9| 65017/65536 [01:25<00:00, 765.43it/s]     99%|#########9| 65095/65536 [01:25<00:00, 766.95it/s]     99%|#########9| 65172/65536 [01:25<00:00, 764.90it/s]    100%|#########9| 65250/65536 [01:25<00:00, 767.52it/s]    100%|#########9| 65327/65536 [01:25<00:00, 766.95it/s]    100%|#########9| 65404/65536 [01:25<00:00, 765.64it/s]    100%|#########9| 65481/65536 [01:25<00:00, 762.27it/s]    100%|##########| 65536/65536 [01:25<00:00, 762.55it/s]




.. GENERATED FROM PYTHON SOURCE LINES 126-131

Print training statistics and plot training error
-------------------------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 131-134

.. code-block:: default

    print(calibrator.stats())
    calibrator.plot_test_accuracy()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :alt: Training error
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Number of training samples: 4194304
            Number of filter coefficients: 2560
            Largets / smallest training error: 1.1e-04 / 8.5e-11
            Number of gradient evaluations: 4194304
            Calibration Time: 1.2e-02 [s]
        




.. GENERATED FROM PYTHON SOURCE LINES 135-138

Extract testing estimate
-------------------------


.. GENERATED FROM PYTHON SOURCE LINES 138-140

.. code-block:: default

    u_hat = calibrator.test(size)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/16896 [00:00<?, ?it/s]     35%|###4      | 5853/16896 [00:00<00:00, 58527.54it/s]     70%|######9   | 11762/16896 [00:00<00:00, 58853.15it/s]    100%|##########| 16896/16896 [00:00<00:00, 58698.86it/s]




.. GENERATED FROM PYTHON SOURCE LINES 141-144

Visualise PSD of testing data
-----------------------------


.. GENERATED FROM PYTHON SOURCE LINES 144-214

.. code-block:: default


    # uncalibrated
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_uncalibrated[:],
        fs=1 / digital_control.clock.T,
        nperseg=u_hat_cut_uncalibrated.size,
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Uncalibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Ref
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_ref[:], fs=1 / digital_control.clock.T, nperseg=u_hat_cut_ref.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Ref, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Calibrated Est
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat[:], fs=1 / digital_control.clock.T, nperseg=u_hat.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Calibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    plt.title("Power spectral density of input estimate")
    plt.xlabel('Hz')
    plt.ylabel('$V^2$ / Hz dB')
    plt.legend()
    plt.grid(which="both")
    plt.gcf().tight_layout()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :alt: Power spectral density of input estimate
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  51.789 seconds)


.. _sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_h_calibrating_from_numpy_simulator.py <plot_h_calibrating_from_numpy_simulator.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_h_calibrating_from_numpy_simulator.ipynb <plot_h_calibrating_from_numpy_simulator.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
