
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorials/b_high_level_simulation/plot_h_calibrating_from_numpy_simulator.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


Calibrating an Unknown Op-Amp Pole from Data
============================================

.. GENERATED FROM PYTHON SOURCE LINES 6-11

.. code-block:: default

    import cbadc
    import numpy as np
    import matplotlib.pyplot as plt
    import copy








.. GENERATED FROM PYTHON SOURCE LINES 12-15

Setup proxy simulators from numpy data
--------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 15-27

.. code-block:: default

    specification_false = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_FALSE.dict')
    specification_ref = cbadc.utilities.pickle_load('op-amp_data/AS_PARAMS_TRUE.dict')
    T = specification_ref['T']
    BW = specification_ref['fc']
    N = specification_false['N']
    M = N + 1

    ctrl_bits_test_uncalibrated = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_ref = iter(np.load('op-amp_data/s_test.npy'))
    ctrl_bits_test_cal = cbadc.simulator.NumpySimulator('op-amp_data/s_test.npy')
    ctrl_bits_train = cbadc.simulator.NumpySimulator('op-amp_data/s_train.npy')








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Instantiate Analog Systems, Digital Controls, and Nominal FIR Filters
----------------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 31-73

.. code-block:: default


    analog_system = cbadc.analog_system.AnalogSystem(
        specification_false['A'],
        specification_false['B'],
        np.eye(specification_false['N']),
        specification_false['Gamma'],
        specification_false['Gamma'].transpose(),
    )
    analog_system_ref = cbadc.analog_system.AnalogSystem(
        specification_ref['A'],
        specification_ref['B'],
        np.eye(specification_ref['N']),
        specification_ref['Gamma'],
        specification_ref['Gamma'].transpose(),
    )

    digital_control = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_false['T']), M
    )
    digital_control_ref = cbadc.digital_control.DigitalControl(
        cbadc.analog_signal.Clock(specification_ref['T']), M
    )

    eta2 = (
        np.linalg.norm(
            analog_system_ref.transfer_function_matrix(
                np.array([2 * np.pi * specification_ref['fc']])
            )
        )
        ** 2
    )
    K1 = 1 << 8
    K2 = K1

    fir_filter = cbadc.digital_estimator.FIRFilter(
        analog_system, digital_control, eta2, K1, K2
    )

    fir_filter_ref = cbadc.digital_estimator.FIRFilter(
        analog_system_ref, digital_control_ref, eta2, K1, K2
    )








.. GENERATED FROM PYTHON SOURCE LINES 74-77

Setup testing simulations for verification
---------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 77-95

.. code-block:: default


    # Ref
    uncalibrated_filter = copy.deepcopy(fir_filter)
    uncalibrated_filter(ctrl_bits_test_uncalibrated)


    fir_filter_ref(ctrl_bits_test_ref)


    size = 1 << 14
    u_hat_ref = np.zeros(size)
    u_hat_uncalibrated = np.zeros(size)
    for index in range(size):
        u_hat_ref[index] = next(fir_filter_ref)
        u_hat_uncalibrated[index] = next(uncalibrated_filter)
    u_hat_cut_ref = u_hat_ref[K1 + K2 :]
    u_hat_cut_uncalibrated = u_hat_uncalibrated[K1 + K2 :]








.. GENERATED FROM PYTHON SOURCE LINES 96-99

Instantiate adaptive filter and set buffer training data size
-------------------------------------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 99-104

.. code-block:: default

    training_data_size = 1 << 15 - 1
    adaptive_filter = cbadc.digital_estimator.AdaptiveFilter(
        fir_filter, 0, training_data_size
    )








.. GENERATED FROM PYTHON SOURCE LINES 105-108

Instantiate the training instance
----------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 108-112

.. code-block:: default

    calibrator = cbadc.digital_calibration.Calibration(
        adaptive_filter, ctrl_bits_train, ctrl_bits_test_cal
    )








.. GENERATED FROM PYTHON SOURCE LINES 113-118

Train adaptive filter
----------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 118-125

.. code-block:: default

    epochs = 1 << 16
    step_size = lambda x: 1e-1 / ((1 + x ** (0.01)))
    batch_size = 1 << 6

    calibrator.compute_step_size_template()
    calibrator.train(epochs, step_size, batch_size, stochastic_delay=0)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/65536 [00:00<?, ?it/s]      0%|          | 1/65536 [00:00<5:52:22,  3.10it/s]      0%|          | 76/65536 [00:00<04:42, 231.92it/s]      0%|          | 152/65536 [00:00<02:46, 392.39it/s]      0%|          | 228/65536 [00:00<02:09, 503.55it/s]      0%|          | 305/65536 [00:00<01:51, 583.69it/s]      1%|          | 382/65536 [00:00<01:41, 638.89it/s]      1%|          | 458/65536 [00:00<01:36, 673.37it/s]      1%|          | 535/65536 [00:01<01:32, 700.05it/s]      1%|          | 611/65536 [00:01<01:30, 716.49it/s]      1%|1         | 688/65536 [00:01<01:28, 730.44it/s]      1%|1         | 765/65536 [00:01<01:27, 740.02it/s]      1%|1         | 843/65536 [00:01<01:26, 749.51it/s]      1%|1         | 920/65536 [00:01<01:25, 755.00it/s]      2%|1         | 997/65536 [00:01<01:25, 755.89it/s]      2%|1         | 1074/65536 [00:01<01:25, 757.94it/s]      2%|1         | 1151/65536 [00:01<01:24, 760.02it/s]      2%|1         | 1228/65536 [00:01<01:24, 762.31it/s]      2%|1         | 1305/65536 [00:02<01:24, 762.64it/s]      2%|2         | 1382/65536 [00:02<01:23, 764.49it/s]      2%|2         | 1459/65536 [00:02<01:24, 760.92it/s]      2%|2         | 1536/65536 [00:02<01:24, 759.24it/s]      2%|2         | 1612/65536 [00:02<01:24, 758.19it/s]      3%|2         | 1690/65536 [00:02<01:23, 762.06it/s]      3%|2         | 1768/65536 [00:02<01:23, 765.46it/s]      3%|2         | 1845/65536 [00:02<01:23, 766.36it/s]      3%|2         | 1922/65536 [00:02<01:22, 766.63it/s]      3%|3         | 1999/65536 [00:02<01:22, 766.93it/s]      3%|3         | 2076/65536 [00:03<01:23, 761.21it/s]      3%|3         | 2154/65536 [00:03<01:22, 764.59it/s]      3%|3         | 2231/65536 [00:03<01:22, 764.18it/s]      4%|3         | 2308/65536 [00:03<01:22, 762.81it/s]      4%|3         | 2385/65536 [00:03<01:23, 757.48it/s]      4%|3         | 2462/65536 [00:03<01:23, 758.97it/s]      4%|3         | 2538/65536 [00:03<01:23, 755.25it/s]      4%|3         | 2614/65536 [00:03<01:23, 753.86it/s]      4%|4         | 2690/65536 [00:03<01:23, 753.65it/s]      4%|4         | 2766/65536 [00:03<01:23, 753.33it/s]      4%|4         | 2842/65536 [00:04<01:23, 751.51it/s]      4%|4         | 2918/65536 [00:04<01:23, 753.27it/s]      5%|4         | 2994/65536 [00:04<01:23, 752.97it/s]      5%|4         | 3070/65536 [00:04<01:22, 753.08it/s]      5%|4         | 3148/65536 [00:04<01:22, 759.90it/s]      5%|4         | 3227/65536 [00:04<01:21, 766.36it/s]      5%|5         | 3305/65536 [00:04<01:20, 769.19it/s]      5%|5         | 3383/65536 [00:04<01:20, 771.67it/s]      5%|5         | 3461/65536 [00:04<01:20, 773.98it/s]      5%|5         | 3539/65536 [00:04<01:20, 774.64it/s]      6%|5         | 3617/65536 [00:05<01:20, 773.89it/s]      6%|5         | 3695/65536 [00:05<01:20, 772.36it/s]      6%|5         | 3774/65536 [00:05<01:19, 775.55it/s]      6%|5         | 3852/65536 [00:05<01:19, 775.67it/s]      6%|5         | 3930/65536 [00:05<01:19, 776.14it/s]      6%|6         | 4008/65536 [00:05<01:19, 776.68it/s]      6%|6         | 4086/65536 [00:05<01:19, 776.90it/s]      6%|6         | 4164/65536 [00:05<01:19, 776.13it/s]      6%|6         | 4242/65536 [00:05<01:19, 773.86it/s]      7%|6         | 4320/65536 [00:05<01:18, 774.89it/s]      7%|6         | 4398/65536 [00:06<01:19, 770.34it/s]      7%|6         | 4476/65536 [00:06<01:19, 768.93it/s]      7%|6         | 4553/65536 [00:06<01:19, 769.17it/s]      7%|7         | 4631/65536 [00:06<01:19, 770.32it/s]      7%|7         | 4709/65536 [00:06<01:18, 770.40it/s]      7%|7         | 4787/65536 [00:06<01:18, 771.84it/s]      7%|7         | 4865/65536 [00:06<01:18, 774.20it/s]      8%|7         | 4943/65536 [00:06<01:18, 771.82it/s]      8%|7         | 5021/65536 [00:06<01:19, 760.98it/s]      8%|7         | 5098/65536 [00:06<01:19, 757.91it/s]      8%|7         | 5174/65536 [00:07<01:19, 755.62it/s]      8%|8         | 5250/65536 [00:07<01:19, 756.60it/s]      8%|8         | 5326/65536 [00:07<01:19, 757.24it/s]      8%|8         | 5403/65536 [00:07<01:19, 758.67it/s]      8%|8         | 5479/65536 [00:07<01:19, 758.69it/s]      8%|8         | 5557/65536 [00:07<01:18, 763.18it/s]      9%|8         | 5635/65536 [00:07<01:18, 767.81it/s]      9%|8         | 5713/65536 [00:07<01:17, 769.53it/s]      9%|8         | 5790/65536 [00:07<01:18, 765.05it/s]      9%|8         | 5867/65536 [00:08<01:18, 757.83it/s]      9%|9         | 5943/65536 [00:08<01:19, 752.68it/s]      9%|9         | 6019/65536 [00:08<01:19, 750.78it/s]      9%|9         | 6096/65536 [00:08<01:18, 754.07it/s]      9%|9         | 6174/65536 [00:08<01:18, 759.42it/s]     10%|9         | 6251/65536 [00:08<01:17, 761.00it/s]     10%|9         | 6328/65536 [00:08<01:17, 759.23it/s]     10%|9         | 6405/65536 [00:08<01:17, 759.64it/s]     10%|9         | 6483/65536 [00:08<01:17, 763.15it/s]     10%|#         | 6560/65536 [00:08<01:17, 762.32it/s]     10%|#         | 6638/65536 [00:09<01:16, 764.96it/s]     10%|#         | 6715/65536 [00:09<01:16, 764.06it/s]     10%|#         | 6792/65536 [00:09<01:16, 764.93it/s]     10%|#         | 6869/65536 [00:09<01:16, 762.99it/s]     11%|#         | 6946/65536 [00:09<01:16, 764.78it/s]     11%|#         | 7023/65536 [00:09<01:16, 765.02it/s]     11%|#         | 7100/65536 [00:09<01:17, 757.51it/s]     11%|#         | 7177/65536 [00:09<01:16, 759.03it/s]     11%|#1        | 7254/65536 [00:09<01:16, 760.96it/s]     11%|#1        | 7331/65536 [00:09<01:17, 752.06it/s]     11%|#1        | 7407/65536 [00:10<01:17, 751.71it/s]     11%|#1        | 7484/65536 [00:10<01:16, 754.54it/s]     12%|#1        | 7561/65536 [00:10<01:16, 757.70it/s]     12%|#1        | 7637/65536 [00:10<01:16, 757.99it/s]     12%|#1        | 7713/65536 [00:10<01:16, 757.55it/s]     12%|#1        | 7790/65536 [00:10<01:15, 760.29it/s]     12%|#2        | 7867/65536 [00:10<01:15, 758.92it/s]     12%|#2        | 7943/65536 [00:10<01:16, 754.61it/s]     12%|#2        | 8019/65536 [00:10<01:16, 754.17it/s]     12%|#2        | 8095/65536 [00:10<01:16, 750.75it/s]     12%|#2        | 8171/65536 [00:11<01:16, 748.77it/s]     13%|#2        | 8248/65536 [00:11<01:16, 753.56it/s]     13%|#2        | 8327/65536 [00:11<01:15, 761.56it/s]     13%|#2        | 8404/65536 [00:11<01:14, 763.00it/s]     13%|#2        | 8481/65536 [00:11<01:14, 764.39it/s]     13%|#3        | 8558/65536 [00:11<01:14, 765.14it/s]     13%|#3        | 8635/65536 [00:11<01:14, 760.82it/s]     13%|#3        | 8712/65536 [00:11<01:14, 762.52it/s]     13%|#3        | 8789/65536 [00:11<01:14, 761.44it/s]     14%|#3        | 8866/65536 [00:11<01:14, 755.67it/s]     14%|#3        | 8942/65536 [00:12<01:15, 747.42it/s]     14%|#3        | 9017/65536 [00:12<01:15, 747.25it/s]     14%|#3        | 9092/65536 [00:12<01:15, 747.97it/s]     14%|#3        | 9170/65536 [00:12<01:14, 755.56it/s]     14%|#4        | 9248/65536 [00:12<01:13, 761.11it/s]     14%|#4        | 9326/65536 [00:12<01:13, 766.28it/s]     14%|#4        | 9404/65536 [00:12<01:13, 767.48it/s]     14%|#4        | 9481/65536 [00:12<01:13, 763.36it/s]     15%|#4        | 9558/65536 [00:12<01:13, 760.49it/s]     15%|#4        | 9635/65536 [00:12<01:13, 760.25it/s]     15%|#4        | 9712/65536 [00:13<01:13, 755.40it/s]     15%|#4        | 9788/65536 [00:13<01:13, 755.16it/s]     15%|#5        | 9865/65536 [00:13<01:13, 758.25it/s]     15%|#5        | 9942/65536 [00:13<01:13, 759.61it/s]     15%|#5        | 10020/65536 [00:13<01:12, 763.84it/s]     15%|#5        | 10098/65536 [00:13<01:12, 767.66it/s]     16%|#5        | 10176/65536 [00:13<01:11, 771.29it/s]     16%|#5        | 10254/65536 [00:13<01:11, 773.58it/s]     16%|#5        | 10332/65536 [00:13<01:11, 770.88it/s]     16%|#5        | 10411/65536 [00:13<01:11, 773.93it/s]     16%|#6        | 10490/65536 [00:14<01:10, 775.88it/s]     16%|#6        | 10569/65536 [00:14<01:10, 777.43it/s]     16%|#6        | 10648/65536 [00:14<01:10, 779.12it/s]     16%|#6        | 10727/65536 [00:14<01:10, 781.07it/s]     16%|#6        | 10806/65536 [00:14<01:10, 781.46it/s]     17%|#6        | 10885/65536 [00:14<01:09, 781.75it/s]     17%|#6        | 10964/65536 [00:14<01:09, 782.30it/s]     17%|#6        | 11043/65536 [00:14<01:09, 782.96it/s]     17%|#6        | 11122/65536 [00:14<01:09, 783.72it/s]     17%|#7        | 11201/65536 [00:14<01:09, 784.30it/s]     17%|#7        | 11280/65536 [00:15<01:09, 784.68it/s]     17%|#7        | 11359/65536 [00:15<01:09, 784.62it/s]     17%|#7        | 11438/65536 [00:15<01:08, 784.44it/s]     18%|#7        | 11517/65536 [00:15<01:08, 784.93it/s]     18%|#7        | 11596/65536 [00:15<01:08, 785.00it/s]     18%|#7        | 11675/65536 [00:15<01:08, 784.75it/s]     18%|#7        | 11754/65536 [00:15<01:08, 784.97it/s]     18%|#8        | 11833/65536 [00:15<01:08, 785.27it/s]     18%|#8        | 11912/65536 [00:15<01:08, 783.92it/s]     18%|#8        | 11991/65536 [00:15<01:08, 780.70it/s]     18%|#8        | 12070/65536 [00:16<01:08, 779.33it/s]     19%|#8        | 12148/65536 [00:16<01:08, 778.04it/s]     19%|#8        | 12226/65536 [00:16<01:08, 776.52it/s]     19%|#8        | 12304/65536 [00:16<01:08, 776.22it/s]     19%|#8        | 12383/65536 [00:16<01:08, 777.60it/s]     19%|#9        | 12461/65536 [00:16<01:08, 778.16it/s]     19%|#9        | 12540/65536 [00:16<01:08, 779.12it/s]     19%|#9        | 12619/65536 [00:16<01:07, 780.19it/s]     19%|#9        | 12698/65536 [00:16<01:07, 780.77it/s]     19%|#9        | 12777/65536 [00:17<01:07, 780.81it/s]     20%|#9        | 12856/65536 [00:17<01:07, 781.09it/s]     20%|#9        | 12935/65536 [00:17<01:07, 781.35it/s]     20%|#9        | 13014/65536 [00:17<01:07, 781.43it/s]     20%|#9        | 13093/65536 [00:17<01:07, 781.56it/s]     20%|##        | 13172/65536 [00:17<01:06, 782.09it/s]     20%|##        | 13251/65536 [00:17<01:06, 782.07it/s]     20%|##        | 13330/65536 [00:17<01:06, 782.79it/s]     20%|##        | 13409/65536 [00:17<01:06, 782.88it/s]     21%|##        | 13488/65536 [00:17<01:06, 781.51it/s]     21%|##        | 13567/65536 [00:18<01:06, 780.50it/s]     21%|##        | 13646/65536 [00:18<01:06, 781.01it/s]     21%|##        | 13725/65536 [00:18<01:06, 781.31it/s]     21%|##1       | 13804/65536 [00:18<01:06, 776.55it/s]     21%|##1       | 13882/65536 [00:18<01:07, 765.36it/s]     21%|##1       | 13959/65536 [00:18<01:07, 762.47it/s]     21%|##1       | 14036/65536 [00:18<01:08, 755.63it/s]     22%|##1       | 14113/65536 [00:18<01:07, 756.98it/s]     22%|##1       | 14189/65536 [00:18<01:07, 756.46it/s]     22%|##1       | 14266/65536 [00:18<01:07, 759.21it/s]     22%|##1       | 14344/65536 [00:19<01:06, 764.81it/s]     22%|##2       | 14421/65536 [00:19<01:06, 765.64it/s]     22%|##2       | 14498/65536 [00:19<01:06, 766.72it/s]     22%|##2       | 14576/65536 [00:19<01:06, 770.60it/s]     22%|##2       | 14655/65536 [00:19<01:05, 774.02it/s]     22%|##2       | 14734/65536 [00:19<01:05, 776.56it/s]     23%|##2       | 14812/65536 [00:19<01:05, 775.10it/s]     23%|##2       | 14890/65536 [00:19<01:05, 776.17it/s]     23%|##2       | 14968/65536 [00:19<01:05, 775.17it/s]     23%|##2       | 15047/65536 [00:19<01:05, 776.71it/s]     23%|##3       | 15125/65536 [00:20<01:04, 775.82it/s]     23%|##3       | 15203/65536 [00:20<01:05, 773.61it/s]     23%|##3       | 15281/65536 [00:20<01:05, 771.68it/s]     23%|##3       | 15359/65536 [00:20<01:05, 771.82it/s]     24%|##3       | 15438/65536 [00:20<01:04, 774.35it/s]     24%|##3       | 15516/65536 [00:20<01:04, 774.77it/s]     24%|##3       | 15594/65536 [00:20<01:05, 760.91it/s]     24%|##3       | 15671/65536 [00:20<01:05, 762.90it/s]     24%|##4       | 15749/65536 [00:20<01:04, 766.93it/s]     24%|##4       | 15827/65536 [00:20<01:04, 770.30it/s]     24%|##4       | 15906/65536 [00:21<01:04, 774.10it/s]     24%|##4       | 15985/65536 [00:21<01:03, 776.95it/s]     25%|##4       | 16064/65536 [00:21<01:03, 779.14it/s]     25%|##4       | 16142/65536 [00:21<01:03, 779.32it/s]     25%|##4       | 16220/65536 [00:21<01:03, 779.45it/s]     25%|##4       | 16299/65536 [00:21<01:03, 779.78it/s]     25%|##4       | 16378/65536 [00:21<01:03, 780.04it/s]     25%|##5       | 16457/65536 [00:21<01:02, 780.65it/s]     25%|##5       | 16536/65536 [00:21<01:02, 780.62it/s]     25%|##5       | 16615/65536 [00:21<01:02, 781.18it/s]     25%|##5       | 16694/65536 [00:22<01:02, 781.58it/s]     26%|##5       | 16773/65536 [00:22<01:02, 782.07it/s]     26%|##5       | 16852/65536 [00:22<01:02, 782.88it/s]     26%|##5       | 16931/65536 [00:22<01:02, 782.20it/s]     26%|##5       | 17010/65536 [00:22<01:01, 783.31it/s]     26%|##6       | 17089/65536 [00:22<01:01, 783.97it/s]     26%|##6       | 17168/65536 [00:22<01:01, 783.84it/s]     26%|##6       | 17247/65536 [00:22<01:01, 783.24it/s]     26%|##6       | 17326/65536 [00:22<01:01, 782.83it/s]     27%|##6       | 17405/65536 [00:22<01:01, 783.18it/s]     27%|##6       | 17484/65536 [00:23<01:01, 780.54it/s]     27%|##6       | 17563/65536 [00:23<01:01, 776.35it/s]     27%|##6       | 17642/65536 [00:23<01:01, 778.75it/s]     27%|##7       | 17720/65536 [00:23<01:01, 776.77it/s]     27%|##7       | 17798/65536 [00:23<01:01, 775.28it/s]     27%|##7       | 17876/65536 [00:23<01:01, 773.05it/s]     27%|##7       | 17954/65536 [00:23<01:01, 774.89it/s]     28%|##7       | 18032/65536 [00:23<01:01, 773.03it/s]     28%|##7       | 18110/65536 [00:23<01:01, 773.54it/s]     28%|##7       | 18188/65536 [00:23<01:01, 771.89it/s]     28%|##7       | 18267/65536 [00:24<01:00, 774.90it/s]     28%|##7       | 18345/65536 [00:24<01:01, 772.87it/s]     28%|##8       | 18423/65536 [00:24<01:01, 770.07it/s]     28%|##8       | 18501/65536 [00:24<01:00, 771.23it/s]     28%|##8       | 18579/65536 [00:24<01:01, 768.50it/s]     28%|##8       | 18657/65536 [00:24<01:00, 770.05it/s]     29%|##8       | 18735/65536 [00:24<01:00, 768.70it/s]     29%|##8       | 18812/65536 [00:24<01:00, 768.22it/s]     29%|##8       | 18890/65536 [00:24<01:00, 769.77it/s]     29%|##8       | 18967/65536 [00:24<01:00, 769.79it/s]     29%|##9       | 19044/65536 [00:25<01:00, 766.74it/s]     29%|##9       | 19121/65536 [00:25<01:00, 765.85it/s]     29%|##9       | 19198/65536 [00:25<01:00, 766.82it/s]     29%|##9       | 19276/65536 [00:25<01:00, 770.70it/s]     30%|##9       | 19355/65536 [00:25<00:59, 773.83it/s]     30%|##9       | 19433/65536 [00:25<00:59, 774.15it/s]     30%|##9       | 19511/65536 [00:25<01:00, 765.56it/s]     30%|##9       | 19588/65536 [00:25<01:00, 756.54it/s]     30%|###       | 19664/65536 [00:25<01:00, 752.29it/s]     30%|###       | 19740/65536 [00:26<01:01, 745.42it/s]     30%|###       | 19815/65536 [00:26<01:01, 741.83it/s]     30%|###       | 19890/65536 [00:26<01:01, 740.91it/s]     30%|###       | 19965/65536 [00:26<01:01, 738.98it/s]     31%|###       | 20043/65536 [00:26<01:00, 748.44it/s]     31%|###       | 20121/65536 [00:26<01:00, 755.26it/s]     31%|###       | 20199/65536 [00:26<00:59, 762.12it/s]     31%|###       | 20278/65536 [00:26<00:58, 767.73it/s]     31%|###1      | 20355/65536 [00:26<00:58, 766.91it/s]     31%|###1      | 20432/65536 [00:26<00:59, 760.29it/s]     31%|###1      | 20509/65536 [00:27<00:59, 761.22it/s]     31%|###1      | 20586/65536 [00:27<00:58, 763.16it/s]     32%|###1      | 20663/65536 [00:27<00:58, 761.52it/s]     32%|###1      | 20740/65536 [00:27<00:59, 758.94it/s]     32%|###1      | 20816/65536 [00:27<00:59, 756.90it/s]     32%|###1      | 20893/65536 [00:27<00:58, 758.39it/s]     32%|###1      | 20970/65536 [00:27<00:58, 760.94it/s]     32%|###2      | 21047/65536 [00:27<00:58, 763.20it/s]     32%|###2      | 21125/65536 [00:27<00:58, 765.50it/s]     32%|###2      | 21203/65536 [00:27<00:57, 768.27it/s]     32%|###2      | 21280/65536 [00:28<00:57, 768.28it/s]     33%|###2      | 21358/65536 [00:28<00:57, 770.40it/s]     33%|###2      | 21436/65536 [00:28<00:57, 772.97it/s]     33%|###2      | 21514/65536 [00:28<00:57, 768.58it/s]     33%|###2      | 21591/65536 [00:28<00:57, 766.54it/s]     33%|###3      | 21669/65536 [00:28<00:57, 768.80it/s]     33%|###3      | 21746/65536 [00:28<00:58, 753.03it/s]     33%|###3      | 21822/65536 [00:28<00:58, 749.69it/s]     33%|###3      | 21898/65536 [00:28<00:58, 746.95it/s]     34%|###3      | 21973/65536 [00:28<00:58, 747.38it/s]     34%|###3      | 22050/65536 [00:29<00:57, 751.60it/s]     34%|###3      | 22126/65536 [00:29<00:58, 747.27it/s]     34%|###3      | 22201/65536 [00:29<00:58, 746.35it/s]     34%|###3      | 22277/65536 [00:29<00:57, 747.75it/s]     34%|###4      | 22353/65536 [00:29<00:57, 748.69it/s]     34%|###4      | 22428/65536 [00:29<00:57, 746.66it/s]     34%|###4      | 22503/65536 [00:29<00:57, 742.11it/s]     34%|###4      | 22578/65536 [00:29<00:58, 739.64it/s]     35%|###4      | 22653/65536 [00:29<00:57, 741.44it/s]     35%|###4      | 22728/65536 [00:29<00:57, 743.78it/s]     35%|###4      | 22803/65536 [00:30<00:57, 741.98it/s]     35%|###4      | 22878/65536 [00:30<00:57, 743.63it/s]     35%|###5      | 22953/65536 [00:30<00:57, 745.07it/s]     35%|###5      | 23030/65536 [00:30<00:56, 750.70it/s]     35%|###5      | 23108/65536 [00:30<00:56, 757.52it/s]     35%|###5      | 23185/65536 [00:30<00:55, 759.88it/s]     35%|###5      | 23261/65536 [00:30<00:55, 759.23it/s]     36%|###5      | 23339/65536 [00:30<00:55, 763.43it/s]     36%|###5      | 23417/65536 [00:30<00:54, 768.15it/s]     36%|###5      | 23495/65536 [00:30<00:54, 769.90it/s]     36%|###5      | 23572/65536 [00:31<00:54, 768.90it/s]     36%|###6      | 23650/65536 [00:31<00:54, 771.49it/s]     36%|###6      | 23729/65536 [00:31<00:53, 774.86it/s]     36%|###6      | 23808/65536 [00:31<00:53, 777.48it/s]     36%|###6      | 23887/65536 [00:31<00:53, 779.17it/s]     37%|###6      | 23965/65536 [00:31<00:53, 779.34it/s]     37%|###6      | 24044/65536 [00:31<00:53, 780.53it/s]     37%|###6      | 24123/65536 [00:31<00:53, 779.14it/s]     37%|###6      | 24202/65536 [00:31<00:52, 780.88it/s]     37%|###7      | 24281/65536 [00:31<00:52, 781.94it/s]     37%|###7      | 24360/65536 [00:32<00:52, 780.53it/s]     37%|###7      | 24439/65536 [00:32<00:52, 780.43it/s]     37%|###7      | 24518/65536 [00:32<00:52, 775.63it/s]     38%|###7      | 24596/65536 [00:32<00:52, 773.15it/s]     38%|###7      | 24674/65536 [00:32<00:53, 770.94it/s]     38%|###7      | 24752/65536 [00:32<00:52, 772.16it/s]     38%|###7      | 24830/65536 [00:32<00:53, 763.40it/s]     38%|###8      | 24907/65536 [00:32<00:53, 763.05it/s]     38%|###8      | 24984/65536 [00:32<00:53, 763.31it/s]     38%|###8      | 25062/65536 [00:33<00:52, 765.46it/s]     38%|###8      | 25139/65536 [00:33<00:52, 766.29it/s]     38%|###8      | 25217/65536 [00:33<00:52, 768.58it/s]     39%|###8      | 25295/65536 [00:33<00:52, 770.78it/s]     39%|###8      | 25374/65536 [00:33<00:51, 774.19it/s]     39%|###8      | 25453/65536 [00:33<00:51, 776.58it/s]     39%|###8      | 25531/65536 [00:33<00:51, 770.86it/s]     39%|###9      | 25609/65536 [00:33<00:51, 768.35it/s]     39%|###9      | 25686/65536 [00:33<00:52, 764.44it/s]     39%|###9      | 25763/65536 [00:33<00:52, 762.23it/s]     39%|###9      | 25840/65536 [00:34<00:52, 761.83it/s]     40%|###9      | 25917/65536 [00:34<00:52, 760.74it/s]     40%|###9      | 25994/65536 [00:34<00:52, 758.86it/s]     40%|###9      | 26070/65536 [00:34<00:52, 756.48it/s]     40%|###9      | 26146/65536 [00:34<00:52, 755.37it/s]     40%|####      | 26222/65536 [00:34<00:52, 753.52it/s]     40%|####      | 26300/65536 [00:34<00:51, 759.61it/s]     40%|####      | 26379/65536 [00:34<00:51, 766.54it/s]     40%|####      | 26458/65536 [00:34<00:50, 771.49it/s]     40%|####      | 26537/65536 [00:34<00:50, 775.62it/s]     41%|####      | 26616/65536 [00:35<00:50, 778.10it/s]     41%|####      | 26694/65536 [00:35<00:49, 778.31it/s]     41%|####      | 26773/65536 [00:35<00:49, 779.29it/s]     41%|####      | 26852/65536 [00:35<00:49, 780.59it/s]     41%|####1     | 26931/65536 [00:35<00:49, 781.77it/s]     41%|####1     | 27010/65536 [00:35<00:49, 782.60it/s]     41%|####1     | 27089/65536 [00:35<00:49, 782.63it/s]     41%|####1     | 27168/65536 [00:35<00:48, 783.58it/s]     42%|####1     | 27247/65536 [00:35<00:48, 784.33it/s]     42%|####1     | 27326/65536 [00:35<00:48, 784.72it/s]     42%|####1     | 27405/65536 [00:36<00:48, 784.91it/s]     42%|####1     | 27484/65536 [00:36<00:48, 785.21it/s]     42%|####2     | 27563/65536 [00:36<00:48, 786.06it/s]     42%|####2     | 27642/65536 [00:36<00:48, 786.29it/s]     42%|####2     | 27721/65536 [00:36<00:48, 786.32it/s]     42%|####2     | 27800/65536 [00:36<00:47, 786.32it/s]     43%|####2     | 27879/65536 [00:36<00:47, 785.94it/s]     43%|####2     | 27958/65536 [00:36<00:48, 782.61it/s]     43%|####2     | 28037/65536 [00:36<00:47, 782.27it/s]     43%|####2     | 28116/65536 [00:36<00:47, 782.51it/s]     43%|####3     | 28195/65536 [00:37<00:47, 782.48it/s]     43%|####3     | 28274/65536 [00:37<00:47, 781.06it/s]     43%|####3     | 28353/65536 [00:37<00:47, 780.22it/s]     43%|####3     | 28432/65536 [00:37<00:47, 779.94it/s]     44%|####3     | 28510/65536 [00:37<00:47, 778.82it/s]     44%|####3     | 28588/65536 [00:37<00:47, 771.13it/s]     44%|####3     | 28666/65536 [00:37<00:47, 770.38it/s]     44%|####3     | 28744/65536 [00:37<00:47, 772.57it/s]     44%|####3     | 28822/65536 [00:37<00:47, 768.53it/s]     44%|####4     | 28899/65536 [00:37<00:47, 768.76it/s]     44%|####4     | 28978/65536 [00:38<00:47, 772.40it/s]     44%|####4     | 29056/65536 [00:38<00:47, 774.40it/s]     44%|####4     | 29135/65536 [00:38<00:46, 777.56it/s]     45%|####4     | 29214/65536 [00:38<00:46, 779.74it/s]     45%|####4     | 29293/65536 [00:38<00:46, 781.42it/s]     45%|####4     | 29372/65536 [00:38<00:46, 782.95it/s]     45%|####4     | 29451/65536 [00:38<00:46, 781.66it/s]     45%|####5     | 29530/65536 [00:38<00:46, 779.56it/s]     45%|####5     | 29609/65536 [00:38<00:46, 780.39it/s]     45%|####5     | 29688/65536 [00:38<00:46, 779.14it/s]     45%|####5     | 29767/65536 [00:39<00:45, 779.69it/s]     46%|####5     | 29846/65536 [00:39<00:45, 780.20it/s]     46%|####5     | 29925/65536 [00:39<00:45, 780.97it/s]     46%|####5     | 30004/65536 [00:39<00:45, 780.96it/s]     46%|####5     | 30083/65536 [00:39<00:45, 780.30it/s]     46%|####6     | 30162/65536 [00:39<00:45, 781.78it/s]     46%|####6     | 30241/65536 [00:39<00:45, 780.04it/s]     46%|####6     | 30320/65536 [00:39<00:45, 781.77it/s]     46%|####6     | 30399/65536 [00:39<00:44, 782.59it/s]     47%|####6     | 30478/65536 [00:39<00:44, 783.73it/s]     47%|####6     | 30557/65536 [00:40<00:44, 783.63it/s]     47%|####6     | 30636/65536 [00:40<00:44, 784.01it/s]     47%|####6     | 30715/65536 [00:40<00:44, 785.32it/s]     47%|####6     | 30794/65536 [00:40<00:44, 783.53it/s]     47%|####7     | 30873/65536 [00:40<00:44, 780.82it/s]     47%|####7     | 30952/65536 [00:40<00:44, 773.69it/s]     47%|####7     | 31030/65536 [00:40<00:44, 771.33it/s]     47%|####7     | 31108/65536 [00:40<00:44, 773.12it/s]     48%|####7     | 31186/65536 [00:40<00:44, 774.48it/s]     48%|####7     | 31264/65536 [00:40<00:44, 772.44it/s]     48%|####7     | 31342/65536 [00:41<00:44, 770.20it/s]     48%|####7     | 31421/65536 [00:41<00:44, 773.16it/s]     48%|####8     | 31499/65536 [00:41<00:43, 774.13it/s]     48%|####8     | 31577/65536 [00:41<00:43, 774.58it/s]     48%|####8     | 31656/65536 [00:41<00:43, 777.05it/s]     48%|####8     | 31734/65536 [00:41<00:43, 775.80it/s]     49%|####8     | 31813/65536 [00:41<00:43, 778.20it/s]     49%|####8     | 31891/65536 [00:41<00:43, 778.42it/s]     49%|####8     | 31969/65536 [00:41<00:43, 776.54it/s]     49%|####8     | 32048/65536 [00:41<00:42, 778.86it/s]     49%|####9     | 32126/65536 [00:42<00:42, 777.12it/s]     49%|####9     | 32204/65536 [00:42<00:42, 777.43it/s]     49%|####9     | 32282/65536 [00:42<00:42, 778.13it/s]     49%|####9     | 32361/65536 [00:42<00:42, 779.39it/s]     49%|####9     | 32439/65536 [00:42<00:42, 775.24it/s]     50%|####9     | 32517/65536 [00:42<00:42, 773.43it/s]     50%|####9     | 32595/65536 [00:42<00:42, 774.77it/s]     50%|####9     | 32673/65536 [00:42<00:42, 775.31it/s]     50%|####9     | 32751/65536 [00:42<00:42, 774.37it/s]     50%|#####     | 32829/65536 [00:43<00:42, 774.71it/s]     50%|#####     | 32907/65536 [00:43<00:42, 773.05it/s]     50%|#####     | 32985/65536 [00:43<00:42, 774.62it/s]     50%|#####     | 33063/65536 [00:43<00:41, 775.79it/s]     51%|#####     | 33141/65536 [00:43<00:42, 769.14it/s]     51%|#####     | 33219/65536 [00:43<00:41, 771.18it/s]     51%|#####     | 33297/65536 [00:43<00:41, 773.43it/s]     51%|#####     | 33375/65536 [00:43<00:41, 773.42it/s]     51%|#####1    | 33453/65536 [00:43<00:41, 772.18it/s]     51%|#####1    | 33531/65536 [00:43<00:41, 772.55it/s]     51%|#####1    | 33609/65536 [00:44<00:41, 771.68it/s]     51%|#####1    | 33687/65536 [00:44<00:41, 773.99it/s]     52%|#####1    | 33765/65536 [00:44<00:41, 773.75it/s]     52%|#####1    | 33843/65536 [00:44<00:42, 747.27it/s]     52%|#####1    | 33919/65536 [00:44<00:42, 748.34it/s]     52%|#####1    | 33997/65536 [00:44<00:41, 757.59it/s]     52%|#####1    | 34075/65536 [00:44<00:41, 763.09it/s]     52%|#####2    | 34152/65536 [00:44<00:41, 763.03it/s]     52%|#####2    | 34229/65536 [00:44<00:40, 765.01it/s]     52%|#####2    | 34306/65536 [00:44<00:40, 763.59it/s]     52%|#####2    | 34383/65536 [00:45<00:40, 763.35it/s]     53%|#####2    | 34461/65536 [00:45<00:40, 768.12it/s]     53%|#####2    | 34538/65536 [00:45<00:40, 766.59it/s]     53%|#####2    | 34616/65536 [00:45<00:40, 768.59it/s]     53%|#####2    | 34695/65536 [00:45<00:39, 772.00it/s]     53%|#####3    | 34773/65536 [00:45<00:39, 769.38it/s]     53%|#####3    | 34850/65536 [00:45<00:40, 765.15it/s]     53%|#####3    | 34928/65536 [00:45<00:39, 767.06it/s]     53%|#####3    | 35007/65536 [00:45<00:39, 771.46it/s]     54%|#####3    | 35085/65536 [00:45<00:39, 772.26it/s]     54%|#####3    | 35163/65536 [00:46<00:39, 769.77it/s]     54%|#####3    | 35240/65536 [00:46<00:39, 768.66it/s]     54%|#####3    | 35317/65536 [00:46<00:39, 765.74it/s]     54%|#####4    | 35394/65536 [00:46<00:39, 753.84it/s]     54%|#####4    | 35470/65536 [00:46<00:39, 753.05it/s]     54%|#####4    | 35547/65536 [00:46<00:39, 757.18it/s]     54%|#####4    | 35624/65536 [00:46<00:39, 758.64it/s]     54%|#####4    | 35702/65536 [00:46<00:39, 762.89it/s]     55%|#####4    | 35779/65536 [00:46<00:38, 763.80it/s]     55%|#####4    | 35856/65536 [00:46<00:38, 763.76it/s]     55%|#####4    | 35933/65536 [00:47<00:38, 764.50it/s]     55%|#####4    | 36011/65536 [00:47<00:38, 768.62it/s]     55%|#####5    | 36090/65536 [00:47<00:38, 773.19it/s]     55%|#####5    | 36169/65536 [00:47<00:37, 775.82it/s]     55%|#####5    | 36248/65536 [00:47<00:37, 777.24it/s]     55%|#####5    | 36327/65536 [00:47<00:37, 779.04it/s]     56%|#####5    | 36406/65536 [00:47<00:37, 780.43it/s]     56%|#####5    | 36485/65536 [00:47<00:37, 781.90it/s]     56%|#####5    | 36564/65536 [00:47<00:37, 782.66it/s]     56%|#####5    | 36643/65536 [00:47<00:36, 781.95it/s]     56%|#####6    | 36722/65536 [00:48<00:36, 782.98it/s]     56%|#####6    | 36801/65536 [00:48<00:36, 782.02it/s]     56%|#####6    | 36880/65536 [00:48<00:36, 782.88it/s]     56%|#####6    | 36959/65536 [00:48<00:36, 783.15it/s]     57%|#####6    | 37038/65536 [00:48<00:36, 783.72it/s]     57%|#####6    | 37117/65536 [00:48<00:36, 784.22it/s]     57%|#####6    | 37196/65536 [00:48<00:36, 784.92it/s]     57%|#####6    | 37275/65536 [00:48<00:35, 785.49it/s]     57%|#####6    | 37354/65536 [00:48<00:35, 786.01it/s]     57%|#####7    | 37433/65536 [00:48<00:35, 785.80it/s]     57%|#####7    | 37512/65536 [00:49<00:35, 785.50it/s]     57%|#####7    | 37591/65536 [00:49<00:35, 785.11it/s]     57%|#####7    | 37670/65536 [00:49<00:35, 785.43it/s]     58%|#####7    | 37749/65536 [00:49<00:35, 785.59it/s]     58%|#####7    | 37828/65536 [00:49<00:35, 785.75it/s]     58%|#####7    | 37907/65536 [00:49<00:35, 786.20it/s]     58%|#####7    | 37986/65536 [00:49<00:34, 787.33it/s]     58%|#####8    | 38065/65536 [00:49<00:34, 787.70it/s]     58%|#####8    | 38144/65536 [00:49<00:34, 787.42it/s]     58%|#####8    | 38223/65536 [00:49<00:34, 787.15it/s]     58%|#####8    | 38302/65536 [00:50<00:34, 786.05it/s]     59%|#####8    | 38381/65536 [00:50<00:34, 785.69it/s]     59%|#####8    | 38460/65536 [00:50<00:34, 785.81it/s]     59%|#####8    | 38539/65536 [00:50<00:34, 786.50it/s]     59%|#####8    | 38618/65536 [00:50<00:34, 785.96it/s]     59%|#####9    | 38697/65536 [00:50<00:34, 784.00it/s]     59%|#####9    | 38776/65536 [00:50<00:34, 781.76it/s]     59%|#####9    | 38855/65536 [00:50<00:34, 781.76it/s]     59%|#####9    | 38934/65536 [00:50<00:34, 782.03it/s]     60%|#####9    | 39013/65536 [00:50<00:33, 782.98it/s]     60%|#####9    | 39092/65536 [00:51<00:33, 783.40it/s]     60%|#####9    | 39171/65536 [00:51<00:33, 783.60it/s]     60%|#####9    | 39250/65536 [00:51<00:33, 784.06it/s]     60%|######    | 39329/65536 [00:51<00:33, 784.55it/s]     60%|######    | 39408/65536 [00:51<00:33, 784.66it/s]     60%|######    | 39487/65536 [00:51<00:33, 785.06it/s]     60%|######    | 39566/65536 [00:51<00:33, 785.54it/s]     60%|######    | 39645/65536 [00:51<00:32, 786.09it/s]     61%|######    | 39724/65536 [00:51<00:32, 786.28it/s]     61%|######    | 39803/65536 [00:51<00:32, 785.66it/s]     61%|######    | 39882/65536 [00:52<00:32, 785.72it/s]     61%|######    | 39961/65536 [00:52<00:32, 785.70it/s]     61%|######1   | 40040/65536 [00:52<00:32, 785.93it/s]     61%|######1   | 40119/65536 [00:52<00:32, 786.17it/s]     61%|######1   | 40198/65536 [00:52<00:32, 786.02it/s]     61%|######1   | 40277/65536 [00:52<00:32, 785.58it/s]     62%|######1   | 40356/65536 [00:52<00:32, 784.78it/s]     62%|######1   | 40435/65536 [00:52<00:31, 785.11it/s]     62%|######1   | 40514/65536 [00:52<00:31, 785.59it/s]     62%|######1   | 40593/65536 [00:52<00:31, 783.78it/s]     62%|######2   | 40672/65536 [00:53<00:31, 784.55it/s]     62%|######2   | 40751/65536 [00:53<00:31, 783.64it/s]     62%|######2   | 40830/65536 [00:53<00:31, 783.95it/s]     62%|######2   | 40909/65536 [00:53<00:31, 784.64it/s]     63%|######2   | 40988/65536 [00:53<00:31, 785.12it/s]     63%|######2   | 41067/65536 [00:53<00:31, 785.33it/s]     63%|######2   | 41146/65536 [00:53<00:31, 785.00it/s]     63%|######2   | 41225/65536 [00:53<00:30, 785.72it/s]     63%|######3   | 41304/65536 [00:53<00:30, 785.39it/s]     63%|######3   | 41383/65536 [00:54<00:30, 785.90it/s]     63%|######3   | 41462/65536 [00:54<00:30, 783.13it/s]     63%|######3   | 41541/65536 [00:54<00:30, 783.46it/s]     64%|######3   | 41620/65536 [00:54<00:30, 782.01it/s]     64%|######3   | 41699/65536 [00:54<00:30, 778.43it/s]     64%|######3   | 41777/65536 [00:54<00:30, 776.41it/s]     64%|######3   | 41856/65536 [00:54<00:30, 778.47it/s]     64%|######3   | 41935/65536 [00:54<00:30, 780.59it/s]     64%|######4   | 42014/65536 [00:54<00:30, 781.45it/s]     64%|######4   | 42093/65536 [00:54<00:29, 782.50it/s]     64%|######4   | 42172/65536 [00:55<00:29, 783.33it/s]     64%|######4   | 42251/65536 [00:55<00:29, 784.24it/s]     65%|######4   | 42330/65536 [00:55<00:29, 784.51it/s]     65%|######4   | 42409/65536 [00:55<00:29, 783.32it/s]     65%|######4   | 42488/65536 [00:55<00:29, 782.07it/s]     65%|######4   | 42567/65536 [00:55<00:29, 777.04it/s]     65%|######5   | 42645/65536 [00:55<00:29, 771.83it/s]     65%|######5   | 42724/65536 [00:55<00:29, 774.53it/s]     65%|######5   | 42802/65536 [00:55<00:29, 770.21it/s]     65%|######5   | 42880/65536 [00:55<00:29, 768.84it/s]     66%|######5   | 42957/65536 [00:56<00:29, 766.25it/s]     66%|######5   | 43035/65536 [00:56<00:29, 767.56it/s]     66%|######5   | 43113/65536 [00:56<00:29, 770.33it/s]     66%|######5   | 43191/65536 [00:56<00:28, 772.57it/s]     66%|######6   | 43269/65536 [00:56<00:28, 773.33it/s]     66%|######6   | 43347/65536 [00:56<00:28, 774.96it/s]     66%|######6   | 43425/65536 [00:56<00:28, 772.64it/s]     66%|######6   | 43503/65536 [00:56<00:28, 774.00it/s]     67%|######6   | 43582/65536 [00:56<00:28, 775.77it/s]     67%|######6   | 43660/65536 [00:56<00:28, 775.88it/s]     67%|######6   | 43738/65536 [00:57<00:28, 772.13it/s]     67%|######6   | 43816/65536 [00:57<00:28, 768.70it/s]     67%|######6   | 43893/65536 [00:57<00:28, 763.74it/s]     67%|######7   | 43970/65536 [00:57<00:28, 751.80it/s]     67%|######7   | 44046/65536 [00:57<00:28, 749.50it/s]     67%|######7   | 44122/65536 [00:57<00:28, 750.15it/s]     67%|######7   | 44199/65536 [00:57<00:28, 753.31it/s]     68%|######7   | 44275/65536 [00:57<00:28, 749.18it/s]     68%|######7   | 44352/65536 [00:57<00:28, 754.06it/s]     68%|######7   | 44430/65536 [00:57<00:27, 759.47it/s]     68%|######7   | 44508/65536 [00:58<00:27, 764.38it/s]     68%|######8   | 44586/65536 [00:58<00:27, 767.01it/s]     68%|######8   | 44664/65536 [00:58<00:27, 768.92it/s]     68%|######8   | 44741/65536 [00:58<00:27, 769.07it/s]     68%|######8   | 44820/65536 [00:58<00:26, 773.56it/s]     69%|######8   | 44898/65536 [00:58<00:26, 773.75it/s]     69%|######8   | 44976/65536 [00:58<00:26, 773.07it/s]     69%|######8   | 45054/65536 [00:58<00:26, 772.70it/s]     69%|######8   | 45133/65536 [00:58<00:26, 775.49it/s]     69%|######8   | 45211/65536 [00:58<00:26, 776.58it/s]     69%|######9   | 45290/65536 [00:59<00:25, 779.22it/s]     69%|######9   | 45369/65536 [00:59<00:25, 781.00it/s]     69%|######9   | 45448/65536 [00:59<00:25, 782.72it/s]     69%|######9   | 45527/65536 [00:59<00:25, 783.24it/s]     70%|######9   | 45606/65536 [00:59<00:25, 783.52it/s]     70%|######9   | 45685/65536 [00:59<00:25, 783.92it/s]     70%|######9   | 45764/65536 [00:59<00:25, 784.20it/s]     70%|######9   | 45843/65536 [00:59<00:25, 784.29it/s]     70%|#######   | 45922/65536 [00:59<00:25, 784.48it/s]     70%|#######   | 46001/65536 [00:59<00:24, 784.55it/s]     70%|#######   | 46080/65536 [01:00<00:24, 784.52it/s]     70%|#######   | 46159/65536 [01:00<00:24, 784.48it/s]     71%|#######   | 46238/65536 [01:00<00:24, 784.89it/s]     71%|#######   | 46317/65536 [01:00<00:24, 785.00it/s]     71%|#######   | 46396/65536 [01:00<00:24, 785.84it/s]     71%|#######   | 46475/65536 [01:00<00:24, 785.98it/s]     71%|#######1  | 46554/65536 [01:00<00:24, 786.45it/s]     71%|#######1  | 46633/65536 [01:00<00:24, 786.46it/s]     71%|#######1  | 46712/65536 [01:00<00:24, 783.29it/s]     71%|#######1  | 46791/65536 [01:00<00:24, 778.80it/s]     72%|#######1  | 46869/65536 [01:01<00:23, 778.10it/s]     72%|#######1  | 46948/65536 [01:01<00:23, 779.74it/s]     72%|#######1  | 47026/65536 [01:01<00:23, 779.29it/s]     72%|#######1  | 47105/65536 [01:01<00:23, 779.69it/s]     72%|#######1  | 47184/65536 [01:01<00:23, 781.29it/s]     72%|#######2  | 47263/65536 [01:01<00:23, 778.07it/s]     72%|#######2  | 47341/65536 [01:01<00:23, 774.45it/s]     72%|#######2  | 47419/65536 [01:01<00:23, 770.37it/s]     72%|#######2  | 47497/65536 [01:01<00:23, 765.93it/s]     73%|#######2  | 47574/65536 [01:01<00:23, 766.82it/s]     73%|#######2  | 47651/65536 [01:02<00:23, 767.41it/s]     73%|#######2  | 47728/65536 [01:02<00:23, 764.43it/s]     73%|#######2  | 47805/65536 [01:02<00:23, 760.23it/s]     73%|#######3  | 47882/65536 [01:02<00:23, 761.04it/s]     73%|#######3  | 47960/65536 [01:02<00:22, 764.84it/s]     73%|#######3  | 48039/65536 [01:02<00:22, 770.71it/s]     73%|#######3  | 48118/65536 [01:02<00:22, 775.28it/s]     74%|#######3  | 48197/65536 [01:02<00:22, 778.27it/s]     74%|#######3  | 48276/65536 [01:02<00:22, 780.20it/s]     74%|#######3  | 48355/65536 [01:03<00:22, 780.81it/s]     74%|#######3  | 48434/65536 [01:03<00:21, 782.25it/s]     74%|#######4  | 48513/65536 [01:03<00:21, 781.55it/s]     74%|#######4  | 48592/65536 [01:03<00:21, 782.35it/s]     74%|#######4  | 48671/65536 [01:03<00:21, 782.82it/s]     74%|#######4  | 48750/65536 [01:03<00:21, 783.30it/s]     75%|#######4  | 48829/65536 [01:03<00:21, 783.62it/s]     75%|#######4  | 48908/65536 [01:03<00:21, 783.82it/s]     75%|#######4  | 48987/65536 [01:03<00:21, 784.11it/s]     75%|#######4  | 49066/65536 [01:03<00:21, 784.07it/s]     75%|#######4  | 49145/65536 [01:04<00:20, 782.59it/s]     75%|#######5  | 49224/65536 [01:04<00:20, 781.43it/s]     75%|#######5  | 49303/65536 [01:04<00:20, 780.62it/s]     75%|#######5  | 49382/65536 [01:04<00:20, 781.47it/s]     75%|#######5  | 49461/65536 [01:04<00:20, 781.73it/s]     76%|#######5  | 49540/65536 [01:04<00:20, 782.57it/s]     76%|#######5  | 49619/65536 [01:04<00:20, 783.18it/s]     76%|#######5  | 49698/65536 [01:04<00:20, 783.57it/s]     76%|#######5  | 49777/65536 [01:04<00:20, 779.74it/s]     76%|#######6  | 49855/65536 [01:04<00:20, 767.69it/s]     76%|#######6  | 49932/65536 [01:05<00:20, 760.59it/s]     76%|#######6  | 50009/65536 [01:05<00:20, 762.45it/s]     76%|#######6  | 50086/65536 [01:05<00:20, 764.26it/s]     77%|#######6  | 50164/65536 [01:05<00:20, 768.02it/s]     77%|#######6  | 50242/65536 [01:05<00:19, 771.53it/s]     77%|#######6  | 50320/65536 [01:05<00:19, 770.03it/s]     77%|#######6  | 50399/65536 [01:05<00:19, 773.58it/s]     77%|#######7  | 50478/65536 [01:05<00:19, 776.08it/s]     77%|#######7  | 50557/65536 [01:05<00:19, 778.60it/s]     77%|#######7  | 50636/65536 [01:05<00:19, 780.19it/s]     77%|#######7  | 50715/65536 [01:06<00:19, 778.92it/s]     78%|#######7  | 50793/65536 [01:06<00:19, 774.88it/s]     78%|#######7  | 50871/65536 [01:06<00:18, 772.38it/s]     78%|#######7  | 50949/65536 [01:06<00:18, 770.99it/s]     78%|#######7  | 51027/65536 [01:06<00:18, 768.73it/s]     78%|#######7  | 51105/65536 [01:06<00:18, 769.87it/s]     78%|#######8  | 51183/65536 [01:06<00:18, 771.60it/s]     78%|#######8  | 51261/65536 [01:06<00:18, 773.22it/s]     78%|#######8  | 51339/65536 [01:06<00:18, 774.11it/s]     78%|#######8  | 51417/65536 [01:06<00:18, 771.21it/s]     79%|#######8  | 51496/65536 [01:07<00:18, 774.23it/s]     79%|#######8  | 51575/65536 [01:07<00:17, 777.68it/s]     79%|#######8  | 51654/65536 [01:07<00:17, 779.48it/s]     79%|#######8  | 51733/65536 [01:07<00:17, 780.38it/s]     79%|#######9  | 51812/65536 [01:07<00:17, 781.56it/s]     79%|#######9  | 51891/65536 [01:07<00:17, 782.80it/s]     79%|#######9  | 51970/65536 [01:07<00:17, 781.43it/s]     79%|#######9  | 52049/65536 [01:07<00:17, 780.32it/s]     80%|#######9  | 52128/65536 [01:07<00:17, 782.37it/s]     80%|#######9  | 52207/65536 [01:07<00:17, 783.39it/s]     80%|#######9  | 52286/65536 [01:08<00:16, 782.92it/s]     80%|#######9  | 52365/65536 [01:08<00:16, 783.96it/s]     80%|########  | 52444/65536 [01:08<00:17, 766.20it/s]     80%|########  | 52521/65536 [01:08<00:17, 762.85it/s]     80%|########  | 52598/65536 [01:08<00:17, 757.91it/s]     80%|########  | 52674/65536 [01:08<00:17, 754.02it/s]     80%|########  | 52752/65536 [01:08<00:16, 758.89it/s]     81%|########  | 52828/65536 [01:08<00:16, 758.74it/s]     81%|########  | 52904/65536 [01:08<00:16, 756.31it/s]     81%|########  | 52980/65536 [01:08<00:17, 716.24it/s]     81%|########  | 53054/65536 [01:09<00:17, 722.64it/s]     81%|########1 | 53129/65536 [01:09<00:17, 728.88it/s]     81%|########1 | 53203/65536 [01:09<00:16, 731.59it/s]     81%|########1 | 53278/65536 [01:09<00:16, 736.91it/s]     81%|########1 | 53356/65536 [01:09<00:16, 748.09it/s]     82%|########1 | 53435/65536 [01:09<00:15, 758.32it/s]     82%|########1 | 53512/65536 [01:09<00:15, 761.36it/s]     82%|########1 | 53589/65536 [01:09<00:15, 759.85it/s]     82%|########1 | 53666/65536 [01:09<00:15, 754.44it/s]     82%|########2 | 53742/65536 [01:10<00:15, 755.56it/s]     82%|########2 | 53820/65536 [01:10<00:15, 761.45it/s]     82%|########2 | 53899/65536 [01:10<00:15, 767.32it/s]     82%|########2 | 53976/65536 [01:10<00:15, 767.34it/s]     82%|########2 | 54053/65536 [01:10<00:14, 768.00it/s]     83%|########2 | 54130/65536 [01:10<00:14, 763.67it/s]     83%|########2 | 54208/65536 [01:10<00:14, 767.32it/s]     83%|########2 | 54285/65536 [01:10<00:14, 762.57it/s]     83%|########2 | 54363/65536 [01:10<00:14, 764.90it/s]     83%|########3 | 54440/65536 [01:10<00:14, 759.90it/s]     83%|########3 | 54517/65536 [01:11<00:14, 753.52it/s]     83%|########3 | 54594/65536 [01:11<00:14, 757.43it/s]     83%|########3 | 54672/65536 [01:11<00:14, 764.03it/s]     84%|########3 | 54750/65536 [01:11<00:14, 766.93it/s]     84%|########3 | 54828/65536 [01:11<00:13, 769.62it/s]     84%|########3 | 54905/65536 [01:11<00:13, 764.90it/s]     84%|########3 | 54982/65536 [01:11<00:14, 740.91it/s]     84%|########4 | 55060/65536 [01:11<00:13, 751.32it/s]     84%|########4 | 55137/65536 [01:11<00:13, 756.01it/s]     84%|########4 | 55215/65536 [01:11<00:13, 760.28it/s]     84%|########4 | 55292/65536 [01:12<00:13, 763.03it/s]     84%|########4 | 55369/65536 [01:12<00:13, 763.36it/s]     85%|########4 | 55447/65536 [01:12<00:13, 765.37it/s]     85%|########4 | 55525/65536 [01:12<00:13, 767.18it/s]     85%|########4 | 55603/65536 [01:12<00:12, 768.29it/s]     85%|########4 | 55680/65536 [01:12<00:12, 768.20it/s]     85%|########5 | 55757/65536 [01:12<00:12, 767.14it/s]     85%|########5 | 55835/65536 [01:12<00:12, 770.06it/s]     85%|########5 | 55914/65536 [01:12<00:12, 773.83it/s]     85%|########5 | 55993/65536 [01:12<00:12, 776.23it/s]     86%|########5 | 56071/65536 [01:13<00:12, 773.87it/s]     86%|########5 | 56149/65536 [01:13<00:12, 770.19it/s]     86%|########5 | 56227/65536 [01:13<00:12, 764.28it/s]     86%|########5 | 56304/65536 [01:13<00:12, 757.64it/s]     86%|########6 | 56380/65536 [01:13<00:12, 755.63it/s]     86%|########6 | 56458/65536 [01:13<00:11, 760.71it/s]     86%|########6 | 56535/65536 [01:13<00:11, 762.83it/s]     86%|########6 | 56614/65536 [01:13<00:11, 768.18it/s]     87%|########6 | 56692/65536 [01:13<00:11, 771.00it/s]     87%|########6 | 56771/65536 [01:13<00:11, 774.31it/s]     87%|########6 | 56849/65536 [01:14<00:11, 773.35it/s]     87%|########6 | 56927/65536 [01:14<00:11, 775.14it/s]     87%|########6 | 57005/65536 [01:14<00:10, 775.96it/s]     87%|########7 | 57084/65536 [01:14<00:10, 777.65it/s]     87%|########7 | 57162/65536 [01:14<00:10, 772.90it/s]     87%|########7 | 57240/65536 [01:14<00:10, 762.06it/s]     87%|########7 | 57317/65536 [01:14<00:10, 758.36it/s]     88%|########7 | 57394/65536 [01:14<00:10, 759.49it/s]     88%|########7 | 57470/65536 [01:14<00:10, 758.46it/s]     88%|########7 | 57548/65536 [01:14<00:10, 761.97it/s]     88%|########7 | 57625/65536 [01:15<00:10, 763.31it/s]     88%|########8 | 57702/65536 [01:15<00:10, 762.46it/s]     88%|########8 | 57779/65536 [01:15<00:10, 762.14it/s]     88%|########8 | 57857/65536 [01:15<00:10, 766.34it/s]     88%|########8 | 57934/65536 [01:15<00:09, 765.22it/s]     89%|########8 | 58011/65536 [01:15<00:09, 763.15it/s]     89%|########8 | 58088/65536 [01:15<00:09, 763.85it/s]     89%|########8 | 58165/65536 [01:15<00:09, 760.64it/s]     89%|########8 | 58242/65536 [01:15<00:09, 761.95it/s]     89%|########8 | 58319/65536 [01:15<00:09, 757.27it/s]     89%|########9 | 58395/65536 [01:16<00:09, 747.41it/s]     89%|########9 | 58470/65536 [01:16<00:09, 745.09it/s]     89%|########9 | 58547/65536 [01:16<00:09, 750.26it/s]     89%|########9 | 58623/65536 [01:16<00:09, 749.13it/s]     90%|########9 | 58699/65536 [01:16<00:09, 751.39it/s]     90%|########9 | 58776/65536 [01:16<00:08, 755.15it/s]     90%|########9 | 58855/65536 [01:16<00:08, 762.90it/s]     90%|########9 | 58934/65536 [01:16<00:08, 768.76it/s]     90%|######### | 59011/65536 [01:16<00:08, 762.85it/s]     90%|######### | 59088/65536 [01:17<00:08, 763.67it/s]     90%|######### | 59165/65536 [01:17<00:08, 764.49it/s]     90%|######### | 59242/65536 [01:17<00:08, 765.19it/s]     91%|######### | 59319/65536 [01:17<00:08, 766.52it/s]     91%|######### | 59396/65536 [01:17<00:08, 766.44it/s]     91%|######### | 59473/65536 [01:17<00:07, 766.80it/s]     91%|######### | 59550/65536 [01:17<00:07, 766.80it/s]     91%|######### | 59627/65536 [01:17<00:07, 767.24it/s]     91%|#########1| 59704/65536 [01:17<00:07, 767.30it/s]     91%|#########1| 59781/65536 [01:17<00:07, 767.40it/s]     91%|#########1| 59858/65536 [01:18<00:07, 766.78it/s]     91%|#########1| 59937/65536 [01:18<00:07, 771.61it/s]     92%|#########1| 60016/65536 [01:18<00:07, 775.53it/s]     92%|#########1| 60094/65536 [01:18<00:07, 776.84it/s]     92%|#########1| 60173/65536 [01:18<00:06, 779.65it/s]     92%|#########1| 60252/65536 [01:18<00:06, 781.49it/s]     92%|#########2| 60331/65536 [01:18<00:06, 782.23it/s]     92%|#########2| 60410/65536 [01:18<00:06, 783.13it/s]     92%|#########2| 60489/65536 [01:18<00:06, 783.75it/s]     92%|#########2| 60568/65536 [01:18<00:06, 784.48it/s]     93%|#########2| 60647/65536 [01:19<00:06, 784.76it/s]     93%|#########2| 60726/65536 [01:19<00:06, 781.20it/s]     93%|#########2| 60805/65536 [01:19<00:06, 771.57it/s]     93%|#########2| 60883/65536 [01:19<00:06, 772.24it/s]     93%|#########3| 60962/65536 [01:19<00:05, 775.07it/s]     93%|#########3| 61040/65536 [01:19<00:05, 774.96it/s]     93%|#########3| 61118/65536 [01:19<00:05, 772.89it/s]     93%|#########3| 61196/65536 [01:19<00:05, 773.21it/s]     93%|#########3| 61274/65536 [01:19<00:05, 771.06it/s]     94%|#########3| 61352/65536 [01:19<00:05, 770.42it/s]     94%|#########3| 61430/65536 [01:20<00:05, 771.87it/s]     94%|#########3| 61509/65536 [01:20<00:05, 775.50it/s]     94%|#########3| 61588/65536 [01:20<00:05, 778.46it/s]     94%|#########4| 61666/65536 [01:20<00:04, 778.53it/s]     94%|#########4| 61744/65536 [01:20<00:04, 777.59it/s]     94%|#########4| 61822/65536 [01:20<00:04, 773.94it/s]     94%|#########4| 61900/65536 [01:20<00:04, 761.84it/s]     95%|#########4| 61977/65536 [01:20<00:04, 752.84it/s]     95%|#########4| 62053/65536 [01:20<00:04, 754.34it/s]     95%|#########4| 62129/65536 [01:20<00:04, 752.82it/s]     95%|#########4| 62205/65536 [01:21<00:04, 751.42it/s]     95%|#########5| 62281/65536 [01:21<00:04, 751.44it/s]     95%|#########5| 62357/65536 [01:21<00:04, 749.43it/s]     95%|#########5| 62435/65536 [01:21<00:04, 756.93it/s]     95%|#########5| 62514/65536 [01:21<00:03, 764.44it/s]     96%|#########5| 62593/65536 [01:21<00:03, 770.09it/s]     96%|#########5| 62671/65536 [01:21<00:03, 770.79it/s]     96%|#########5| 62750/65536 [01:21<00:03, 774.16it/s]     96%|#########5| 62828/65536 [01:21<00:03, 772.36it/s]     96%|#########5| 62906/65536 [01:21<00:03, 771.99it/s]     96%|#########6| 62984/65536 [01:22<00:03, 762.75it/s]     96%|#########6| 63061/65536 [01:22<00:03, 763.63it/s]     96%|#########6| 63138/65536 [01:22<00:03, 759.12it/s]     96%|#########6| 63214/65536 [01:22<00:03, 753.90it/s]     97%|#########6| 63290/65536 [01:22<00:02, 754.37it/s]     97%|#########6| 63368/65536 [01:22<00:02, 761.18it/s]     97%|#########6| 63447/65536 [01:22<00:02, 767.75it/s]     97%|#########6| 63526/65536 [01:22<00:02, 772.38it/s]     97%|#########7| 63604/65536 [01:22<00:02, 774.40it/s]     97%|#########7| 63683/65536 [01:22<00:02, 777.15it/s]     97%|#########7| 63761/65536 [01:23<00:02, 776.37it/s]     97%|#########7| 63839/65536 [01:23<00:02, 776.04it/s]     98%|#########7| 63917/65536 [01:23<00:02, 761.58it/s]     98%|#########7| 63994/65536 [01:23<00:02, 760.21it/s]     98%|#########7| 64073/65536 [01:23<00:01, 766.39it/s]     98%|#########7| 64150/65536 [01:23<00:01, 766.78it/s]     98%|#########8| 64227/65536 [01:23<00:01, 765.10it/s]     98%|#########8| 64305/65536 [01:23<00:01, 768.52it/s]     98%|#########8| 64383/65536 [01:23<00:01, 771.09it/s]     98%|#########8| 64461/65536 [01:23<00:01, 772.54it/s]     98%|#########8| 64539/65536 [01:24<00:01, 761.82it/s]     99%|#########8| 64616/65536 [01:24<00:01, 761.62it/s]     99%|#########8| 64694/65536 [01:24<00:01, 764.35it/s]     99%|#########8| 64771/65536 [01:24<00:01, 759.70it/s]     99%|#########8| 64849/65536 [01:24<00:00, 764.24it/s]     99%|#########9| 64928/65536 [01:24<00:00, 769.46it/s]     99%|#########9| 65007/65536 [01:24<00:00, 772.76it/s]     99%|#########9| 65086/65536 [01:24<00:00, 776.20it/s]     99%|#########9| 65165/65536 [01:24<00:00, 778.57it/s]    100%|#########9| 65244/65536 [01:25<00:00, 781.15it/s]    100%|#########9| 65323/65536 [01:25<00:00, 782.18it/s]    100%|#########9| 65402/65536 [01:25<00:00, 784.28it/s]    100%|#########9| 65481/65536 [01:25<00:00, 784.57it/s]    100%|##########| 65536/65536 [01:25<00:00, 767.58it/s]




.. GENERATED FROM PYTHON SOURCE LINES 126-131

Print training statistics and plot training error
-------------------------------------------------

this step could potentially be repeated many times


.. GENERATED FROM PYTHON SOURCE LINES 131-134

.. code-block:: default

    print(calibrator.stats())
    calibrator.plot_test_accuracy()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :alt: Training error
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Number of training samples: 4194304
            Number of filter coefficients: 2560
            Largets / smallest training error: 1.1e-04 / 1.1e-09
            Number of gradient evaluations: 4194304
            Calibration Time: 1.2e-02 [s]
        




.. GENERATED FROM PYTHON SOURCE LINES 135-138

Extract testing estimate
-------------------------


.. GENERATED FROM PYTHON SOURCE LINES 138-140

.. code-block:: default

    u_hat = calibrator.test(size)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/16896 [00:00<?, ?it/s]     35%|###5      | 5923/16896 [00:00<00:00, 59225.26it/s]     70%|#######   | 11883/16896 [00:00<00:00, 59443.89it/s]    100%|##########| 16896/16896 [00:00<00:00, 59500.32it/s]




.. GENERATED FROM PYTHON SOURCE LINES 141-144

Visualise PSD of testing data
-----------------------------


.. GENERATED FROM PYTHON SOURCE LINES 144-214

.. code-block:: default


    # uncalibrated
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_uncalibrated[:],
        fs=1 / digital_control.clock.T,
        nperseg=u_hat_cut_uncalibrated.size,
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Uncalibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Ref
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat_cut_ref[:], fs=1 / digital_control.clock.T, nperseg=u_hat_cut_ref.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Ref, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    # Calibrated Est
    f, psd = cbadc.utilities.compute_power_spectral_density(
        u_hat[:], fs=1 / digital_control.clock.T, nperseg=u_hat.size
    )
    signal_index = cbadc.utilities.find_sinusoidal(psd, 15)
    noise_index = np.ones(psd.size, dtype=bool)
    noise_index[signal_index] = False
    noise_index[f < (BW * 1e-2)] = False
    noise_index[f > BW] = False
    fom = cbadc.utilities.snr_spectrum_computation_extended(
        psd, signal_index, noise_index, fs=1 / digital_control.clock.T
    )
    est_SNR = cbadc.fom.snr_to_dB(fom['snr'])
    est_ENOB = cbadc.fom.snr_to_enob(est_SNR)
    plt.semilogx(
        f,
        10 * np.log10(np.abs(psd)),
        label=f"Calibrated, est_ENOB={est_ENOB:.1f} bits, est_SNR={est_SNR:.1f} dB",
    )

    plt.title("Power spectral density of input estimate")
    plt.xlabel('Hz')
    plt.ylabel('$V^2$ / Hz dB')
    plt.legend()
    plt.grid(which="both")
    plt.gcf().tight_layout()




.. image-sg:: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :alt: Power spectral density of input estimate
   :srcset: /tutorials/b_high_level_simulation/images/sphx_glr_plot_h_calibrating_from_numpy_simulator_002.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  51.673 seconds)


.. _sphx_glr_download_tutorials_b_high_level_simulation_plot_h_calibrating_from_numpy_simulator.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_h_calibrating_from_numpy_simulator.py <plot_h_calibrating_from_numpy_simulator.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_h_calibrating_from_numpy_simulator.ipynb <plot_h_calibrating_from_numpy_simulator.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
