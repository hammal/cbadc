
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/b_general/plot_b_FIR_Filtering.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_b_general_plot_b_FIR_Filtering.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_b_general_plot_b_FIR_Filtering.py:


===============================
Digital Estimator as FIR Filter
===============================

We demonstrate how to set up the FIR filter implementation.

.. GENERATED FROM PYTHON SOURCE LINES 10-17

---------------------------------------
Analog System and Digital Control Setup
---------------------------------------

To initialize a digital estimator, we need to specify which analog system and
digital control are used. Here we default to the chain-of-integrators
example.

.. GENERATED FROM PYTHON SOURCE LINES 17-50

.. code-block:: default
   :lineno-start: 18


    from cbadc.analog_system import AnalogSystem
    from cbadc.digital_control import DigitalControl
    from cbadc.digital_estimator import DigitalEstimator
    import numpy as np
    N = 6
    M = N
    beta = 6250.
    rho = - beta * 1e-2
    A = [[rho, 0, 0, 0, 0, 0],
         [beta, rho, 0, 0, 0, 0],
         [0, beta, rho, 0, 0, 0],
         [0, 0, beta, rho, 0, 0],
         [0, 0, 0, beta, rho, 0],
         [0, 0, 0, 0, beta, rho]]
    B = [[beta], [0], [0], [0], [0], [0]]
    CT = np.eye(N)
    Gamma = [[-beta, 0, 0, 0, 0, 0],
             [0, -beta, 0, 0, 0, 0],
             [0, 0, -beta, 0, 0, 0],
             [0, 0, 0, -beta, 0, 0],
             [0, 0, 0, 0, -beta, 0],
             [0, 0, 0, 0, 0, -beta]]
    Gamma_tildeT = CT
    T = 1.0/(2 * beta)

    analog_system = AnalogSystem(A, B, CT, Gamma, Gamma_tildeT)
    digital_control = DigitalControl(T, M)

    # Summarize the analog system, digital control, and digital estimator.
    print(analog_system, "\n")
    print(digital_control)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    The analog system is parameterized as:
    A =
    [[ -62.5    0.     0.     0.     0.     0. ]
     [6250.   -62.5    0.     0.     0.     0. ]
     [   0.  6250.   -62.5    0.     0.     0. ]
     [   0.     0.  6250.   -62.5    0.     0. ]
     [   0.     0.     0.  6250.   -62.5    0. ]
     [   0.     0.     0.     0.  6250.   -62.5]],
    B =
    [[6250.]
     [   0.]
     [   0.]
     [   0.]
     [   0.]
     [   0.]],
    CT = 
    [[1. 0. 0. 0. 0. 0.]
     [0. 1. 0. 0. 0. 0.]
     [0. 0. 1. 0. 0. 0.]
     [0. 0. 0. 1. 0. 0.]
     [0. 0. 0. 0. 1. 0.]
     [0. 0. 0. 0. 0. 1.]],
    Gamma =
    [[-6250.     0.     0.     0.     0.     0.]
     [    0. -6250.     0.     0.     0.     0.]
     [    0.     0. -6250.     0.     0.     0.]
     [    0.     0.     0. -6250.     0.     0.]
     [    0.     0.     0.     0. -6250.     0.]
     [    0.     0.     0.     0.     0. -6250.]],
    and Gamma_tildeT =
    [[1. 0. 0. 0. 0. 0.]
     [0. 1. 0. 0. 0. 0.]
     [0. 0. 1. 0. 0. 0.]
     [0. 0. 0. 1. 0. 0.]
     [0. 0. 0. 0. 1. 0.]
     [0. 0. 0. 0. 0. 1.]] 

    The Digital Control is parameterized as:
    T = 8e-05,
    M = 6, and next update at
    t = 8e-05




.. GENERATED FROM PYTHON SOURCE LINES 51-58

----------------
Impulse Response
----------------

Next we instantiate a :py:class:`cbadc.digital_estimator.FIRFilter` and
visualize its impulse responses.


.. GENERATED FROM PYTHON SOURCE LINES 58-92

.. code-block:: default
   :lineno-start: 58

    import matplotlib.pyplot as plt
    from cbadc.utilities import read_byte_stream_from_file, byte_stream_2_control_signal

    eta2 = 1e6

    from cbadc.digital_estimator import FIRFilter
    byte_stream = read_byte_stream_from_file('sinusodial_simulation.adc', M)
    control_signal_sequences = byte_stream_2_control_signal(byte_stream, M)

    K1 = 250
    K2 = 250
    h_index = np.arange(-K1, K2)

    digital_estimator = FIRFilter(
        control_signal_sequences, analog_system, digital_control, eta2, K1, K2)
    impulse_response = np.abs(np.array(digital_estimator.h[:, 0, :])) ** 2
    impulse_response_dB = 10 * np.log10(impulse_response)

    fig, ax = plt.subplots(2)
    for index in range(N):
        ax[0].plot(h_index, impulse_response[:, index],
                   label=f"$h_{index + 1}[k]$")
        ax[1].plot(h_index, impulse_response_dB[:, index],
                   label=f"$h_{index + 1}[k]$")
    ax[0].legend()
    fig.suptitle(f"For $\eta^2 = {20 * np.log10(eta2)}$ [dB]")
    ax[1].set_xlabel("filter taps k")
    ax[0].set_ylabel("$| h_\ell [k]|^2_2$")
    ax[1].set_ylabel("$| h_\ell [k]|^2_2$ [dB]")
    ax[0].set_xlim((-50, 50))
    ax[0].grid(which='both')
    ax[1].set_xlim((-K1, K2))
    ax[1].grid(which='both')




.. image:: /auto_examples/b_general/images/sphx_glr_plot_b_FIR_Filtering_001.png
    :alt: For $\eta^2 = 120.0$ [dB]
    :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 93-98

Transfer Function
-----------------

Additionally, we plot the corresponding transfer functions of the estimator.


.. GENERATED FROM PYTHON SOURCE LINES 98-130

.. code-block:: default
   :lineno-start: 99


    # Logspace frequencies
    frequencies = np.logspace(-3, 0, 100)
    omega = 4 * np.pi * beta * frequencies

    # Compute NTF
    ntf = digital_estimator.noise_transfer_function(omega)
    ntf_dB = 20 * np.log10(np.abs(ntf))

    # Compute STF
    stf = digital_estimator.signal_transfer_function(omega)
    stf_dB = 20 * np.log10(np.abs(stf.flatten()))

    # Plot
    plt.figure()
    plt.semilogx(frequencies, stf_dB, label='$STF(\omega)$')
    for n in range(N):
        plt.semilogx(frequencies, ntf_dB[0, n, :], label=f"$|NTF_{n+1}(\omega)|$")
    plt.semilogx(frequencies, 20 * np.log10(np.linalg.norm(
        ntf[0, :, :], axis=0)), '--', label="$ || NTF(\omega) ||_2 $")

    # Add labels and legends to figure
    plt.legend()
    plt.grid(which='both')
    plt.title("Signal and noise transfer functions")
    plt.xlabel("$\omega / (4 \pi \\beta ) $")
    plt.ylabel("dB")
    plt.xlim((frequencies[10], frequencies[-1]))
    plt.ylim((-300, 10))
    plt.gcf().tight_layout()





.. image:: /auto_examples/b_general/images/sphx_glr_plot_b_FIR_Filtering_002.png
    :alt: Signal and noise transfer functions
    :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 131-141

-----------------------------------
Impulse Response and :math:`\eta^2`
-----------------------------------

The rate at which the estimator's impulse response decays depends on our
bandwidth parameter :math:`\eta^2`. Specifically, as we increase
:math:`\eta^2` we seek a higher resolution at a smaller bandwidth. As
expected, decreasing the bandwidth requires 'more' filtering and, therefore,
a slower decaying impulse response. Equivalently, we require more filter taps
for a given precision as we increase :math:`\eta^2`.

.. GENERATED FROM PYTHON SOURCE LINES 141-161

.. code-block:: default
   :lineno-start: 141

    Eta2 = np.logspace(0, 7, 8)
    K1 = 250
    K2 = 250
    h_index = np.arange(-K1, K2)

    plt.figure()
    for eta2 in Eta2:
        digital_estimator = FIRFilter(
            control_signal_sequences, analog_system, digital_control, eta2, K1, K2)
        impulse_response = 20 * \
            np.log10(np.linalg.norm(
                np.array(digital_estimator.h[:, 0, :]), axis=-1))
        plt.plot(h_index, impulse_response,
                 label=f"$\eta^2 = {20 * np.log10(eta2)}$ [dB]")
    plt.legend()
    plt.xlabel("filter taps k")
    plt.ylabel("$\| \mathbf{h} [k] \|^2_2$ [dB]")
    plt.xlim((-K1, K2))
    plt.grid(which="both")




.. image:: /auto_examples/b_general/images/sphx_glr_plot_b_FIR_Filtering_003.png
    :alt: plot b FIR Filtering
    :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 162-172

Filter length
-------------

We can confirm the intuition from the previous section by considering
a different number of filter taps for a given simulation. Specifically, we
FIRFilter parametrizations.

Conducting such a simulation is a good way of determining a minimum number
of filter taps for a specific analog system, digital control, and :math:`\eta^2`
combination.

.. GENERATED FROM PYTHON SOURCE LINES 172-249

.. code-block:: default
   :lineno-start: 172

    from cbadc.utilities import compute_power_spectral_density

    filter_lengths = [1 << 4, 1 << 6, 1 << 7, 1 << 8]
    print(f"filter_lengths: {filter_lengths}")

    eta2 = 1e6

    control_signal_sequences = [byte_stream_2_control_signal(read_byte_stream_from_file(
        '../a_getting_started/sinusodial_simulation.adc', M), M) for _ in filter_lengths]

    stop_after_number_of_iterations = 1 << 16
    u_hat = np.zeros(stop_after_number_of_iterations)
    digital_estimators = [FIRFilter(
        cs,
        analog_system,
        digital_control,
        eta2,
        filter_lengths[index],
        filter_lengths[index],
        stop_after_number_of_iterations=stop_after_number_of_iterations
    ) for index, cs in enumerate(control_signal_sequences)]

    digital_estimators.append(DigitalEstimator(
        byte_stream_2_control_signal(read_byte_stream_from_file(
        '../a_getting_started/sinusodial_simulation.adc', M), M),
        analog_system,
        digital_control,
        eta2,
        stop_after_number_of_iterations >> 2,
        1 << 14,
        stop_after_number_of_iterations=stop_after_number_of_iterations
    ))

    fig_frequency_spectrum = 4
    fig_time_domain = 5
    for index_de, de in enumerate(digital_estimators):
        # Print the estimator configuration
        print(de)
        for index, estimate in enumerate(de):
            u_hat[index] = estimate

        plt.figure(fig_frequency_spectrum)

        if(index_de < len(filter_lengths)):
            # Plot the FIR filters
            f, psd = compute_power_spectral_density(
                u_hat[filter_lengths[index_de]:])
            plt.semilogx(f, 10 * np.log10(psd),
                         label=f'K1=K2={filter_lengths[index_de]}')
            plt.figure(fig_time_domain)
            t_fir = np.arange(-filter_lengths[index_de] + 1,
                              stop_after_number_of_iterations - filter_lengths[index_de] + 1)
            plt.plot(t_fir, u_hat, label=f'K1=K2={filter_lengths[index_de]}')
        else:
            # Plot reference
            f, psd = compute_power_spectral_density(
                u_hat)
            plt.semilogx(f, 10 * np.log10(psd),
                         label=f'DigitalEstimator')
            plt.figure(fig_time_domain)
            t_fir = np.arange(0, u_hat.size)
            plt.plot(t_fir, u_hat, label=f'DigitalEstimator')
    plt.xlabel('$t / T$')
    plt.ylabel('$\hat{u}(t)$')
    plt.legend()
    plt.title("Estimated input signal")
    plt.grid(which='both')
    plt.xlim(stop_after_number_of_iterations - 501,
             stop_after_number_of_iterations - 1)
    plt.tight_layout()

    plt.figure(fig_frequency_spectrum)
    plt.legend()
    plt.xlabel('frequency [Hz]')
    plt.ylabel('$ \mathrm{V}^2 \, / \, \mathrm{Hz}$')
    plt.xlim((f[1], f[-1]))
    plt.grid(which="both")



.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/b_general/images/sphx_glr_plot_b_FIR_Filtering_004.png
          :alt: plot b FIR Filtering
          :class: sphx-glr-multi-img

    *

      .. image:: /auto_examples/b_general/images/sphx_glr_plot_b_FIR_Filtering_005.png
          :alt: Estimated input signal
          :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    filter_lengths: [16, 64, 128, 256]
    FIR estimator is parameterized as 
    eta2 = 1000000.00, 120 [dB],
    Ts = 8e-05,
    K1 = 16,
    K2 = 16,
    and
    number_of_iterations = 65536.
    Resulting in the filter coefficients
    h = 
    [[[ 1.14857194e-02 -6.44812761e-03  5.56966463e-04  3.52393856e-04
       -7.08506709e-05 -2.32116191e-05]]

     [[ 1.48459314e-02 -6.71468642e-03  3.74156438e-04  3.87003880e-04
       -5.76954836e-05 -2.69352969e-05]]

     [[ 1.83332828e-02 -6.88665280e-03  1.74745502e-04  4.14639867e-04
       -4.24786433e-05 -3.01346336e-05]]

     [[ 2.18989434e-02 -6.95612654e-03 -3.75952876e-05  4.34287275e-04
       -2.55027716e-05 -3.26867729e-05]]

     [[ 2.54903505e-02 -6.91713317e-03 -2.58706283e-04  4.45095445e-04
       -7.14031234e-06 -3.44806621e-05]]

     [[ 2.90522146e-02 -6.76585721e-03 -4.84027607e-04  4.46412485e-04
        1.21732097e-05 -3.54217953e-05]]

     [[ 3.25276371e-02 -6.50082781e-03 -7.08704548e-04  4.37816358e-04
        3.19486712e-05 -3.54368794e-05]]

     [[ 3.58593125e-02 -6.12304882e-03 -9.27707831e-04  4.19140785e-04
        5.16555503e-05 -3.44782411e-05]]

     [[ 3.89907865e-02 -5.63606596e-03 -1.13596590e-03  3.90494603e-04
        7.07367243e-05 -3.25277714e-05]]

     [[ 4.18677364e-02 -5.04596586e-03 -1.32850569e-03  3.52273279e-04
        8.86256305e-05 -2.96001783e-05]]

     [[ 4.44392412e-02 -4.36130320e-03 -1.50059761e-03  3.05161445e-04
        1.04765436e-04 -2.57453026e-05]]

     [[ 4.66590013e-02 -3.59295470e-03 -1.64790021e-03  2.50125495e-04
        1.18629725e-04 -2.10492297e-05]]

     [[ 4.84864748e-02 -2.75390119e-03 -1.76659913e-03  1.88395598e-04
        1.29744065e-04 -1.56339153e-05]]

     [[ 4.98878912e-02 -1.85894128e-03 -1.85353512e-03  1.21436786e-04
        1.37707668e-04 -9.65502922e-06]]

     [[ 5.08371127e-02 -9.24343502e-04 -1.90631545e-03  5.09092648e-05
        1.42214189e-04 -3.29771166e-06]]

     [[ 5.13163101e-02  3.25539670e-05 -1.92340347e-03 -2.13814527e-05
        1.43070554e-04  3.23007372e-06]]

     [[ 5.13163101e-02  9.93763351e-04 -1.90418392e-03 -9.35435702e-05
        1.40212491e-04  9.70690519e-06]]

     [[ 5.08371127e-02  1.94107911e-03 -1.84901938e-03 -1.63671312e-04
        1.33714139e-04  1.59101215e-05]]

     [[ 4.98878912e-02  2.85669445e-03 -1.75924040e-03 -2.29929767e-04
        1.23785267e-04  2.16293846e-05]]

     [[ 4.84864748e-02  3.72362777e-03 -1.63707031e-03 -2.90624799e-04
        1.10756394e-04  2.66782473e-05]]

     [[ 4.66590013e-02  4.52613331e-03 -1.48554235e-03 -3.44257785e-04
        9.50585861e-05  3.09023487e-05]]

     [[ 4.44392412e-02  5.25008787e-03 -1.30839445e-03 -3.89569618e-04
        7.72007521e-05  3.41845230e-05]]

     [[ 4.18677364e-02  5.88332148e-03 -1.10994421e-03 -4.25573303e-04
        5.77458235e-05  3.64472764e-05]]

     [[ 3.89907865e-02  6.41588342e-03 -8.94949863e-04 -4.51574840e-04
        3.72869865e-05  3.76530604e-05]]

     [[ 3.58593125e-02  6.84023743e-03 -6.68462993e-04 -4.67182610e-04
        1.64249078e-05  3.78027490e-05]]

     [[ 3.25276371e-02  7.15138338e-03 -4.35678605e-04 -4.72305928e-04
       -4.25329331e-06  3.69326951e-05]]

     [[ 2.90522146e-02  7.34690462e-03 -2.01787669e-04 -4.67143715e-04
       -2.41927542e-05  3.51107147e-05]]

     [[ 2.54903505e-02  7.42694345e-03  2.81631556e-05 -4.52164531e-04
       -4.28868563e-05  3.24313141e-05]]

     [[ 2.18989434e-02  7.39410870e-03  2.49400614e-04 -4.28079368e-04
       -5.98902354e-05  2.90104432e-05]]

     [[ 1.83332828e-02  7.25332167e-03  4.57539446e-04 -3.95808674e-04
       -7.48286921e-05  2.49800254e-05]]

     [[ 1.48459314e-02  7.01160808e-03  6.48679909e-04 -3.56445164e-04
       -8.74059990e-05  2.04824813e-05]]

     [[ 1.14857194e-02  6.67784478e-03  8.19486403e-04 -3.11213904e-04
       -9.74076967e-05  1.56654293e-05]]].
    FIR estimator is parameterized as 
    eta2 = 1000000.00, 120 [dB],
    Ts = 8e-05,
    K1 = 64,
    K2 = 64,
    and
    number_of_iterations = 65536.
    Resulting in the filter coefficients
    h = 
    [[[-1.04737136e-03 -3.98959828e-04  1.64795636e-04  1.55377198e-05
       -1.87744883e-05  8.85093924e-07]]

     [[-8.31815488e-04 -4.81427833e-04  1.55447678e-04  2.52236181e-05
       -1.92730121e-05  5.78941674e-08]]

     [[-5.75116590e-04 -5.58387687e-04  1.41137892e-04  3.51069961e-05
       -1.93090399e-05 -8.43852026e-07]]

     [[-2.80462500e-04 -6.27303432e-04  1.21801401e-04  4.49455593e-05
       -1.88408658e-05 -1.80313268e-06]]

     [[ 4.76656627e-05 -6.85625035e-04  9.74996770e-05  5.44768252e-05
       -1.78363043e-05 -2.79997314e-06]]

     [[ 4.03496208e-04 -7.30854141e-04  6.84300788e-05  6.34232090e-05
       -1.62743474e-05 -3.81170740e-06]]

     [[ 7.80003726e-04 -7.60614265e-04  3.49326730e-05  7.14979400e-05
       -1.41466716e-05 -4.81334382e-06]]

     [[ 1.16898213e-03 -7.72724007e-04 -2.50606342e-06  7.84117235e-05
       -1.14589387e-05 -5.77802373e-06]]

     [[ 1.56115519e-03 -7.65271617e-04 -4.32530244e-05  8.38800383e-05
       -8.23184032e-06 -6.67756874e-06]]

     [[ 1.94632491e-03 -7.36689117e-04 -8.65320436e-05  8.76309298e-05
       -4.50183586e-06 -7.48310974e-06]]

     [[ 2.31355736e-03 -6.85824009e-04 -1.31431478e-04  8.94131377e-05
       -3.21537640e-07 -8.16578810e-06]]

     [[ 2.65140431e-03 -6.12006497e-04 -1.76915950e-04  8.90043716e-05
        4.24029629e-06 -8.69751639e-06]]

     [[ 2.94815808e-03 -5.15110119e-04 -2.21842293e-04  8.62195294e-05
        9.09919581e-06 -9.05178363e-06]]

     [[ 3.19213600e-03 -3.95603643e-04 -2.64979637e-04  8.09186373e-05
        1.41558635e-05 -9.20448729e-06]]

     [[ 3.37198970e-03 -2.54592154e-04 -3.05033461e-04  7.30142771e-05
        1.92975257e-05 -9.13477203e-06]]

     [[ 3.47703334e-03 -9.38453659e-05 -3.40673313e-04  6.24782634e-05
        2.43997534e-05 -8.82585345e-06]]

     [[ 3.49758423e-03  8.41886649e-05 -3.70563783e-04  4.93473294e-05
        2.93287446e-05 -8.26580323e-06]]

     [[ 3.42530793e-03  2.76385975e-04 -3.93398189e-04  3.37275881e-05
        3.39440476e-05 -7.44827133e-06]]

     [[ 3.25355956e-03  4.78966574e-04 -4.07934317e-04  1.57975478e-05
        3.81016875e-05 -6.37312028e-06]]

     [[ 2.97771234e-03  6.87532702e-04 -4.13031459e-04 -4.19051877e-06
        4.16576498e-05 -5.04694673e-06]]

     [[ 2.59546384e-03  8.97125976e-04 -4.07687874e-04 -2.59110266e-05
        4.44716549e-05 -3.48346647e-06]]

     [[ 2.10711034e-03  1.10230352e-03 -3.91077735e-04 -4.89674914e-05
        4.64111497e-05 -1.70374043e-06]]

     [[ 1.51577981e-03  1.29723267e-03 -3.62586539e-04 -7.28970028e-05
        4.73554244e-05  2.63778238e-07]]

     [[ 8.27613999e-04  1.47580324e-03 -3.21843938e-04 -9.71768095e-05
        4.71997569e-05  2.38339306e-06]]

     [[ 5.18911872e-05  1.63175606e-03 -2.68752904e-04 -1.21233017e-04
        4.58594721e-05  4.61252219e-06]]

     [[-7.98918608e-04  1.75882548e-03 -2.03514172e-04 -1.44451339e-04
        4.32738012e-05  6.90227402e-06]]

     [[-1.70917256e-03  1.85089356e-03 -1.26644926e-04 -1.66189785e-04
        3.94094172e-05  9.19824385e-06]]

     [[-2.66015361e-03  1.90215273e-03 -3.89907782e-05 -1.85793099e-04
        3.42635228e-05  1.14415294e-05]]

     [[-3.63025246e-03  1.90727339e-03  5.82698169e-05 -2.02608712e-04
        2.78663682e-05  1.35699562e-05]]

     [[-4.59523496e-03  1.86157253e-03  1.63629438e-04 -2.16003895e-04
        2.02830799e-05  1.55194982e-05]]

     [[-5.52859464e-03  1.76117908e-03  2.75264412e-04 -2.25383745e-04
        1.16146913e-05  1.72258710e-05]]

     [[-6.40198816e-03  1.60319136e-03  3.91056733e-04 -2.30209587e-04
        1.99827781e-06  1.86262691e-05]]

     [[-7.18574899e-03  1.38582209e-03  5.08625326e-04 -2.30017323e-04
       -8.39388564e-06  1.96612117e-05]]

     [[-7.84947209e-03  1.10852608e-03  6.25366550e-04 -2.24435211e-04
       -1.93562051e-05  2.02764540e-05]]

     [[-8.36266035e-03  7.72106000e-04  7.38503566e-04 -2.13200553e-04
       -3.06527244e-05  2.04249176e-05]]

     [[-8.69542081e-03  3.78791891e-04  8.45143939e-04 -1.96174720e-04
       -4.20211690e-05  2.00685853e-05]]

     [[-8.81919681e-03 -6.77096825e-05  9.42344543e-04 -1.73355981e-04
       -5.31780584e-05  1.91803038e-05]]

     [[-8.70752011e-03 -5.62200358e-04  1.02718255e-03 -1.44889573e-04
       -6.38248345e-05  1.77454331e-05]]

     [[-8.33676531e-03 -1.09801143e-03  1.09683108e-03 -1.11074523e-04
       -7.36549229e-05  1.57632818e-05]]

     [[-7.68688771e-03 -1.66706409e-03  1.14863770e-03 -7.23667466e-05
       -8.23616053e-05  1.32482638e-05]]

     [[-6.74212458e-03 -2.25996974e-03  1.18020388e-03 -2.93780298e-05
       -8.96465483e-05  1.02307184e-05]]

     [[-5.49163973e-03 -2.86617029e-03  1.18946334e-03  1.71294107e-05
       -9.52287993e-05  6.75733372e-06]]

     [[-3.93009103e-03 -3.47411776e-03  1.17475677e-03  6.62530078e-05
       -9.88540269e-05  2.89112443e-06]]

     [[-2.05810135e-03 -4.07149084e-03  1.13490086e-03  1.16964654e-04
       -1.00303754e-04 -1.28908299e-06]]

     [[ 1.17385195e-04 -4.64544517e-03  1.06924900e-03  1.68130198e-04
       -9.94043092e-05 -5.68969007e-06]]

     [[ 2.58287829e-03 -5.18289275e-03  9.77741389e-04  2.18533457e-04
       -9.60351927e-05 -1.02039150e-05]]

     [[ 5.31826143e-03 -5.67080473e-03  8.60942399e-04  2.66904384e-04
       -9.01365561e-05 -1.47139385e-05]]

     [[ 8.29686785e-03 -6.09653087e-03  7.20062972e-04  3.11950920e-04
       -8.17154701e-05 -1.90936001e-05]]

     [[ 1.14857194e-02 -6.44812761e-03  5.56966463e-04  3.52393856e-04
       -7.08506709e-05 -2.32116191e-05]]

     [[ 1.48459314e-02 -6.71468642e-03  3.74156438e-04  3.87003880e-04
       -5.76954836e-05 -2.69352969e-05]]

     [[ 1.83332828e-02 -6.88665280e-03  1.74745502e-04  4.14639867e-04
       -4.24786433e-05 -3.01346336e-05]]

     [[ 2.18989434e-02 -6.95612654e-03 -3.75952876e-05  4.34287275e-04
       -2.55027716e-05 -3.26867729e-05]]

     [[ 2.54903505e-02 -6.91713317e-03 -2.58706283e-04  4.45095445e-04
       -7.14031234e-06 -3.44806621e-05]]

     [[ 2.90522146e-02 -6.76585721e-03 -4.84027607e-04  4.46412485e-04
        1.21732097e-05 -3.54217953e-05]]

     [[ 3.25276371e-02 -6.50082781e-03 -7.08704548e-04  4.37816358e-04
        3.19486712e-05 -3.54368794e-05]]

     [[ 3.58593125e-02 -6.12304882e-03 -9.27707831e-04  4.19140785e-04
        5.16555503e-05 -3.44782411e-05]]

     [[ 3.89907865e-02 -5.63606596e-03 -1.13596590e-03  3.90494603e-04
        7.07367243e-05 -3.25277714e-05]]

     [[ 4.18677364e-02 -5.04596586e-03 -1.32850569e-03  3.52273279e-04
        8.86256305e-05 -2.96001783e-05]]

     [[ 4.44392412e-02 -4.36130320e-03 -1.50059761e-03  3.05161445e-04
        1.04765436e-04 -2.57453026e-05]]

     [[ 4.66590013e-02 -3.59295470e-03 -1.64790021e-03  2.50125495e-04
        1.18629725e-04 -2.10492297e-05]]

     [[ 4.84864748e-02 -2.75390119e-03 -1.76659913e-03  1.88395598e-04
        1.29744065e-04 -1.56339153e-05]]

     [[ 4.98878912e-02 -1.85894128e-03 -1.85353512e-03  1.21436786e-04
        1.37707668e-04 -9.65502922e-06]]

     [[ 5.08371127e-02 -9.24343502e-04 -1.90631545e-03  5.09092648e-05
        1.42214189e-04 -3.29771166e-06]]

     [[ 5.13163101e-02  3.25539670e-05 -1.92340347e-03 -2.13814527e-05
        1.43070554e-04  3.23007372e-06]]

     [[ 5.13163101e-02  9.93763351e-04 -1.90418392e-03 -9.35435702e-05
        1.40212491e-04  9.70690519e-06]]

     [[ 5.08371127e-02  1.94107911e-03 -1.84901938e-03 -1.63671312e-04
        1.33714139e-04  1.59101215e-05]]

     [[ 4.98878912e-02  2.85669445e-03 -1.75924040e-03 -2.29929767e-04
        1.23785267e-04  2.16293846e-05]]

     [[ 4.84864748e-02  3.72362777e-03 -1.63707031e-03 -2.90624799e-04
        1.10756394e-04  2.66782473e-05]]

     [[ 4.66590013e-02  4.52613331e-03 -1.48554235e-03 -3.44257785e-04
        9.50585861e-05  3.09023487e-05]]

     [[ 4.44392412e-02  5.25008787e-03 -1.30839445e-03 -3.89569618e-04
        7.72007521e-05  3.41845230e-05]]

     [[ 4.18677364e-02  5.88332148e-03 -1.10994421e-03 -4.25573303e-04
        5.77458235e-05  3.64472764e-05]]

     [[ 3.89907865e-02  6.41588342e-03 -8.94949863e-04 -4.51574840e-04
        3.72869865e-05  3.76530604e-05]]

     [[ 3.58593125e-02  6.84023743e-03 -6.68462993e-04 -4.67182610e-04
        1.64249078e-05  3.78027490e-05]]

     [[ 3.25276371e-02  7.15138338e-03 -4.35678605e-04 -4.72305928e-04
       -4.25329331e-06  3.69326951e-05]]

     [[ 2.90522146e-02  7.34690462e-03 -2.01787669e-04 -4.67143715e-04
       -2.41927542e-05  3.51107147e-05]]

     [[ 2.54903505e-02  7.42694345e-03  2.81631556e-05 -4.52164531e-04
       -4.28868563e-05  3.24313141e-05]]

     [[ 2.18989434e-02  7.39410870e-03  2.49400614e-04 -4.28079368e-04
       -5.98902354e-05  2.90104432e-05]]

     [[ 1.83332828e-02  7.25332167e-03  4.57539446e-04 -3.95808674e-04
       -7.48286921e-05  2.49800254e-05]]

     [[ 1.48459314e-02  7.01160808e-03  6.48679909e-04 -3.56445164e-04
       -8.74059990e-05  2.04824813e-05]]

     [[ 1.14857194e-02  6.67784478e-03  8.19486403e-04 -3.11213904e-04
       -9.74076967e-05  1.56654293e-05]]

     [[ 8.29686785e-03  6.26247070e-03  9.67246124e-04 -2.61431149e-04
       -1.04702056e-04  1.06767171e-05]]

     [[ 5.31826143e-03  5.77717209e-03  1.08990735e-03 -2.08463252e-04
       -1.09238449e-04  5.65990234e-06]]

     [[ 2.58287829e-03  5.23455206e-03  1.18609764e-03 -1.53686893e-04
       -1.11043427e-04  7.50276869e-07]]

     [[ 1.17385195e-04  4.64779423e-03  1.25512269e-03 -9.84516737e-05
       -1.10214829e-04 -3.92850344e-06]]

     [[-2.05810135e-03  4.03032978e-03  1.29694734e-03 -4.40459983e-05
       -1.06914281e-04 -8.26714381e-06]]

     [[-3.93009103e-03  3.39551652e-03  1.31216029e-03  8.33305749e-06
       -1.01358446e-04 -1.21727754e-05]]

     [[-5.49163973e-03  2.75633772e-03  1.30192474e-03  5.76053261e-05
       -9.38093904e-05 -1.55703648e-05]]

     [[-6.74212458e-03  2.12512714e-03  1.26791711e-03  1.02828220e-04
       -8.45644151e-05 -1.84034919e-05]]

     [[-7.68688771e-03  1.51332593e-03  1.21225653e-03  1.43212297e-04
       -7.39456880e-05 -2.06345323e-05]]

     [[-8.33676531e-03  9.31275451e-04  1.13742731e-03  1.78131679e-04
       -6.22899825e-05 -2.22442985e-05]]

     [[-8.70752011e-03  3.88049068e-04  1.04619725e-03  2.07129436e-04
       -4.99387979e-05 -2.32311953e-05]]

     [[-8.81919681e-03 -1.08675319e-04  9.41533961e-04  2.29918169e-04
       -3.72291004e-05 -2.36099618e-05]]

     [[-8.69542081e-03 -5.52701505e-04  8.26521668e-04  2.46376149e-04
       -2.44848858e-05 -2.34100680e-05]]

     [[-8.36266035e-03 -9.39360494e-04  7.04280587e-04  2.56539435e-04
       -1.20097228e-05 -2.26738426e-05]]

     [[-7.84947209e-03 -1.26551686e-03  5.77890730e-04  2.60590502e-04
       -8.03983810e-08 -2.14544057e-05]]

     [[-7.18574899e-03 -1.52953841e-03  4.50321815e-04  2.58843925e-04
        1.10582566e-05 -1.98134784e-05]]

     [[-6.40198816e-03 -1.73123243e-03  3.24370626e-04  2.51729729e-04
        2.11973197e-05 -1.78191394e-05]]

     [[-5.52859464e-03 -1.87175222e-03  2.02606869e-04  2.39774997e-04
        3.01665013e-05 -1.55435915e-05]]

     [[-4.59523496e-03 -1.95347840e-03  8.73282899e-05  2.23584355e-04
        3.78356685e-05 -1.30609977e-05]]

     [[-3.63025246e-03 -1.97987949e-03 -1.94744836e-05  2.03819916e-04
        4.41152248e-05 -1.04454361e-05]]

     [[-2.66015361e-03 -1.95535673e-03 -1.16143204e-04  1.81181229e-04
        4.89554266e-05 -7.76901813e-06]]

     [[-1.70917256e-03 -1.88507779e-03 -2.01367448e-04  1.56385751e-04
        5.23447389e-05 -5.10020563e-06]]

     [[-7.98918608e-04 -1.77480449e-03 -2.74190579e-04  1.30150295e-04
        5.43073483e-05 -2.50235314e-06]]

     [[ 5.18911872e-05 -1.63071872e-03 -3.34006768e-04  1.03173847e-04
        5.48999628e-05 -3.24950676e-08]]

     [[ 8.27613999e-04 -1.45925129e-03 -3.80549803e-04  7.61220785e-05
        5.42080375e-05  2.25961148e-06]]

     [[ 1.51577981e-03 -1.26691725e-03 -4.13874566e-04  4.96138153e-05
        5.23415657e-05  4.33218438e-06]]

     [[ 2.10711034e-03 -1.06016135e-03 -4.34332169e-04  2.42096569e-05
        4.94305776e-05  6.15185813e-06]]

     [[ 2.59546384e-03 -8.45216606e-04 -4.42539834e-04  4.02858102e-07
        4.56204804e-05  7.69387886e-06]]

     [[ 2.97771234e-03 -6.27978243e-04 -4.39346632e-04 -2.13874670e-05
        4.10673732e-05  8.94206778e-06]]

     [[ 3.25355956e-03 -4.13895067e-04 -4.25796238e-04 -4.08208293e-05
        3.59334520e-05  9.88857250e-06]]

     [[ 3.42530793e-03 -2.07879413e-04 -4.03087824e-04 -5.76376027e-05
        3.03826160e-05  1.05334297e-05]]

     [[ 3.49758423e-03 -1.42365061e-05 -3.72536174e-04 -7.16591325e-05
        2.45763664e-05  1.08839652e-05]]

     [[ 3.47703334e-03  1.63386560e-04 -3.35532060e-04 -8.27858735e-05
        1.86700786e-05  1.09540594e-05]]

     [[ 3.37198970e-03  3.22032511e-04 -2.93503807e-04 -9.09937568e-05
        1.28097104e-05  1.07633072e-05]]

     [[ 3.19213600e-03  4.59446945e-04 -2.47880891e-04 -9.63290076e-05
        7.12899379e-06  1.03361020e-05]]

     [[ 2.94815808e-03  5.74073866e-04 -2.00060295e-04 -9.89016630e-05
        1.74714095e-06  9.70067260e-06]]

     [[ 2.65140431e-03  6.65035157e-04 -1.51376218e-04 -9.88780457e-05
       -3.23291714e-06  8.88810025e-06]]

     [[ 2.31355736e-03  7.32095705e-04 -1.03073624e-04 -9.64724603e-05
       -7.72575982e-06  7.93134232e-06]]

     [[ 1.94632491e-03  7.75616128e-04 -5.62859481e-05 -9.19383721e-05
       -1.16641840e-05  6.86428612e-06]]

     [[ 1.56115519e-03  7.96495186e-04 -1.20172084e-05 -8.55593264e-05
       -1.49994133e-05  5.72085364e-06]]

     [[ 1.16898213e-03  7.96104062e-04  2.88714171e-05 -7.76398463e-05
       -1.77008434e-05  4.53417561e-06]]

     [[ 7.80003726e-04  7.76214692e-04  6.56705535e-05 -6.84965338e-05
       -1.97553652e-05  3.33584936e-06]]

     [[ 4.03496208e-04  7.38924354e-04  9.78272705e-05 -5.84495730e-05
       -2.11663172e-05  2.15529249e-06]]

     [[ 4.76656627e-05  6.86578572e-04  1.24945627e-04 -4.78148113e-05
       -2.19521200e-05  1.01920024e-06]]

     [[-2.80462500e-04  6.21694339e-04  1.46783424e-04 -3.68965647e-05
       -2.21446525e-05 -4.88879283e-08]]

     [[-5.75116590e-04  5.46885448e-04  1.63245547e-04 -2.59812644e-05
       -2.17874297e-05 -1.02891096e-06]]

     [[-8.31815488e-04  4.64791555e-04  1.74374319e-04 -1.53320336e-05
       -2.09336413e-05 -1.90449864e-06]]

     [[-1.04737136e-03  3.78012374e-04  1.80337335e-04 -5.18425137e-06
       -1.96441104e-05 -2.66307752e-06]]].
    FIR estimator is parameterized as 
    eta2 = 1000000.00, 120 [dB],
    Ts = 8e-05,
    K1 = 128,
    K2 = 128,
    and
    number_of_iterations = 65536.
    Resulting in the filter coefficients
    h = 
    [[[ 1.08252940e-04  1.28281729e-05 -1.27049270e-05  5.93717085e-07
        1.17846227e-06 -1.96836360e-07]]

     [[ 1.00744104e-04  1.93263359e-05 -1.29159466e-05 -2.40898615e-08
        1.28874250e-06 -1.53288578e-07]]

     [[ 8.99189676e-05  2.58833787e-05 -1.28045375e-05 -6.95355509e-07
        1.37466074e-06 -1.01880540e-07]]

     ...

     [[ 8.99189676e-05 -2.40849947e-05 -1.38040759e-05 -1.02976654e-07
        1.40149086e-06  2.30902751e-07]]

     [[ 1.00744104e-04 -1.73114454e-05 -1.36488667e-05 -7.73097481e-07
        1.26195827e-06  2.72795950e-07]]

     [[ 1.08252940e-04 -1.06631025e-05 -1.31749069e-05 -1.37050471e-06
        1.10303019e-06  3.04694315e-07]]].
    FIR estimator is parameterized as 
    eta2 = 1000000.00, 120 [dB],
    Ts = 8e-05,
    K1 = 256,
    K2 = 256,
    and
    number_of_iterations = 65536.
    Resulting in the filter coefficients
    h = 
    [[[ 5.74150435e-07 -8.78526918e-08 -4.43383424e-08  1.53175606e-08
        2.19814652e-09 -1.67484798e-09]]

     [[ 6.15290819e-07 -6.41398894e-08 -5.19529359e-08  1.40732722e-08
        3.13573286e-09 -1.67350753e-09]]

     [[ 6.43793593e-07 -3.66575036e-08 -5.88630863e-08  1.23485559e-08
        4.07266063e-09 -1.62787788e-09]]

     ...

     [[ 6.43793593e-07  4.95334811e-08 -5.71398679e-08 -1.58328515e-08
        2.96013163e-09  1.97683520e-09]]

     [[ 6.15290819e-07  7.64458163e-08 -4.91417148e-08 -1.71106146e-08
        1.90144028e-09  1.93163500e-09]]

     [[ 5.74150435e-07  9.93358127e-08 -4.05949538e-08 -1.78702252e-08
        8.81850571e-10  1.84319486e-09]]].
    Digital estimator is parameterized as 
    eta2 = 1000000.00, 120 [dB],
    Ts = 8e-05,
    K1 = 16384,
    K2 = 16384,
    and
    number_of_iterations = 65536
    Resulting in the filter coefficients
    Af = 
    [[ 9.94996038e-01 -5.85609672e-05 -1.52230717e-04 -2.75471861e-04
      -3.04350364e-04 -1.31811426e-04]
     [ 4.97381786e-01  9.94502916e-01 -1.46938380e-03 -2.90835779e-03
      -3.52927675e-03 -1.77121254e-03]
     [ 1.23847300e-01  4.95176733e-01  9.87776549e-01 -1.54699950e-02
      -2.05550116e-02 -1.19409200e-02]
     [ 1.92857997e-02  1.17665454e-01  4.75222204e-01  9.43471907e-01
      -7.58097305e-02 -5.20811163e-02]
     [ 1.52750258e-04  8.75435349e-03  8.15423185e-02  3.88343075e-01
       8.11116182e-01 -1.58492382e-01]
     [-1.70798313e-03 -7.85364045e-03 -2.11191409e-02 -7.91994322e-04
       2.30296432e-01  6.55972758e-01]],
    Ab = 
    [[ 1.00499095e+00  7.82443832e-05 -2.02737426e-04  3.57125784e-04
      -3.71344568e-04  1.38536739e-04]
     [-5.02337430e-01  1.00432034e+00  1.97303534e-03 -3.78727109e-03
       4.32730246e-03 -1.90326046e-03]
     [ 1.24908347e-01 -4.99359744e-01  9.95385348e-01  1.99408417e-02
      -2.50124304e-02  1.29507008e-02]
     [-1.90281761e-02  1.16810370e-01 -4.73695080e-01  9.40357070e-01
       9.02804973e-02 -5.63822337e-02]
     [-4.32051033e-04 -6.06526506e-03  7.31767929e-02 -3.72180404e-01
       7.94317985e-01  1.69628635e-01]
     [ 1.95319413e-03 -9.10243375e-03  2.56498008e-02 -1.17760293e-02
      -2.14955637e-01  6.48464658e-01]],
    Bf = 
    [[-4.98749156e-01  1.15958892e-05  3.28655192e-05  6.43646859e-05
       7.75022941e-05  3.85001550e-05]
     [-1.24563361e-01 -4.98654440e-01  3.11038091e-04  6.70261423e-04
       8.87914621e-04  5.05907757e-04]
     [-2.06702353e-02 -1.24148754e-01 -4.97247226e-01  3.51691957e-03
       5.10811180e-03  3.34453250e-03]
     [-2.36819769e-03 -1.95307008e-02 -1.20037448e-01 -4.87221993e-01
       1.85624979e-02  1.43045925e-02]
     [ 1.10267664e-04 -4.69809169e-04 -1.22356552e-02 -1.00729126e-01
      -4.54704210e-01  4.25748367e-02]
     [ 2.63347562e-04  1.50756210e-03  5.34223334e-03  5.29851173e-03
      -6.34811566e-02 -4.10257638e-01]],
    Bb = 
    [[ 5.01248288e-01  1.54776588e-05 -4.39311490e-05  8.39716252e-05
      -9.53957901e-05  4.14757649e-05]
     [-1.25389377e-01  5.01119197e-01  4.19783544e-04 -8.78910230e-04
       1.09810490e-03 -5.54094384e-04]
     [ 2.07960821e-02 -1.24827368e-01  4.99238131e-01  4.56641935e-03
      -6.26750710e-03  3.68031930e-03]
     [-2.31580237e-03  1.92961749e-02 -1.19502944e-01  4.86683403e-01
       2.22754598e-02 -1.56444962e-02]
     [-2.01415592e-04  3.34954457e-05  1.04209562e-02 -9.67546610e-02
       4.50464500e-01  4.58289857e-02]
     [ 2.98992751e-04 -1.72450372e-03  6.24839990e-03 -7.79070233e-03
      -5.94884621e-02  4.08081144e-01]],
    and WT = 
    [[ 1.02793044e-01  1.02792035e-03 -3.83969655e-03 -1.15287434e-04
       2.84518197e-04  1.29914482e-05]].





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  48.335 seconds)


.. _sphx_glr_download_auto_examples_b_general_plot_b_FIR_Filtering.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_b_FIR_Filtering.py <plot_b_FIR_Filtering.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_b_FIR_Filtering.ipynb <plot_b_FIR_Filtering.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
